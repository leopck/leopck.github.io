# Development Dockerfile for Fridays with Faraday Jekyll site
FROM ruby:3.2-slim

# Set working directory
WORKDIR /app

# Install system dependencies for Jekyll and development
RUN apt-get update && apt-get install -y \
    build-essential \
    git \
    curl \
    vim \
    less \
    tree \
    && rm -rf /var/lib/apt/lists/*

# Install Node.js for any JavaScript tooling
RUN curl -fsSL https://deb.nodesource.com/setup_18.x | bash - && \
    apt-get install -y nodejs

# Install yarn
RUN npm install -g yarn

# Install bundler and jekyll
RUN gem install bundler

# Copy gemfile and install dependencies
COPY Gemfile Gemfile.lock ./

# Install Jekyll and all dependencies
RUN bundle install --jobs 4 --retry 3

# Copy source code
COPY . .

# Create necessary directories
RUN mkdir -p _site .jekyll-cache

# Set environment variables
ENV JEKYLL_ENV=development
ENV BUNDLE_GEMFILE=/app/Gemfile

# Expose development server port
EXPOSE 4000

# Default command for development
CMD ["bundle", "exec", "jekyll", "serve", "--host", "0.0.0.0", "--port", "4000", "--livereload", "--drafts"]
