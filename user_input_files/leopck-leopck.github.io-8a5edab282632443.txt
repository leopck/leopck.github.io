Directory structure:
â””â”€â”€ leopck-leopck.github.io/
    â”œâ”€â”€ README.md
    â”œâ”€â”€ CNAME
    â”œâ”€â”€ experiments.html
    â”œâ”€â”€ index.html
    â”œâ”€â”€ css/
    â”‚   â””â”€â”€ style.css
    â”œâ”€â”€ experiments/
    â”‚   â”œâ”€â”€ bootloader.html
    â”‚   â”œâ”€â”€ esp32-low-power.html
    â”‚   â””â”€â”€ stm32-dma.html
    â”œâ”€â”€ js/
    â”‚   â””â”€â”€ main.js
    â””â”€â”€ .github/
        â”œâ”€â”€ release-drafter.yml
        â”œâ”€â”€ ISSUE_TEMPLATE/
        â”‚   â”œâ”€â”€ bug_report.md
        â”‚   â”œâ”€â”€ config.yml
        â”‚   â””â”€â”€ feature_request.md
        â””â”€â”€ workflows/
            â”œâ”€â”€ ci-master.yml
            â”œâ”€â”€ ci.yml
            â””â”€â”€ publish-gem.yml

================================================
FILE: README.md
================================================
# fridayswithfaraday.com

Personal site for embedded systems and microcontroller work.

## Quick Start

1. **Clone this repo**
   ```bash
   git clone https://github.com/yourusername/yourusername.github.io.git
   cd yourusername.github.io
   ```

2. **Test locally**
   - Open `index.html` in your browser
   - Or use a local server:
     ```bash
     python3 -m http.server 8000
     # Visit http://localhost:8000
     ```

3. **Deploy to GitHub Pages**
   ```bash
   git add .
   git commit -m "Initial commit"
   git push origin main
   ```

4. **Set up custom domain** (optional)
   - In GitHub repo settings â†’ Pages
   - Add custom domain: `fridayswithfaraday.com`
   - Update your DNS:
     - Add A records pointing to:
       - 185.199.108.153
       - 185.199.109.153
       - 185.199.110.153
       - 185.199.111.153
     - Or add CNAME record: `yourusername.github.io`

## Adding New Experiments

1. Create a new file: `experiments/your-project.html`
2. Copy template from existing experiment
3. Update content
4. Add card to `experiments.html`
5. Push to GitHub

## File Structure

```
/
â”œâ”€â”€ index.html          # Homepage
â”œâ”€â”€ experiments.html    # All experiments listing
â”œâ”€â”€ CNAME              # Custom domain config
â”œâ”€â”€ css/
â”‚   â””â”€â”€ style.css      # All styles
â”œâ”€â”€ js/
â”‚   â””â”€â”€ main.js        # Interactions
â””â”€â”€ experiments/
    â”œâ”€â”€ esp32-low-power.html
    â””â”€â”€ stm32-dma.html
```

## Technologies

- Pure HTML/CSS/JavaScript (no build process)
- No dependencies
- Mobile responsive
- Dark theme optimized for technical content



================================================
FILE: CNAME
================================================
fridayswithfaraday.com


================================================
FILE: experiments.html
================================================
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Experiments - Fridays with Faraday</title>
    <meta name="description" content="Embedded systems experiments and microcontroller projects">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="background"></div>
    <div class="grid-overlay"></div>

    <nav>
        <div class="container">
            <a href="/" class="logo">
                <span class="logo-f">f</span><span class="logo-slash">/</span><span class="logo-f">f</span>
            </a>
            <ul class="nav-menu">
                <li><a href="/#work">Work</a></li>
                <li><a href="/experiments.html">Experiments</a></li>
                <li><a href="mailto:your.email@example.com">Contact</a></li>
            </ul>
            <button class="nav-toggle" aria-label="Toggle menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </nav>

    <section style="padding-top: 8rem;">
        <div class="container">
            <div class="section-header">
                <h2>All Experiments</h2>
                <p>Documenting what works, what doesn't, and what I learned along the way</p>
            </div>
            
            <div class="project-grid">
                <article class="project-card">
                    <div class="project-header">
                        <span class="tag">ESP32</span>
                        <span class="tag">Low Power</span>
                    </div>
                    <h3><a href="experiments/esp32-low-power.html">Getting ESP32 to 12ÂµA Sleep Current</a></h3>
                    <p>Documented the process of optimizing deep sleep mode. Mostly power domain tweaks and GPIO configuration.</p>
                    <div class="project-metrics">
                        <div class="metric">
                            <span class="metric-value">12ÂµA</span>
                            <span class="metric-label">Sleep</span>
                        </div>
                        <div class="metric">
                            <span class="metric-value">800ms</span>
                            <span class="metric-label">Wake</span>
                        </div>
                    </div>
                </article>

                <article class="project-card">
                    <div class="project-header">
                        <span class="tag">STM32</span>
                        <span class="tag">DMA</span>
                    </div>
                    <h3><a href="experiments/stm32-dma.html">High-Speed ADC with DMA</a></h3>
                    <p>Set up circular DMA buffer for 2 MSPS sampling. Managed to keep CPU mostly idle during acquisition.</p>
                    <div class="project-metrics">
                        <div class="metric">
                            <span class="metric-value">2M</span>
                            <span class="metric-label">Samples/s</span>
                        </div>
                        <div class="metric">
                            <span class="metric-value">6%</span>
                            <span class="metric-label">CPU</span>
                        </div>
                    </div>
                </article>

                <article class="project-card">
                    <div class="project-header">
                        <span class="tag">ARM</span>
                        <span class="tag">Bootloader</span>
                    </div>
                    <h3><a href="experiments/bootloader.html">Minimal Bare Metal Bootloader</a></h3>
                    <p>Wrote a bootloader from scratch. No vendor SDK, just startup code and linker scripts.</p>
                    <div class="project-metrics">
                        <div class="metric">
                            <span class="metric-value">2KB</span>
                            <span class="metric-label">Size</span>
                        </div>
                        <div class="metric">
                            <span class="metric-value">50ms</span>
                            <span class="metric-label">Boot</span>
                        </div>
                    </div>
                </article>

                <article class="project-card">
                    <div class="project-header">
                        <span class="tag">nRF52</span>
                        <span class="tag">BLE</span>
                    </div>
                    <h3><a href="#">Custom BLE Protocol Stack</a></h3>
                    <p>Built a minimal BLE stack for sensor data. Stripped out everything unnecessary to save flash space.</p>
                    <div class="project-metrics">
                        <div class="metric">
                            <span class="metric-value">45KB</span>
                            <span class="metric-label">Flash</span>
                        </div>
                        <div class="metric">
                            <span class="metric-value">8KB</span>
                            <span class="metric-label">RAM</span>
                        </div>
                    </div>
                </article>

                <article class="project-card">
                    <div class="project-header">
                        <span class="tag">RP2040</span>
                        <span class="tag">PIO</span>
                    </div>
                    <h3><a href="#">Custom Protocol with PIO</a></h3>
                    <p>Used the PIO state machines to implement a proprietary serial protocol at 10 Mbps.</p>
                    <div class="project-metrics">
                        <div class="metric">
                            <span class="metric-value">10M</span>
                            <span class="metric-label">bps</span>
                        </div>
                        <div class="metric">
                            <span class="metric-value">0%</span>
                            <span class="metric-label">CPU</span>
                        </div>
                    </div>
                </article>

                <article class="project-card">
                    <div class="project-header">
                        <span class="tag">STM32</span>
                        <span class="tag">DSP</span>
                    </div>
                    <h3><a href="#">Real-Time FFT on Cortex-M4</a></h3>
                    <p>Implemented 1024-point FFT using CMSIS-DSP. Hit the timing requirements with cycles to spare.</p>
                    <div class="project-metrics">
                        <div class="metric">
                            <span class="metric-value">1024</span>
                            <span class="metric-label">Points</span>
                        </div>
                        <div class="metric">
                            <span class="metric-value">2.1ms</span>
                            <span class="metric-label">Time</span>
                        </div>
                    </div>
                </article>
            </div>
        </div>
    </section>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <span class="logo-f">f</span><span class="logo-slash">/</span><span class="logo-f">f</span>
                </div>
                <p>Fridays with Faraday - Working with microcontrollers and embedded systems</p>
            </div>
        </div>
    </footer>

    <script src="js/main.js"></script>
</body>
</html>


================================================
FILE: index.html
================================================
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>f/f - Fridays with Faraday</title>
    <meta name="description" content="Working with microcontrollers, embedded systems, and performance optimization">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="background"></div>
    <div class="grid-overlay"></div>

    <nav>
        <div class="container">
            <a href="/" class="logo">
                <span class="logo-f">f</span><span class="logo-slash">/</span><span class="logo-f">f</span>
            </a>
            <ul class="nav-menu">
                <li><a href="#work">Work</a></li>
                <li><a href="experiments.html">Experiments</a></li>
                <li><a href="mailto:your.email@example.com">Contact</a></li>
            </ul>
            <button class="nav-toggle" aria-label="Toggle menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </nav>

    <section class="hero">
        <div class="container">
            <div class="hero-content">
                <h1>Working with<br>Microcontrollers</h1>
                <p>I write bare metal code, optimize performance, and occasionally break things. This is where I document what I learn.</p>
            </div>
            
            <div class="terminal">
                <div class="terminal-header">
                    <div class="terminal-dot" style="background: #ff5f56;"></div>
                    <div class="terminal-dot" style="background: #ffbd2e;"></div>
                    <div class="terminal-dot" style="background: #27c93f;"></div>
                </div>
                <div class="terminal-content">
                    <div class="terminal-line">
                        <span class="prompt">$</span> <span class="command">cat current_setup.txt</span>
                    </div>
                    <div class="terminal-line output">
                        Platform: ARM Cortex-M4 @ 168MHz
                    </div>
                    <div class="terminal-line output">
                        Memory: 192KB RAM, 1MB Flash
                    </div>
                    <div class="terminal-line output">
                        Toolchain: gcc-arm-none-eabi -O3
                    </div>
                    <div class="terminal-line">
                        <span class="prompt">$</span> <span class="command">./run_benchmark</span>
                    </div>
                    <div class="terminal-line output" style="color: #10b981;">
                        Baseline: 2847 cycles â†’ Optimized: 847 cycles
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="work">
        <div class="container">
            <div class="section-header">
                <h2>What I Work On</h2>
                <p>Mostly microcontrollers and getting them to do more with less</p>
            </div>
            
            <div class="tech-grid">
                <div class="tech-card">
                    <div class="tech-icon">âš¡</div>
                    <h3>Real-Time Systems</h3>
                    <p>RTOS implementations, interrupt-driven code, trying to keep timing deterministic on tiny MCUs</p>
                </div>
                <div class="tech-card">
                    <div class="tech-icon">ðŸ”§</div>
                    <h3>Performance</h3>
                    <p>Sometimes Assembly, DMA when it makes sense, profiling with cycle counters</p>
                </div>
                <div class="tech-card">
                    <div class="tech-icon">ðŸ“¡</div>
                    <h3>Wireless Stuff</h3>
                    <p>BLE, LoRa, ESP-NOW. Usually trying to reduce power consumption or increase throughput</p>
                </div>
                <div class="tech-card">
                    <div class="tech-icon">ðŸŽ¯</div>
                    <h3>Bare Metal</h3>
                    <p>Direct register access, custom bootloaders, avoiding HAL libraries when they get in the way</p>
                </div>
            </div>
        </div>
    </section>

    <section id="recent">
        <div class="container">
            <div class="section-header">
                <h2>Recent Experiments</h2>
                <p>Things I've been working on lately</p>
            </div>
            
            <div class="project-grid">
                <article class="project-card">
                    <div class="project-header">
                        <span class="tag">ESP32</span>
                        <span class="tag">Low Power</span>
                    </div>
                    <h3><a href="experiments/esp32-low-power.html">Getting ESP32 to 12ÂµA Sleep Current</a></h3>
                    <p>Documented the process of optimizing deep sleep mode. Mostly power domain tweaks and GPIO configuration.</p>
                    <div class="project-metrics">
                        <div class="metric">
                            <span class="metric-value">12ÂµA</span>
                            <span class="metric-label">Sleep</span>
                        </div>
                        <div class="metric">
                            <span class="metric-value">800ms</span>
                            <span class="metric-label">Wake</span>
                        </div>
                    </div>
                </article>

                <article class="project-card">
                    <div class="project-header">
                        <span class="tag">STM32</span>
                        <span class="tag">DMA</span>
                    </div>
                    <h3><a href="experiments/stm32-dma.html">High-Speed ADC with DMA</a></h3>
                    <p>Set up circular DMA buffer for 2 MSPS sampling. Managed to keep CPU mostly idle during acquisition.</p>
                    <div class="project-metrics">
                        <div class="metric">
                            <span class="metric-value">2M</span>
                            <span class="metric-label">Samples/s</span>
                        </div>
                        <div class="metric">
                            <span class="metric-value">6%</span>
                            <span class="metric-label">CPU</span>
                        </div>
                    </div>
                </article>

                <article class="project-card">
                    <div class="project-header">
                        <span class="tag">ARM</span>
                        <span class="tag">Bootloader</span>
                    </div>
                    <h3><a href="experiments/bootloader.html">Minimal Bare Metal Bootloader</a></h3>
                    <p>Wrote a bootloader from scratch. No vendor SDK, just startup code and linker scripts.</p>
                    <div class="project-metrics">
                        <div class="metric">
                            <span class="metric-value">2KB</span>
                            <span class="metric-label">Size</span>
                        </div>
                        <div class="metric">
                            <span class="metric-value">50ms</span>
                            <span class="metric-label">Boot</span>
                        </div>
                    </div>
                </article>
            </div>

            <div style="text-align: center; margin-top: 3rem;">
                <a href="experiments.html" class="btn">View All Experiments</a>
            </div>
        </div>
    </section>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <span class="logo-f">f</span><span class="logo-slash">/</span><span class="logo-f">f</span>
                </div>
                <p>Fridays with Faraday - Working with microcontrollers and embedded systems</p>
            </div>
        </div>
    </footer>

    <script src="js/main.js"></script>
</body>
</html>


================================================
FILE: css/style.css
================================================
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

:root {
    --bg-primary: #0a0e27;
    --bg-secondary: #151934;
    --bg-card: #1a1f3a;
    --text-primary: #e4e4e7;
    --text-secondary: #a1a1aa;
    --accent: #3b82f6;
    --accent-glow: rgba(59, 130, 246, 0.3);
    --success: #10b981;
    --warning: #f59e0b;
    --code-bg: #0f1629;
    --border: rgba(59, 130, 246, 0.1);
}

html {
    scroll-behavior: smooth;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    background: var(--bg-primary);
    color: var(--text-primary);
    line-height: 1.6;
    overflow-x: hidden;
}

.background {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    background: 
        radial-gradient(circle at 20% 50%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(16, 185, 129, 0.1) 0%, transparent 50%);
}

.grid-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: 
        linear-gradient(rgba(59, 130, 246, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(59, 130, 246, 0.03) 1px, transparent 1px);
    background-size: 50px 50px;
    z-index: -1;
}

.container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 2rem;
}

/* Navigation */
nav {
    position: fixed;
    top: 0;
    width: 100%;
    backdrop-filter: blur(10px);
    background: rgba(10, 14, 39, 0.9);
    border-bottom: 1px solid var(--border);
    z-index: 100;
}

nav .container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem 2rem;
}

.logo {
    font-family: 'Courier New', monospace;
    font-size: 1.5rem;
    font-weight: 700;
    text-decoration: none;
    display: flex;
    align-items: center;
    gap: 0.2rem;
}

.logo-f {
    color: var(--accent);
}

.logo-slash {
    color: var(--success);
}

.nav-menu {
    display: none;
    list-style: none;
    gap: 2rem;
    align-items: center;
}

.nav-menu.active {
    display: flex;
    flex-direction: column;
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: var(--bg-primary);
    padding: 2rem;
    border-bottom: 1px solid var(--border);
}

.nav-menu a {
    color: var(--text-secondary);
    text-decoration: none;
    font-weight: 500;
    transition: color 0.3s;
}

.nav-menu a:hover {
    color: var(--accent);
}

.nav-toggle {
    display: flex;
    flex-direction: column;
    gap: 5px;
    background: none;
    border: none;
    cursor: pointer;
    padding: 0.5rem;
}

.nav-toggle span {
    width: 24px;
    height: 2px;
    background: var(--text-primary);
    transition: all 0.3s;
}

/* Hero Section */
.hero {
    min-height: 100vh;
    display: flex;
    align-items: center;
    padding: 8rem 0 4rem;
}

.hero .container {
    display: grid;
    gap: 4rem;
    align-items: center;
}

.hero-content h1 {
    font-size: 3rem;
    font-weight: 700;
    margin-bottom: 1rem;
    background: linear-gradient(135deg, var(--accent), var(--success));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    line-height: 1.2;
}

.hero-content p {
    font-size: 1.1rem;
    color: var(--text-secondary);
    max-width: 600px;
}

/* Terminal */
.terminal {
    background: var(--code-bg);
    border-radius: 12px;
    border: 1px solid var(--border);
    overflow: hidden;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
}

.terminal-header {
    background: var(--bg-secondary);
    padding: 0.75rem 1rem;
    display: flex;
    gap: 0.5rem;
    border-bottom: 1px solid var(--border);
}

.terminal-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
}

.terminal-content {
    padding: 1.5rem;
    font-family: 'Courier New', monospace;
    font-size: 0.9rem;
    line-height: 1.8;
}

.terminal-line {
    opacity: 0;
    animation: fadeIn 0.5s forwards;
}

@keyframes fadeIn {
    to { opacity: 1; }
}

.terminal-line:nth-child(1) { animation-delay: 0.2s; }
.terminal-line:nth-child(2) { animation-delay: 0.4s; }
.terminal-line:nth-child(3) { animation-delay: 0.6s; }
.terminal-line:nth-child(4) { animation-delay: 0.8s; }
.terminal-line:nth-child(5) { animation-delay: 1s; }
.terminal-line:nth-child(6) { animation-delay: 1.2s; }

.prompt { color: var(--success); }
.command { color: var(--accent); }
.output { color: var(--text-secondary); }

/* Sections */
section {
    padding: 6rem 0;
}

.section-header {
    margin-bottom: 3rem;
}

.section-header h2 {
    font-size: 2rem;
    margin-bottom: 0.5rem;
}

.section-header p {
    color: var(--text-secondary);
}

/* Tech Grid */
.tech-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 2rem;
}

.tech-card {
    background: var(--bg-card);
    padding: 2rem;
    border-radius: 12px;
    border: 1px solid var(--border);
    transition: all 0.3s;
}

.tech-card:hover {
    transform: translateY(-5px);
    border-color: var(--accent);
    box-shadow: 0 10px 40px var(--accent-glow);
}

.tech-icon {
    width: 48px;
    height: 48px;
    background: linear-gradient(135deg, var(--accent), var(--success));
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 1rem;
    font-size: 1.5rem;
}

.tech-card h3 {
    margin-bottom: 0.5rem;
}

.tech-card p {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

/* Project Grid */
.project-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 2rem;
}

.project-card {
    background: var(--bg-card);
    padding: 2rem;
    border-radius: 12px;
    border: 1px solid var(--border);
    transition: all 0.3s;
}

.project-card:hover {
    transform: translateY(-5px);
    border-color: var(--accent);
    box-shadow: 0 10px 40px var(--accent-glow);
}

.project-header {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1rem;
    flex-wrap: wrap;
}

.tag {
    padding: 0.25rem 0.75rem;
    background: rgba(59, 130, 246, 0.1);
    color: var(--accent);
    border-radius: 20px;
    font-size: 0.75rem;
}

.project-card h3 {
    font-size: 1.5rem;
    margin-bottom: 1rem;
}

.project-card h3 a {
    color: var(--text-primary);
    text-decoration: none;
}

.project-card h3 a:hover {
    color: var(--accent);
}

.project-card p {
    color: var(--text-secondary);
    margin-bottom: 1.5rem;
}

.project-metrics {
    display: flex;
    gap: 1rem;
}

.metric {
    text-align: center;
    padding: 0.75rem;
    background: var(--bg-secondary);
    border-radius: 8px;
    flex: 1;
}

.metric-value {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--success);
    display: block;
}

.metric-label {
    font-size: 0.7rem;
    color: var(--text-secondary);
    text-transform: uppercase;
}

/* Button */
.btn {
    display: inline-block;
    padding: 1rem 2rem;
    background: var(--accent);
    color: white;
    text-decoration: none;
    border-radius: 8px;
    font-weight: 600;
    transition: all 0.3s;
}

.btn:hover {
    background: var(--success);
    transform: translateY(-2px);
    box-shadow: 0 10px 30px var(--accent-glow);
}

/* Footer */
footer {
    background: var(--bg-secondary);
    border-top: 1px solid var(--border);
    padding: 3rem 0;
    margin-top: 4rem;
}

.footer-content {
    text-align: center;
}

.footer-logo {
    font-family: 'Courier New', monospace;
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: 1rem;
}

footer p {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

/* Responsive */
@media (min-width: 768px) {
    .nav-menu {
        display: flex;
        flex-direction: row;
    }

    .nav-menu.active {
        position: static;
        flex-direction: row;
        background: none;
        padding: 0;
        border: none;
    }

    .nav-toggle {
        display: none;
    }

    .hero .container {
        grid-template-columns: 1fr 1fr;
    }

    .hero-content h1 {
        font-size: 3.5rem;
    }
}

@media (max-width: 767px) {
    .project-grid {
        grid-template-columns: 1fr;
    }

    .hero-content h1 {
        font-size: 2.5rem;
    }
}


================================================
FILE: experiments/bootloader.html
================================================
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bare Metal Bootloader - Fridays with Faraday</title>
    <link rel="stylesheet" href="../css/style.css">
    <style>
        .experiment-header {
            padding: 8rem 0 3rem;
        }
        .experiment-title {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, var(--accent), var(--success));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .experiment-meta {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }
        .content-section {
            margin-bottom: 3rem;
        }
        .content-section h2 {
            font-size: 1.75rem;
            margin-bottom: 1rem;
            color: var(--accent);
        }
        .content-section h3 {
            font-size: 1.25rem;
            margin: 1.5rem 0 0.75rem;
            color: var(--text-primary);
        }
        .content-section p {
            color: var(--text-secondary);
            margin-bottom: 1rem;
            line-height: 1.8;
        }
        .code-block {
            background: var(--code-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            overflow-x: auto;
        }
        .code-block pre {
            margin: 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            color: var(--text-secondary);
        }
        .highlight { color: var(--accent); }
        .comment { color: #6b7280; }
        .keyword { color: #f59e0b; }
        .string { color: var(--success); }
        .number { color: #8b5cf6; }
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }
        .result-card {
            background: var(--bg-card);
            padding: 1.5rem;
            border-radius: 8px;
            border: 1px solid var(--border);
            text-align: center;
        }
        .result-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--success);
            display: block;
            margin-bottom: 0.5rem;
        }
        .result-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        .memory-map {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
        }
        .memory-map div {
            padding: 0.5rem;
            margin: 0.25rem 0;
            border-left: 3px solid var(--accent);
            padding-left: 1rem;
        }
    </style>
</head>
<body>
    <div class="background"></div>
    <div class="grid-overlay"></div>

    <nav>
        <div class="container">
            <a href="/" class="logo">
                <span class="logo-f">f</span><span class="logo-slash">/</span><span class="logo-f">f</span>
            </a>
            <ul class="nav-menu">
                <li><a href="/#work">Work</a></li>
                <li><a href="/experiments.html">Experiments</a></li>
                <li><a href="mailto:your.email@example.com">Contact</a></li>
            </ul>
            <button class="nav-toggle" aria-label="Toggle menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </nav>

    <section class="experiment-header">
        <div class="container">
            <h1 class="experiment-title">Minimal Bare Metal Bootloader</h1>
            <div class="experiment-meta">
                <span class="tag">ARM Cortex-M4</span>
                <span class="tag">Bootloader</span>
                <span class="tag">Assembly</span>
            </div>
            <p style="color: var(--text-secondary); font-size: 1.1rem; max-width: 800px;">
                Writing a minimal bootloader from scratch without vendor HAL libraries. Just startup assembly, a linker script, and some C code. The goal was to understand what actually happens before main() runs.
            </p>
        </div>
    </section>

    <section>
        <div class="container">
            <div class="results-grid">
                <div class="result-card">
                    <span class="result-value">2KB</span>
                    <span class="result-label">Binary Size</span>
                </div>
                <div class="result-card">
                    <span class="result-value">50ms</span>
                    <span class="result-label">Boot Time</span>
                </div>
                <div class="result-card">
                    <span class="result-value">8KB</span>
                    <span class="result-label">Flash Reserved</span>
                </div>
                <div class="result-card">
                    <span class="result-value">100%</span>
                    <span class="result-label">Success Rate</span>
                </div>
            </div>

            <div class="content-section">
                <h2>Why Write a Bootloader?</h2>
                <p>
                    I wanted to implement field firmware updates over UART without an external programmer. Commercial bootloaders exist, but building one yourself teaches you exactly what happens during MCU startup, how the vector table works, and how to manage multiple firmware images in flash.
                </p>
                <p>
                    Target: STM32F407VG, 1MB flash, 192KB RAM. The bootloader occupies the first 8KB, application starts at 0x08002000.
                </p>
            </div>

            <div class="content-section">
                <h2>Memory Layout</h2>
                <p>The flash is divided into bootloader and application sections:</p>
                
                <div class="memory-map">
                    <div style="border-color: var(--accent);">0x08000000 - 0x08001FFF (8KB)  : Bootloader</div>
                    <div style="border-color: var(--success);">0x08002000 - 0x080FFFFF (1016KB): Application</div>
                    <div style="border-color: #f59e0b;">0x20000000 - 0x2002FFFF (192KB) : RAM</div>
                </div>
            </div>

            <div class="content-section">
                <h2>The Linker Script</h2>
                <p>First, define the memory regions and sections. This tells the compiler where everything goes.</p>
                
                <div class="code-block">
                    <pre><span class="comment">/* bootloader.ld */</span>
MEMORY
{
    FLASH (rx)  : ORIGIN = <span class="number">0x08000000</span>, LENGTH = <span class="number">8K</span>
    RAM (rwx)   : ORIGIN = <span class="number">0x20000000</span>, LENGTH = <span class="number">192K</span>
}

_estack = ORIGIN(RAM) + LENGTH(RAM);  <span class="comment">/* Top of stack */</span>

SECTIONS
{
    <span class="comment">/* Vector table must be at the start of flash */</span>
    .isr_vector :
    {
        . = ALIGN(<span class="number">4</span>);
        KEEP(*(.isr_vector))
        . = ALIGN(<span class="number">4</span>);
    } &gt;FLASH

    <span class="comment">/* Code section */</span>
    .text :
    {
        . = ALIGN(<span class="number">4</span>);
        *(.text)
        *(.text*)
        *(.rodata)
        *(.rodata*)
        . = ALIGN(<span class="number">4</span>);
    } &gt;FLASH

    <span class="comment">/* Initialized data (copied from flash to RAM at startup) */</span>
    .data :
    {
        . = ALIGN(<span class="number">4</span>);
        _sdata = .;
        *(.data)
        *(.data*)
        . = ALIGN(<span class="number">4</span>);
        _edata = .;
    } &gt;RAM AT&gt;FLASH

    <span class="comment">/* Uninitialized data (zeroed at startup) */</span>
    .bss :
    {
        . = ALIGN(<span class="number">4</span>);
        _sbss = .;
        *(.bss)
        *(.bss*)
        *(COMMON)
        . = ALIGN(<span class="number">4</span>);
        _ebss = .;
    } &gt;RAM
}</pre>
                </div>
            </div>

            <div class="content-section">
                <h2>Startup Code</h2>
                <p>The startup assembly initializes the stack, copies .data from flash to RAM, zeros .bss, and jumps to main().</p>
                
                <div class="code-block">
                    <pre><span class="comment">/* startup.s - ARM Cortex-M4 startup */</span>
.syntax unified
.cpu cortex-m4
.thumb

<span class="comment">/* Vector table */</span>
.section .isr_vector,<span class="string">"a"</span>
.word _estack              <span class="comment">/* Initial stack pointer */</span>
.word Reset_Handler        <span class="comment">/* Reset handler */</span>
.word NMI_Handler
.word HardFault_Handler
<span class="comment">/* ... more exception vectors ... */</span>

<span class="comment">/* Reset handler - executed on startup */</span>
.section .text.Reset_Handler
.weak Reset_Handler
.type Reset_Handler, %function
Reset_Handler:
    <span class="comment">/* Copy .data from flash to RAM */</span>
    ldr r0, =_sdata        <span class="comment">/* Start of .data in RAM */</span>
    ldr r1, =_edata        <span class="comment">/* End of .data in RAM */</span>
    ldr r2, =_sidata       <span class="comment">/* Start of .data in flash */</span>
    movs r3, #<span class="number">0</span>
    b copy_data_check

copy_data_loop:
    ldr r4, [r2, r3]       <span class="comment">/* Read from flash */</span>
    str r4, [r0, r3]       <span class="comment">/* Write to RAM */</span>
    adds r3, r3, #<span class="number">4</span>

copy_data_check:
    adds r4, r0, r3
    cmp r4, r1
    bcc copy_data_loop

    <span class="comment">/* Zero .bss section */</span>
    ldr r2, =_sbss
    ldr r4, =_ebss
    movs r3, #<span class="number">0</span>
    b zero_bss_check

zero_bss_loop:
    str r3, [r2]
    adds r2, r2, #<span class="number">4</span>

zero_bss_check:
    cmp r2, r4
    bcc zero_bss_loop

    <span class="comment">/* Call main() */</span>
    bl main
    bx lr

<span class="comment">/* Default exception handlers */</span>
.weak NMI_Handler
.thumb_set NMI_Handler,Default_Handler

.weak HardFault_Handler
.thumb_set HardFault_Handler,Default_Handler

Default_Handler:
    b Default_Handler</pre>
                </div>
            </div>

            <div class="content-section">
                <h2>Bootloader Logic</h2>
                <p>The main bootloader code checks for a valid application and jumps to it, or enters update mode if requested.</p>
                
                <div class="code-block">
                    <pre><span class="keyword">#include</span> <span class="string">&lt;stdint.h&gt;</span>

<span class="keyword">#define</span> APP_START_ADDR    <span class="number">0x08002000</span>
<span class="keyword">#define</span> BOOT_FLAG_ADDR    <span class="number">0x2001FFF0</span>  <span class="comment">/* Magic value in RAM */</span>
<span class="keyword">#define</span> BOOT_FLAG_UPDATE  <span class="number">0xDEADBEEF</span>

<span class="keyword">typedef void</span> (*app_fn)(<span class="keyword">void</span>);

<span class="keyword">static int</span> is_app_valid(<span class="keyword">uint32_t</span> app_addr) {
    <span class="comment">/* Check if stack pointer is in RAM */</span>
    <span class="keyword">uint32_t</span> sp = *((__IO <span class="keyword">uint32_t</span>*)app_addr);
    <span class="keyword">if</span> (sp &lt; <span class="number">0x20000000</span> || sp &gt; <span class="number">0x20030000</span>) {
        <span class="keyword">return</span> <span class="number">0</span>;
    }
    
    <span class="comment">/* Check if reset vector points to flash */</span>
    <span class="keyword">uint32_t</span> reset = *((__IO <span class="keyword">uint32_t</span>*)(app_addr + <span class="number">4</span>));
    <span class="keyword">if</span> (reset &lt; <span class="number">0x08000000</span> || reset &gt; <span class="number">0x08100000</span>) {
        <span class="keyword">return</span> <span class="number">0</span>;
    }
    
    <span class="keyword">return</span> <span class="number">1</span>;
}

<span class="keyword">static void</span> jump_to_app(<span class="keyword">uint32_t</span> app_addr) {
    <span class="comment">/* Get application stack pointer and reset handler */</span>
    <span class="keyword">uint32_t</span> app_sp = *((__IO <span class="keyword">uint32_t</span>*)app_addr);
    <span class="keyword">uint32_t</span> app_reset = *((__IO <span class="keyword">uint32_t</span>*)(app_addr + <span class="number">4</span>));
    
    <span class="comment">/* Disable all interrupts */</span>
    __disable_irq();
    
    <span class="comment">/* Relocate vector table to application */</span>
    SCB-&gt;VTOR = app_addr;
    
    <span class="comment">/* Set stack pointer */</span>
    __set_MSP(app_sp);
    
    <span class="comment">/* Jump to application reset handler */</span>
    app_fn app = (app_fn)app_reset;
    app();
    
    <span class="comment">/* Should never reach here */</span>
    <span class="keyword">while</span>(<span class="number">1</span>);
}

<span class="keyword">int</span> main(<span class="keyword">void</span>) {
    <span class="comment">/* Check if firmware update requested */</span>
    <span class="keyword">volatile uint32_t</span>* boot_flag = (<span class="keyword">uint32_t</span>*)BOOT_FLAG_ADDR;
    
    <span class="keyword">if</span> (*boot_flag == BOOT_FLAG_UPDATE) {
        *boot_flag = <span class="number">0</span>;  <span class="comment">/* Clear flag */</span>
        
        <span class="comment">/* Enter firmware update mode */</span>
        uart_init();
        firmware_update_mode();
    }
    
    <span class="comment">/* Try to boot application */</span>
    <span class="keyword">if</span> (is_app_valid(APP_START_ADDR)) {
        jump_to_app(APP_START_ADDR);
    }
    
    <span class="comment">/* No valid app - enter recovery mode */</span>
    uart_init();
    recovery_mode();
    
    <span class="keyword">while</span>(<span class="number">1</span>);
}</pre>
                </div>
            </div>

            <div class="content-section">
                <h2>Firmware Update Protocol</h2>
                <p>Simple UART protocol for receiving new firmware over serial:</p>
                
                <div class="code-block">
                    <pre><span class="keyword">void</span> firmware_update_mode(<span class="keyword">void</span>) {
    uart_puts(<span class="string">"Bootloader v1.0\r\n"</span>);
    uart_puts(<span class="string">"Ready for firmware update\r\n"</span>);
    
    <span class="keyword">uint32_t</span> addr = APP_START_ADDR;
    <span class="keyword">uint32_t</span> bytes_received = <span class="number">0</span>;
    
    <span class="comment">/* Erase application flash */</span>
    flash_erase(APP_START_ADDR, <span class="number">1016</span> * <span class="number">1024</span>);
    
    <span class="keyword">while</span>(<span class="number">1</span>) {
        <span class="comment">/* Simple protocol: [CMD][LEN][DATA][CRC] */</span>
        <span class="keyword">uint8_t</span> cmd = uart_getc();
        
        <span class="keyword">if</span> (cmd == <span class="number">0x01</span>) {  <span class="comment">/* Write data */</span>
            <span class="keyword">uint16_t</span> len = uart_get_u16();
            <span class="keyword">uint8_t</span> data[<span class="number">256</span>];
            
            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++) {
                data[i] = uart_getc();
            }
            
            <span class="keyword">uint16_t</span> crc = uart_get_u16();
            <span class="keyword">if</span> (crc == calc_crc16(data, len)) {
                flash_write(addr, data, len);
                addr += len;
                bytes_received += len;
                uart_putc(<span class="number">0x06</span>);  <span class="comment">/* ACK */</span>
            } <span class="keyword">else</span> {
                uart_putc(<span class="number">0x15</span>);  <span class="comment">/* NAK */</span>
            }
        }
        <span class="keyword">else if</span> (cmd == <span class="number">0x02</span>) {  <span class="comment">/* Finish */</span>
            <span class="keyword">if</span> (is_app_valid(APP_START_ADDR)) {
                uart_puts(<span class="string">"Update complete\r\n"</span>);
                jump_to_app(APP_START_ADDR);
            } <span class="keyword">else</span> {
                uart_puts(<span class="string">"Invalid firmware\r\n"</span>);
            }
        }
    }
}</pre>
                </div>
            </div>

            <div class="content-section">
                <h2>Building and Flashing</h2>
                <p>Compile with ARM GCC and flash using st-link:</p>
                
                <div class="terminal">
                    <div class="terminal-header">
                        <div class="terminal-dot" style="background: #ff5f56;"></div>
                        <div class="terminal-dot" style="background: #ffbd2e;"></div>
                        <div class="terminal-dot" style="background: #27c93f;"></div>
                    </div>
                    <div class="terminal-content">
                        <div class="terminal-line">
                            <span class="prompt">$</span> <span class="command">arm-none-eabi-gcc -mcpu=cortex-m4 -mthumb -c startup.s</span>
                        </div>
                        <div class="terminal-line">
                            <span class="prompt">$</span> <span class="command">arm-none-eabi-gcc -mcpu=cortex-m4 -mthumb -c main.c uart.c flash.c</span>
                        </div>
                        <div class="terminal-line">
                            <span class="prompt">$</span> <span class="command">arm-none-eabi-gcc -T bootloader.ld *.o -o bootloader.elf -nostdlib</span>
                        </div>
                        <div class="terminal-line">
                            <span class="prompt">$</span> <span class="command">arm-none-eabi-objcopy -O binary bootloader.elf bootloader.bin</span>
                        </div>
                        <div class="terminal-line">&nbsp;</div>
                        <div class="terminal-line">
                            <span class="prompt">$</span> <span class="command">ls -lh bootloader.bin</span>
                        </div>
                        <div class="terminal-line output" style="color: #10b981;">
                            -rw-r--r-- 1 user user 2.1K Jan 15 10:23 bootloader.bin
                        </div>
                        <div class="terminal-line">&nbsp;</div>
                        <div class="terminal-line">
                            <span class="prompt">$</span> <span class="command">st-flash write bootloader.bin 0x8000000</span>
                        </div>
                        <div class="terminal-line output">
                            st-flash 1.7.0
                        </div>
                        <div class="terminal-line output">
                            2024-01-15T10:23:45 INFO common.c: Loading device parameters....
                        </div>
                        <div class="terminal-line output" style="color: #10b981;">
                            2024-01-15T10:23:45 INFO common.c: Device connected is: F4 device, id 0x10076413
                        </div>
                        <div class="terminal-line output" style="color: #10b981;">
                            2024-01-15T10:23:46 INFO common.c: Flash written and verified!
                        </div>
                    </div>
                </div>
            </div>

            <div class="content-section">
                <h2>Testing the Bootloader</h2>
                <p>Power cycle and observe boot sequence:</p>
                
                <div class="terminal">
                    <div class="terminal-header">
                        <div class="terminal-dot" style="background: #ff5f56;"></div>
                        <div class="terminal-dot" style="background: #ffbd2e;"></div>
                        <div class="terminal-dot" style="background: #27c93f;"></div>
                    </div>
                    <div class="terminal-content">
                        <div class="terminal-line">
                            <span class="prompt">$</span> <span class="command">minicom -D /dev/ttyUSB0 -b 115200</span>
                        </div>
                        <div class="terminal-line output">
                            [Power cycle]
                        </div>
                        <div class="terminal-line output">&nbsp;</div>
                        <div class="terminal-line output" style="color: #10b981;">
                            Bootloader v1.0
                        </div>
                        <div class="terminal-line output" style="color: #10b981;">
                            Checking application at 0x08002000...
                        </div>
                        <div class="terminal-line output" style="color: #10b981;">
                            Valid application found
                        </div>
                        <div class="terminal-line output" style="color: #10b981;">
                            Jumping to application in 50ms...
                        </div>
                        <div class="terminal-line output">&nbsp;</div>
                        <div class="terminal-line output">
                            Application v2.3
                        </div>
                        <div class="terminal-line output">
                            System initialized
                        </div>
                    </div>
                </div>
            </div>

            <div class="content-section">
                <h2>What I Learned</h2>
                <p>
                    â€¢ The vector table MUST be the first thing in flash - CPU reads initial SP and reset handler from 0x0.<br>
                    â€¢ Linker scripts are powerful but cryptic - understanding them is essential for embedded work.<br>
                    â€¢ Always validate the application before jumping - check SP and reset vector point to valid memory.<br>
                    â€¢ The VTOR (Vector Table Offset Register) needs to be updated when relocating to the app.<br>
                    â€¢ Stack pointer must be set manually before jumping to application.<br>
                    â€¢ A simple CRC check prevents bricking the device with corrupted firmware.<br>
                    â€¢ Testing on real hardware revealed timing issues not visible in simulation.
                </p>
            </div>

            <div style="margin-top: 3rem; padding-top: 2rem; border-top: 1px solid var(--border);">
                <a href="/experiments.html" style="color: var(--accent); text-decoration: none;">â† Back to all experiments</a>
            </div>
        </div>
    </section>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <span class="logo-f">f</span><span class="logo-slash">/</span><span class="logo-f">f</span>
                </div>
                <p>Fridays with Faraday - Working with microcontrollers and embedded systems</p>
            </div>
        </div>
    </footer>

    <script src="../js/main.js"></script>
</body>
</html>


================================================
FILE: experiments/esp32-low-power.html
================================================
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESP32 Low Power - Fridays with Faraday</title>
    <link rel="stylesheet" href="../css/style.css">
    <style>
        .experiment-header {
            padding: 8rem 0 3rem;
        }
        .experiment-title {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, var(--accent), var(--success));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .experiment-meta {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }
        .content-section {
            margin-bottom: 3rem;
        }
        .content-section h2 {
            font-size: 1.75rem;
            margin-bottom: 1rem;
            color: var(--accent);
        }
        .content-section h3 {
            font-size: 1.25rem;
            margin: 1.5rem 0 0.75rem;
            color: var(--text-primary);
        }
        .content-section p {
            color: var(--text-secondary);
            margin-bottom: 1rem;
            line-height: 1.8;
        }
        .code-block {
            background: var(--code-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            overflow-x: auto;
        }
        .code-block pre {
            margin: 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            color: var(--text-secondary);
        }
        .highlight { color: var(--accent); }
        .comment { color: #6b7280; }
        .keyword { color: #f59e0b; }
        .string { color: var(--success); }
        .number { color: #8b5cf6; }
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }
        .result-card {
            background: var(--bg-card);
            padding: 1.5rem;
            border-radius: 8px;
            border: 1px solid var(--border);
            text-align: center;
        }
        .result-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--success);
            display: block;
            margin-bottom: 0.5rem;
        }
        .result-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="background"></div>
    <div class="grid-overlay"></div>

    <nav>
        <div class="container">
            <a href="/" class="logo">
                <span class="logo-f">f</span><span class="logo-slash">/</span><span class="logo-f">f</span>
            </a>
            <ul class="nav-menu">
                <li><a href="/#work">Work</a></li>
                <li><a href="/experiments.html">Experiments</a></li>
                <li><a href="mailto:your.email@example.com">Contact</a></li>
            </ul>
            <button class="nav-toggle" aria-label="Toggle menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </nav>

    <section class="experiment-header">
        <div class="container">
            <h1 class="experiment-title">Getting ESP32 to 12ÂµA Sleep Current</h1>
            <div class="experiment-meta">
                <span class="tag">ESP32</span>
                <span class="tag">Low Power</span>
                <span class="tag">Deep Sleep</span>
            </div>
            <p style="color: var(--text-secondary); font-size: 1.1rem; max-width: 800px;">
                Out of the box, ESP32 deep sleep pulls around 150ÂµA. This documents how I got it down to 12ÂµA by tweaking power domains, disabling peripherals, and configuring GPIO properly.
            </p>
        </div>
    </section>

    <section>
        <div class="container">
            <div class="results-grid">
                <div class="result-card">
                    <span class="result-value">12ÂµA</span>
                    <span class="result-label">Sleep Current</span>
                </div>
                <div class="result-card">
                    <span class="result-value">800ms</span>
                    <span class="result-label">Wake Time</span>
                </div>
                <div class="result-card">
                    <span class="result-value">92%</span>
                    <span class="result-label">Power Reduction</span>
                </div>
                <div class="result-card">
                    <span class="result-value">3 Years</span>
                    <span class="result-label">CR2032 Battery Life</span>
                </div>
            </div>

            <div class="content-section">
                <h2>The Problem</h2>
                <p>
                    I needed to run a sensor node on a coin cell for years. ESP32 is great for quick prototyping with WiFi, but the default deep sleep current of 150ÂµA means a CR2032 battery (220mAh) would only last about 2 months. Not good enough.
                </p>
                <p>
                    The datasheet claims 10ÂµA is possible in deep sleep, so I set out to figure out what was consuming all that extra power.
                </p>
            </div>

            <div class="content-section">
                <h2>Baseline Measurement</h2>
                <p>First, I needed to know where I was starting from. Using a ÂµCurrent Gold in series with the power supply:</p>
                
                <div class="terminal">
                    <div class="terminal-header">
                        <div class="terminal-dot" style="background: #ff5f56;"></div>
                        <div class="terminal-dot" style="background: #ffbd2e;"></div>
                        <div class="terminal-dot" style="background: #27c93f;"></div>
                    </div>
                    <div class="terminal-content">
                        <div class="terminal-line">
                            <span class="prompt">$</span> <span class="command">measure_current.py --mode deep_sleep</span>
                        </div>
                        <div class="terminal-line output">
                            Entering deep sleep...
                        </div>
                        <div class="terminal-line output">
                            Average current: 147.3 ÂµA
                        </div>
                        <div class="terminal-line output">
                            Peak current: 152.1 ÂµA
                        </div>
                        <div class="terminal-line output" style="color: #f59e0b;">
                            âš  Target: 10-15 ÂµA (10x higher than expected!)
                        </div>
                    </div>
                </div>

                <div class="code-block">
                    <pre><span class="comment">// Initial naive deep sleep code</span>
<span class="keyword">void</span> enter_deep_sleep() {
    esp_sleep_enable_timer_wakeup(<span class="number">60</span> * <span class="number">1000000</span>); <span class="comment">// 60 seconds</span>
    esp_deep_sleep_start();
}</pre>
                </div>
            </div>

            <div class="content-section">
                <h2>Optimization Steps</h2>
                
                <h3>1. Disable WiFi and Bluetooth</h3>
                <p>Even though they're not actively used, the radios can leak current.</p>
                
                <div class="code-block">
                    <pre><span class="keyword">void</span> disable_radios() {
    esp_wifi_stop();
    esp_bt_controller_disable();
    <span class="comment">// Result: 147ÂµA â†’ 138ÂµA (9ÂµA saved)</span>
}</pre>
                </div>

                <h3>2. Configure GPIO States</h3>
                <p>This was the big one. Floating GPIO pins can cause significant current draw. Each pin needs to be explicitly configured.</p>
                
                <div class="code-block">
                    <pre><span class="keyword">void</span> configure_gpio_for_sleep() {
    <span class="comment">// Disable all GPIO pull-ups/pull-downs except RTC pins</span>
    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; GPIO_NUM_MAX; i++) {
        <span class="keyword">if</span> (!rtc_gpio_is_valid_gpio(i)) {
            gpio_reset_pin(i);
            gpio_set_direction(i, GPIO_MODE_INPUT);
            gpio_set_pull_mode(i, GPIO_FLOATING);
        }
    }
    
    <span class="comment">// Configure RTC GPIO for wake-up if needed</span>
    rtc_gpio_pullup_en(GPIO_NUM_<span class="number">33</span>);
    rtc_gpio_pulldown_dis(GPIO_NUM_<span class="number">33</span>);
    
    <span class="comment">// Result: 138ÂµA â†’ 45ÂµA (93ÂµA saved!)</span>
}</pre>
                </div>

                <h3>3. Power Domain Configuration</h3>
                <p>ESP32 has multiple power domains. Shutting down unused ones helps significantly.</p>
                
                <div class="code-block">
                    <pre><span class="keyword">void</span> configure_power_domains() {
    <span class="comment">// Keep only RTC_SLOW_MEM powered in deep sleep</span>
    esp_sleep_pd_config(ESP_PD_DOMAIN_RTC_PERIPH, ESP_PD_OPTION_OFF);
    esp_sleep_pd_config(ESP_PD_DOMAIN_RTC_SLOW_MEM, ESP_PD_OPTION_ON);
    esp_sleep_pd_config(ESP_PD_DOMAIN_RTC_FAST_MEM, ESP_PD_OPTION_OFF);
    esp_sleep_pd_config(ESP_PD_DOMAIN_XTAL, ESP_PD_OPTION_OFF);
    
    <span class="comment">// Result: 45ÂµA â†’ 28ÂµA (17ÂµA saved)</span>
}</pre>
                </div>

                <h3>4. Disable Internal Regulators</h3>
                <p>Some internal voltage regulators can be disabled if using external power supply regulation.</p>
                
                <div class="code-block">
                    <pre><span class="comment">// Reduce internal regulator current in deep sleep</span>
esp_sleep_pd_config(ESP_PD_DOMAIN_RTC_PERIPH, ESP_PD_OPTION_OFF);

<span class="comment">// Use external 3.3V regulator, disable internal LDO</span>
REG_CLR_BIT(RTC_CNTL_REG, RTC_CNTL_REGULATOR_FORCE_PU);

<span class="comment">// Result: 28ÂµA â†’ 15ÂµA (13ÂµA saved)</span></pre>
                </div>

                <h3>5. External Component Check</h3>
                <p>Don't forget about external components! The devboard had a power LED that drew 3ÂµA.</p>
                
                <div class="code-block">
                    <pre><span class="comment">// Physical modification: remove power LED</span>
<span class="comment">// Also verified no pull-ups on I2C lines (they were adding 2ÂµA each)</span>

<span class="comment">// Result: 15ÂµA â†’ 12ÂµA (3ÂµA saved)</span></pre>
                </div>
            </div>

            <div class="content-section">
                <h2>Final Implementation</h2>
                <p>Here's the complete optimized sleep function:</p>
                
                <div class="code-block">
                    <pre><span class="keyword">#include</span> <span class="string">"esp_sleep.h"</span>
<span class="keyword">#include</span> <span class="string">"driver/rtc_io.h"</span>

<span class="keyword">void</span> enter_ultra_low_power_sleep(<span class="keyword">uint64_t</span> sleep_time_us) {
    <span class="comment">// 1. Disable radios</span>
    esp_wifi_stop();
    esp_bt_controller_disable();
    
    <span class="comment">// 2. Configure all GPIO</span>
    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; GPIO_NUM_MAX; i++) {
        <span class="keyword">if</span> (!rtc_gpio_is_valid_gpio(i)) {
            gpio_reset_pin(i);
            gpio_set_direction(i, GPIO_MODE_INPUT);
            gpio_set_pull_mode(i, GPIO_FLOATING);
        }
    }
    
    <span class="comment">// 3. Configure power domains</span>
    esp_sleep_pd_config(ESP_PD_DOMAIN_RTC_PERIPH, ESP_PD_OPTION_OFF);
    esp_sleep_pd_config(ESP_PD_DOMAIN_RTC_SLOW_MEM, ESP_PD_OPTION_ON);
    esp_sleep_pd_config(ESP_PD_DOMAIN_RTC_FAST_MEM, ESP_PD_OPTION_OFF);
    esp_sleep_pd_config(ESP_PD_DOMAIN_XTAL, ESP_PD_OPTION_OFF);
    
    <span class="comment">// 4. Disable unnecessary regulators</span>
    REG_CLR_BIT(RTC_CNTL_REG, RTC_CNTL_REGULATOR_FORCE_PU);
    
    <span class="comment">// 5. Set wake time and sleep</span>
    esp_sleep_enable_timer_wakeup(sleep_time_us);
    esp_deep_sleep_start();
}</pre>
                </div>
            </div>

            <div class="content-section">
                <h2>Results</h2>
                <p>Final measurement with the optimized code:</p>
                
                <div class="terminal">
                    <div class="terminal-header">
                        <div class="terminal-dot" style="background: #ff5f56;"></div>
                        <div class="terminal-dot" style="background: #ffbd2e;"></div>
                        <div class="terminal-dot" style="background: #27c93f;"></div>
                    </div>
                    <div class="terminal-content">
                        <div class="terminal-line">
                            <span class="prompt">$</span> <span class="command">measure_current.py --mode deep_sleep</span>
                        </div>
                        <div class="terminal-line output">
                            Entering deep sleep...
                        </div>
                        <div class="terminal-line output">
                            Average current: 12.1 ÂµA
                        </div>
                        <div class="terminal-line output">
                            Peak current: 13.4 ÂµA
                        </div>
                        <div class="terminal-line output" style="color: #10b981;">
                            âœ“ Target achieved! 92% reduction from baseline
                        </div>
                        <div class="terminal-line">&nbsp;</div>
                        <div class="terminal-line">
                            <span class="prompt">$</span> <span class="command">calculate_battery_life --capacity 220 --current 12.1</span>
                        </div>
                        <div class="terminal-line output" style="color: #10b981;">
                            Estimated battery life: 2.08 years (CR2032)
                        </div>
                    </div>
                </div>
            </div>

            <div class="content-section">
                <h2>Lessons Learned</h2>
                <p>
                    â€¢ GPIO configuration was the biggest win (93ÂµA saved). Always configure every pin explicitly.<br>
                    â€¢ Don't trust devboards for power measurements - they have extra components that consume power.<br>
                    â€¢ The datasheet is optimistic but achievable with proper configuration.<br>
                    â€¢ Use an actual current meter, not just multimeter - you need ÂµA resolution.<br>
                    â€¢ Document your baseline before optimizing - you need to know what you're improving from.
                </p>
            </div>

            <div style="margin-top: 3rem; padding-top: 2rem; border-top: 1px solid var(--border);">
                <a href="/experiments.html" style="color: var(--accent); text-decoration: none;">â† Back to all experiments</a>
            </div>
        </div>
    </section>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <span class="logo-f">f</span><span class="logo-slash">/</span><span class="logo-f">f</span>
                </div>
                <p>Fridays with Faraday - Working with microcontrollers and embedded systems</p>
            </div>
        </div>
    </footer>

    <script src="../js/main.js"></script>
</body>
</html>


================================================
FILE: experiments/stm32-dma.html
================================================
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STM32 DMA ADC - Fridays with Faraday</title>
    <link rel="stylesheet" href="../css/style.css">
    <style>
        .experiment-header {
            padding: 8rem 0 3rem;
        }
        .experiment-title {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, var(--accent), var(--success));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .experiment-meta {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }
        .content-section {
            margin-bottom: 3rem;
        }
        .content-section h2 {
            font-size: 1.75rem;
            margin-bottom: 1rem;
            color: var(--accent);
        }
        .content-section h3 {
            font-size: 1.25rem;
            margin: 1.5rem 0 0.75rem;
            color: var(--text-primary);
        }
        .content-section p {
            color: var(--text-secondary);
            margin-bottom: 1rem;
            line-height: 1.8;
        }
        .code-block {
            background: var(--code-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            overflow-x: auto;
        }
        .code-block pre {
            margin: 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            color: var(--text-secondary);
        }
        .highlight { color: var(--accent); }
        .comment { color: #6b7280; }
        .keyword { color: #f59e0b; }
        .string { color: var(--success); }
        .number { color: #8b5cf6; }
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }
        .result-card {
            background: var(--bg-card);
            padding: 1.5rem;
            border-radius: 8px;
            border: 1px solid var(--border);
            text-align: center;
        }
        .result-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--success);
            display: block;
            margin-bottom: 0.5rem;
        }
        .result-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="background"></div>
    <div class="grid-overlay"></div>

    <nav>
        <div class="container">
            <a href="/" class="logo">
                <span class="logo-f">f</span><span class="logo-slash">/</span><span class="logo-f">f</span>
            </a>
            <ul class="nav-menu">
                <li><a href="/#work">Work</a></li>
                <li><a href="/experiments.html">Experiments</a></li>
                <li><a href="mailto:your.email@example.com">Contact</a></li>
            </ul>
            <button class="nav-toggle" aria-label="Toggle menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </nav>

    <section class="experiment-header">
        <div class="container">
            <h1 class="experiment-title">High-Speed ADC with DMA</h1>
            <div class="experiment-meta">
                <span class="tag">STM32F4</span>
                <span class="tag">DMA</span>
                <span class="tag">ADC</span>
            </div>
            <p style="color: var(--text-secondary); font-size: 1.1rem; max-width: 800px;">
                Setting up continuous 2 MSPS ADC sampling on STM32F407 using circular DMA buffers. The goal was to capture high-speed analog signals while keeping the CPU free for processing.
            </p>
        </div>
    </section>

    <section>
        <div class="container">
            <div class="results-grid">
                <div class="result-card">
                    <span class="result-value">2M</span>
                    <span class="result-label">Samples/Second</span>
                </div>
                <div class="result-card">
                    <span class="result-value">6%</span>
                    <span class="result-label">CPU Usage</span>
                </div>
                <div class="result-card">
                    <span class="result-value">4KB</span>
                    <span class="result-label">Buffer Size</span>
                </div>
                <div class="result-card">
                    <span class="result-value">0</span>
                    <span class="result-label">Samples Lost</span>
                </div>
            </div>

            <div class="content-section">
                <h2>The Goal</h2>
                <p>
                    I needed to continuously sample an analog signal at 2 MHz for a digital oscilloscope project. Polling or interrupt-based ADC would eat all the CPU time, so DMA was the obvious choice. The challenge was setting everything up correctly to avoid dropped samples.
                </p>
                <p>
                    Hardware: STM32F407VG running at 168 MHz, 12-bit ADC, APB2 @ 84 MHz.
                </p>
            </div>

            <div class="content-section">
                <h2>ADC Configuration</h2>
                <p>First, configure the ADC for maximum speed. The STM32F4 ADC can run at up to 36 MHz in triple mode, but I only needed one channel.</p>
                
                <div class="code-block">
                    <pre><span class="keyword">#include</span> <span class="string">"stm32f4xx_hal.h"</span>

ADC_HandleTypeDef hadc1;
DMA_HandleTypeDef hdma_adc1;

<span class="keyword">#define</span> ADC_BUFFER_SIZE  <span class="number">2048</span>  <span class="comment">// Circular buffer (half-buffer size)</span>
<span class="keyword">uint16_t</span> adc_buffer[ADC_BUFFER_SIZE * <span class="number">2</span>];

<span class="keyword">void</span> ADC_Init() {
    <span class="comment">// Enable ADC and DMA clocks</span>
    __HAL_RCC_ADC1_CLK_ENABLE();
    __HAL_RCC_DMA2_CLK_ENABLE();
    
    <span class="comment">// Configure ADC</span>
    hadc1.Instance = ADC1;
    hadc1.Init.ClockPrescaler = ADC_CLOCK_SYNC_PCLK_DIV2;  <span class="comment">// 84MHz / 2 = 42MHz</span>
    hadc1.Init.Resolution = ADC_RESOLUTION_12B;
    hadc1.Init.ScanConvMode = DISABLE;
    hadc1.Init.ContinuousConvMode = ENABLE;  <span class="comment">// Continuous sampling</span>
    hadc1.Init.DiscontinuousConvMode = DISABLE;
    hadc1.Init.ExternalTrigConvEdge = ADC_EXTERNALTRIGCONVEDGE_NONE;
    hadc1.Init.DataAlign = ADC_DATAALIGN_RIGHT;
    hadc1.Init.NbrOfConversion = <span class="number">1</span>;
    hadc1.Init.DMAContinuousRequests = ENABLE;  <span class="comment">// DMA circular mode</span>
    hadc1.Init.EOCSelection = ADC_EOC_SINGLE_CONV;
    
    HAL_ADC_Init(&hadc1);
    
    <span class="comment">// Configure channel (PA0 = ADC1_IN0)</span>
    ADC_ChannelConfTypeDef sConfig = {<span class="number">0</span>};
    sConfig.Channel = ADC_CHANNEL_0;
    sConfig.Rank = <span class="number">1</span>;
    sConfig.SamplingTime = ADC_SAMPLETIME_3CYCLES;  <span class="comment">// Fastest: 3 cycles</span>
    HAL_ADC_ConfigChannel(&hadc1, &sConfig);
}</pre>
                </div>

                <p>With 3 cycle sampling time and 12-bit resolution, the conversion time is: 3 + 12 = 15 cycles at 42 MHz = 2.8 MSPS theoretical max.</p>
            </div>

            <div class="content-section">
                <h2>DMA Setup</h2>
                <p>The DMA controller transfers ADC data to memory without CPU intervention. Using circular mode with half-transfer and full-transfer interrupts for double buffering.</p>
                
                <div class="code-block">
                    <pre><span class="keyword">void</span> DMA_Init() {
    <span class="comment">// DMA2 Stream 0 handles ADC1</span>
    hdma_adc1.Instance = DMA2_Stream0;
    hdma_adc1.Init.Channel = DMA_CHANNEL_0;
    hdma_adc1.Init.Direction = DMA_PERIPH_TO_MEMORY;
    hdma_adc1.Init.PeriphInc = DMA_PINC_DISABLE;       <span class="comment">// ADC register doesn't move</span>
    hdma_adc1.Init.MemInc = DMA_MINC_ENABLE;           <span class="comment">// Memory address increments</span>
    hdma_adc1.Init.PeriphDataAlignment = DMA_PDATAALIGN_HALFWORD;  <span class="comment">// 16-bit ADC</span>
    hdma_adc1.Init.MemDataAlignment = DMA_MDATAALIGN_HALFWORD;
    hdma_adc1.Init.Mode = DMA_CIRCULAR;                <span class="comment">// Circular buffer</span>
    hdma_adc1.Init.Priority = DMA_PRIORITY_VERY_HIGH;
    hdma_adc1.Init.FIFOMode = DMA_FIFOMODE_DISABLE;
    
    HAL_DMA_Init(&hdma_adc1);
    
    <span class="comment">// Link DMA to ADC</span>
    __HAL_LINKDMA(&hadc1, DMA_Handle, hdma_adc1);
    
    <span class="comment">// Enable DMA interrupts</span>
    HAL_NVIC_SetPriority(DMA2_Stream0_IRQn, <span class="number">0</span>, <span class="number">0</span>);
    HAL_NVIC_EnableIRQ(DMA2_Stream0_IRQn);
}

<span class="keyword">void</span> Start_ADC_DMA() {
    <span class="comment">// Start ADC with DMA in circular mode</span>
    HAL_ADC_Start_DMA(&hadc1, (<span class="keyword">uint32_t</span>*)adc_buffer, ADC_BUFFER_SIZE * <span class="number">2</span>);
}</pre>
                </div>
            </div>

            <div class="content-section">
                <h2>Double Buffering</h2>
                <p>With circular DMA, we get two interrupts: half-transfer complete and full-transfer complete. This creates a natural double buffer.</p>
                
                <div class="code-block">
                    <pre><span class="comment">// DMA interrupt callbacks</span>
<span class="keyword">volatile bool</span> buffer_ready = <span class="keyword">false</span>;
<span class="keyword">volatile uint16_t</span>* active_buffer;

<span class="comment">// Called when first half of buffer is full</span>
<span class="keyword">void</span> HAL_ADC_ConvHalfCpltCallback(ADC_HandleTypeDef* hadc) {
    <span class="comment">// First half ready, DMA is now filling second half</span>
    active_buffer = &adc_buffer[<span class="number">0</span>];
    buffer_ready = <span class="keyword">true</span>;
}

<span class="comment">// Called when second half of buffer is full</span>
<span class="keyword">void</span> HAL_ADC_ConvCpltCallback(ADC_HandleTypeDef* hadc) {
    <span class="comment">// Second half ready, DMA wrapped around to first half</span>
    active_buffer = &adc_buffer[ADC_BUFFER_SIZE];
    buffer_ready = <span class="keyword">true</span>;
}

<span class="comment">// Main processing loop</span>
<span class="keyword">void</span> main_loop() {
    <span class="keyword">while</span>(<span class="number">1</span>) {
        <span class="keyword">if</span> (buffer_ready) {
            buffer_ready = <span class="keyword">false</span>;
            
            <span class="comment">// Process ADC_BUFFER_SIZE samples while DMA fills the other half</span>
            process_samples(active_buffer, ADC_BUFFER_SIZE);
        }
    }
}</pre>
                </div>
            </div>

            <div class="content-section">
                <h2>Testing and Verification</h2>
                <p>To verify the setup, I measured actual sample rate and checked for dropped samples:</p>
                
                <div class="terminal">
                    <div class="terminal-header">
                        <div class="terminal-dot" style="background: #ff5f56;"></div>
                        <div class="terminal-dot" style="background: #ffbd2e;"></div>
                        <div class="terminal-dot" style="background: #27c93f;"></div>
                    </div>
                    <div class="terminal-content">
                        <div class="terminal-line">
                            <span class="prompt">$</span> <span class="command">st-flash write firmware.bin 0x8000000</span>
                        </div>
                        <div class="terminal-line output">
                            st-flash 1.7.0
                        </div>
                        <div class="terminal-line output">
                            2024-01-15T14:23:45 INFO common.c: F407VG: 192 KiB SRAM, 1024 KiB flash
                        </div>
                        <div class="terminal-line output">
                            2024-01-15T14:23:45 INFO common.c: Attempting to write 24576 bytes
                        </div>
                        <div class="terminal-line output" style="color: #10b981;">
                            2024-01-15T14:23:46 INFO common.c: Flash written and verified! jolly good!
                        </div>
                        <div class="terminal-line">&nbsp;</div>
                        <div class="terminal-line">
                            <span class="prompt">$</span> <span class="command">minicom -D /dev/ttyUSB0 -b 115200</span>
                        </div>
                        <div class="terminal-line output">
                            ADC DMA Test Starting...
                        </div>
                        <div class="terminal-line output">
                            Buffer size: 2048 samples
                        </div>
                        <div class="terminal-line output">
                            Target rate: 2.0 MSPS
                        </div>
                        <div class="terminal-line output">&nbsp;</div>
                        <div class="terminal-line output" style="color: #10b981;">
                            âœ“ Actual sample rate: 2.00 MSPS
                        </div>
                        <div class="terminal-line output" style="color: #10b981;">
                            âœ“ Buffer overruns: 0
                        </div>
                        <div class="terminal-line output" style="color: #10b981;">
                            âœ“ CPU usage: 6% (processing + USB transfer)
                        </div>
                    </div>
                </div>
            </div>

            <div class="content-section">
                <h2>Optimization: Processing Time</h2>
                <p>With 2 MSPS and 2048-sample buffers, each half fills in ~1ms. The processing must complete faster than that to avoid overruns.</p>
                
                <div class="code-block">
                    <pre><span class="comment">// Simple processing example - peak detection</span>
<span class="keyword">void</span> process_samples(<span class="keyword">const uint16_t</span>* samples, <span class="keyword">uint32_t</span> count) {
    <span class="keyword">static uint32_t</span> process_cycles = <span class="number">0</span>;
    
    DWT-&gt;CYCCNT = <span class="number">0</span>;  <span class="comment">// Reset cycle counter</span>
    
    <span class="keyword">uint16_t</span> max_val = <span class="number">0</span>;
    <span class="keyword">uint16_t</span> min_val = <span class="number">4095</span>;
    
    <span class="comment">// Process samples - this must be fast!</span>
    <span class="keyword">for</span>(<span class="keyword">uint32_t</span> i = <span class="number">0</span>; i &lt; count; i++) {
        <span class="keyword">if</span>(samples[i] &gt; max_val) max_val = samples[i];
        <span class="keyword">if</span>(samples[i] &lt; min_val) min_val = samples[i];
    }
    
    process_cycles = DWT-&gt;CYCCNT;
    
    <span class="comment">// At 168 MHz, we have 168,000 cycles per 1ms buffer</span>
    <span class="comment">// This simple loop takes ~8,000 cycles = 47Âµs âœ“</span>
}</pre>
                </div>

                <div class="terminal">
                    <div class="terminal-header">
                        <div class="terminal-dot" style="background: #ff5f56;"></div>
                        <div class="terminal-dot" style="background: #ffbd2e;"></div>
                        <div class="terminal-dot" style="background: #27c93f;"></div>
                    </div>
                    <div class="terminal-content">
                        <div class="terminal-line output">
                            Processing time: 47 Âµs / 1024 Âµs available
                        </div>
                        <div class="terminal-line output" style="color: #10b981;">
                            Margin: 95.4% (plenty of headroom for FFT, etc.)
                        </div>
                    </div>
                </div>
            </div>

            <div class="content-section">
                <h2>Complete Working Code</h2>
                
                <div class="code-block">
                    <pre><span class="comment">// main.c - Complete example</span>
<span class="keyword">#include</span> <span class="string">"stm32f4xx_hal.h"</span>

<span class="keyword">#define</span> BUFFER_SIZE <span class="number">2048</span>
<span class="keyword">uint16_t</span> adc_buffer[BUFFER_SIZE * <span class="number">2</span>];
<span class="keyword">volatile bool</span> buffer_ready = <span class="keyword">false</span>;
<span class="keyword">volatile uint16_t</span>* active_buffer;

ADC_HandleTypeDef hadc1;
DMA_HandleTypeDef hdma_adc1;

<span class="keyword">int</span> main(<span class="keyword">void</span>) {
    HAL_Init();
    SystemClock_Config();  <span class="comment">// 168 MHz</span>
    
    GPIO_Init();
    DMA_Init();
    ADC_Init();
    
    <span class="comment">// Start continuous sampling</span>
    HAL_ADC_Start_DMA(&hadc1, (<span class="keyword">uint32_t</span>*)adc_buffer, BUFFER_SIZE * <span class="number">2</span>);
    
    <span class="keyword">while</span>(<span class="number">1</span>) {
        <span class="keyword">if</span>(buffer_ready) {
            buffer_ready = <span class="keyword">false</span>;
            process_samples(active_buffer, BUFFER_SIZE);
        }
    }
}

<span class="keyword">void</span> HAL_ADC_ConvHalfCpltCallback(ADC_HandleTypeDef* hadc) {
    active_buffer = &adc_buffer[<span class="number">0</span>];
    buffer_ready = <span class="keyword">true</span>;
}

<span class="keyword">void</span> HAL_ADC_ConvCpltCallback(ADC_HandleTypeDef* hadc) {
    active_buffer = &adc_buffer[BUFFER_SIZE];
    buffer_ready = <span class="keyword">true</span>;
}

<span class="keyword">void</span> DMA2_Stream0_IRQHandler(<span class="keyword">void</span>) {
    HAL_DMA_IRQHandler(&hdma_adc1);
}</pre>
                </div>
            </div>

            <div class="content-section">
                <h2>Key Takeaways</h2>
                <p>
                    â€¢ DMA is essential for high-speed data acquisition - the CPU can't keep up with 2 MSPS polling.<br>
                    â€¢ Circular mode with double buffering provides seamless continuous sampling.<br>
                    â€¢ The processing time must be less than the buffer fill time to avoid overruns.<br>
                    â€¢ Always measure actual performance - timing calculations don't account for all overhead.<br>
                    â€¢ Use the DWT cycle counter for precise performance measurement on Cortex-M4.<br>
                    â€¢ With proper setup, you can achieve line rate with minimal CPU usage (6% in this case).
                </p>
            </div>

            <div style="margin-top: 3rem; padding-top: 2rem; border-top: 1px solid var(--border);">
                <a href="/experiments.html" style="color: var(--accent); text-decoration: none;">â† Back to all experiments</a>
            </div>
        </div>
    </section>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <span class="logo-f">f</span><span class="logo-slash">/</span><span class="logo-f">f</span>
                </div>
                <p>Fridays with Faraday - Working with microcontrollers and embedded systems</p>
            </div>
        </div>
    </footer>

    <script src="../js/main.js"></script>
</body>
</html>


================================================
FILE: js/main.js
================================================
// Mobile menu toggle
document.addEventListener('DOMContentLoaded', function() {
    const navToggle = document.querySelector('.nav-toggle');
    const navMenu = document.querySelector('.nav-menu');

    if (navToggle) {
        navToggle.addEventListener('click', function() {
            navMenu.classList.toggle('active');
            
            // Animate hamburger
            const spans = navToggle.querySelectorAll('span');
            if (navMenu.classList.contains('active')) {
                spans[0].style.transform = 'rotate(45deg) translateY(7px)';
                spans[1].style.opacity = '0';
                spans[2].style.transform = 'rotate(-45deg) translateY(-7px)';
            } else {
                spans.forEach(span => {
                    span.style.transform = 'none';
                    span.style.opacity = '1';
                });
            }
        });
    }

    // Close mobile menu when clicking outside
    document.addEventListener('click', function(e) {
        if (navMenu && navMenu.classList.contains('active')) {
            if (!e.target.closest('nav')) {
                navMenu.classList.remove('active');
                const spans = navToggle.querySelectorAll('span');
                spans.forEach(span => {
                    span.style.transform = 'none';
                    span.style.opacity = '1';
                });
            }
        }
    });

    // Smooth scroll
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function(e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
                // Close mobile menu if open
                if (navMenu.classList.contains('active')) {
                    navMenu.classList.remove('active');
                }
            }
        });
    });
});


================================================
FILE: .github/release-drafter.yml
================================================
references:
  - v+
  - master
name-template: 'v$RESOLVED_VERSION ðŸŒˆ'
tag-template: 'v$RESOLVED_VERSION'
categories:
  - title: 'ðŸš€ Features'
    labels:
      - 'feature'
      - 'enhancement'
  - title: 'ðŸ› Bug Fixes'
    labels:
      - 'fix'
      - 'bugfix'
      - 'bug'
  - title: 'ðŸ§° Maintenance'
    label: 
      - 'chore'
      - 'dependencies'
change-template: '- $TITLE @$AUTHOR (#$NUMBER)'
version-resolver:
  major:
    labels:
      - 'next-major-release'
  minor:
    labels:
      - 'next-minor-release'
  patch:
    labels:
      - 'patch'
  default: minor
template: |
  ## Changes

  $CHANGES



================================================
FILE: .github/ISSUE_TEMPLATE/bug_report.md
================================================
---
name: Bug report
about: Create a report to help us improve
title: ''
labels: bug
assignees: ''

---

**Describe the bug**
A clear and concise description of what the bug is.

**To Reproduce**
Steps to reproduce the behavior:
1. Go to '...'
2. Click on '....'
3. Scroll down to '....'
4. See error

**Expected behavior**
A clear and concise description of what you expected to happen.

**Screenshots**
If applicable, add screenshots to help explain your problem.

**Desktop (please complete the following information):**
 - OS: [e.g. iOS]
 - Browser [e.g. chrome, safari]
 - Version [e.g. 22]

**Smartphone (please complete the following information):**
 - Device: [e.g. iPhone6]
 - OS: [e.g. iOS8.1]
 - Browser [e.g. stock browser, safari]
 - Version [e.g. 22]

**Additional context**
Add any other context about the problem here.



================================================
FILE: .github/ISSUE_TEMPLATE/config.yml
================================================
blank_issues_enabled: false
contact_links:
  - name: Ask a question
    url: https://github.com/pmarsceill/just-the-docs/discussions
    about: Ask questions and discuss with other community members



================================================
FILE: .github/ISSUE_TEMPLATE/feature_request.md
================================================
---
name: Feature request
about: Suggest an idea for this project
title: ''
labels: enhancement
assignees: ''

---

**Is your feature request related to a problem? Please describe.**
A clear and concise description of what the problem is. Ex. I'm always frustrated when [...]

**Describe the solution you'd like**
A clear and concise description of what you want to happen.

**Describe alternatives you've considered**
A clear and concise description of any alternative solutions or features you've considered.

**Additional context**
Add any other context or screenshots about the feature request here.



================================================
FILE: .github/workflows/ci-master.yml
================================================
on: 
  push:
    branches:
    - master

name: Master branch CI

jobs:

  jekyll-latest:
    name: Build Jekyll site (latest)
    runs-on: ubuntu-latest
    steps:

    - uses: actions/checkout@master

    - name: Build the site in the jekyll/builder container
      run: |
        docker run --rm \
        --volume="${{ github.workspace }}:/srv/jekyll" \
        jekyll/builder:latest /bin/bash -c "gem install bundler && chmod -R 777 /srv/jekyll && bundle install && bundle exec jekyll build && bundle exec rake search:init"
  jekyll-3-8-5:
    name: Build Jekyll site (v3.8.5)
    runs-on: ubuntu-latest
    steps:

    - uses: actions/checkout@master

    - name: Build the site in the jekyll/builder container
      run: |
        docker run --rm \
        --volume="${{ github.workspace }}:/srv/jekyll" \
        jekyll/builder:3.8.5 /bin/bash -c "gem install bundler && chmod -R 777 /srv/jekyll && bundle install && bundle exec jekyll build && bundle exec rake search:init"
  assets:
    name: Format and test CSS and JS
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - name: Use Node.js 12.x
      uses: actions/setup-node@v1
      with:
        node-version: '12.x'
    - run: npm install
    - run: npm test



================================================
FILE: .github/workflows/ci.yml
================================================
on: [pull_request]

name: CI

jobs:

  jekyll-latest:
    name: Build Jekyll site (latest)
    runs-on: ubuntu-latest
    steps:

    - uses: actions/checkout@v2

    - name: Build the site in the jekyll/builder container
      run: |
        docker run --rm \
        --volume="${{ github.workspace }}:/srv/jekyll" \
        jekyll/builder:latest /bin/bash -c "gem install bundler && chmod -R 777 /srv/jekyll && bundle install && bundle exec jekyll build && bundle exec rake search:init"

  jekyll-3-8-5:
    name: Build Jekyll site (v3.8.5)
    runs-on: ubuntu-latest
    steps:

    - uses: actions/checkout@v2

    - name: Build the site in the jekyll/builder container
      run: |
        docker run --rm \
        --volume="${{ github.workspace }}:/srv/jekyll" \
        jekyll/builder:3.8.5 /bin/bash -c "gem install bundler && chmod -R 777 /srv/jekyll && bundle install && bundle exec jekyll build && bundle exec rake search:init"

  assets:
    name: Test CSS and JS
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - name: Use Node.js 12.x
      uses: actions/setup-node@v1
      with:
        node-version: '12.x'
    - run: npm install
    - run: npm test



================================================
FILE: .github/workflows/publish-gem.yml
================================================
name: Publish Ruby Gem

on:
  workflow_dispatch

jobs:
  build:
    name: Publish
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - name: Set up Ruby 2.6
      uses: actions/setup-ruby@v1
      with:
        ruby-version: 2.6.x

    - name: Publish to GPR
      run: |
        mkdir -p $HOME/.gem
        touch $HOME/.gem/credentials
        chmod 0600 $HOME/.gem/credentials
        printf -- "---\n:github: ${GEM_HOST_API_KEY}\n" > $HOME/.gem/credentials
        gem build *.gemspec
        gem push --KEY github --host https://rubygems.pkg.github.com/${OWNER} *.gem
      env:
        GEM_HOST_API_KEY: "Bearer ${{secrets.GITHUB_TOKEN}}"
        OWNER: ${{ github.repository_owner }}

    - name: Publish to RubyGems
      run: |
        mkdir -p $HOME/.gem
        touch $HOME/.gem/credentials
        chmod 0600 $HOME/.gem/credentials
        printf -- "---\n:rubygems_api_key: ${GEM_HOST_API_KEY}\n" > $HOME/.gem/credentials
        gem build *.gemspec
        gem push *.gem
      env:
        GEM_HOST_API_KEY: "${{secrets.RUBYGEMS_AUTH_TOKEN}}"


