<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Getting ESP32 to 12¬µA Sleep Current - Fridays with Faraday</title>
    <meta name="description" content="**Tags:** ESP32 ‚Ä¢ Low Power ‚Ä¢ Deep Sleep">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="alternate" type="application/rss+xml" title="Fridays with Faraday" href="/feed.xml">
</head>
<body>
    <div class="background"></div>
    <div class="grid-overlay"></div>

    
<nav>
  <div class="container">
    <a href="/" class="logo">
      <span class="logo-f">f</span><span class="logo-slash">/</span><span class="logo-f">f</span>
    </a>
    <ul class="nav-menu">
      <li><a href="/#work">Work</a></li>
      <li><a href="/experiments.html" class="active">Experiments</a></li>
      <li><a href="mailto:your.email@example.com">Contact</a></li>
    </ul>
    <div class="nav-search">
      <input type="text" id="search-input" placeholder="Search posts..." />
      <div id="search-results" class="search-results"></div>
    </div>
    <button class="nav-toggle" aria-label="Toggle menu">
      <span></span>
      <span></span>
      <span></span>
    </button>
  </div>
</nav>

    
    <section class="experiment-header">
        <div class="container">
            <h1 class="experiment-title">Getting ESP32 to 12¬µA Sleep Current</h1>
            
            <div class="post-header-meta">
              <div class="meta-row">
                <span class="meta-item">
                  <span class="meta-icon">üìÖ</span>
                  <time datetime="2025-11-02">November 2, 2025</time>
                </span>
                <span class="meta-item">
                  <span class="meta-icon">üìñ</span>
                  <span>4 min read</span>
                </span>
                <span class="meta-item">
                  <span class="meta-icon">üìù</span>
                  <span>665 words</span>
                </span>
                <span class="meta-item">
                  <span class="meta-icon">üéØ</span>
                  <span class="difficulty-badge difficulty-intermediate">Intermediate</span>
                </span>
              </div>
              <div class="post-actions">
                <button onclick="toggleDarkMode()" class="action-btn">üåì Theme</button>
                <button onclick="window.print()" class="action-btn">üñ®Ô∏è Print</button>
              </div>
            </div>
            <p class="post-description">**Tags:** ESP32 ‚Ä¢ Low Power ‚Ä¢ Deep Sleep</p>
        </div>
    </section>

    <section>
        <div class="container">
            <div class="content-layout">
                <nav class="table-of-contents"><h3>Table of Contents</h3><ul><li style="margin-left: 0px"><a href="#getting-esp32-to-12a-sleep-current" class="toc-link">Getting ESP32 to 12¬µA Sleep Current</a></li><li style="margin-left: 20px"><a href="#results" class="toc-link">Results</a></li><li style="margin-left: 20px"><a href="#the-problem" class="toc-link">The Problem</a></li><li style="margin-left: 20px"><a href="#baseline-measurement" class="toc-link">Baseline Measurement</a></li><li style="margin-left: 20px"><a href="#optimization-steps" class="toc-link">Optimization Steps</a></li><li style="margin-left: 40px"><a href="#1-disable-wifi-and-bluetooth" class="toc-link">1. Disable WiFi and Bluetooth</a></li><li style="margin-left: 40px"><a href="#2-configure-gpio-states" class="toc-link">2. Configure GPIO States</a></li><li style="margin-left: 40px"><a href="#3-power-domain-configuration" class="toc-link">3. Power Domain Configuration</a></li><li style="margin-left: 40px"><a href="#4-disable-internal-regulators" class="toc-link">4. Disable Internal Regulators</a></li><li style="margin-left: 40px"><a href="#5-external-component-check" class="toc-link">5. External Component Check</a></li><li style="margin-left: 20px"><a href="#final-implementation" class="toc-link">Final Implementation</a></li><li style="margin-left: 20px"><a href="#results" class="toc-link">Results</a></li><li style="margin-left: 20px"><a href="#lessons-learned" class="toc-link">Lessons Learned</a></li></ul></nav>
                <article class="content-section">
                    <p><h1 id="getting-esp32-to-12a-sleep-current">Getting ESP32 to 12¬µA Sleep Current</h1></p><p><strong>Tags:</strong> ESP32 ‚Ä¢ Low Power ‚Ä¢ Deep Sleep</p><p>Out of the box, ESP32 deep sleep pulls around 150¬µA. This documents how I got it down to 12¬µA by tweaking power domains, disabling peripherals, and configuring GPIO properly.</p><p><h2 id="results">Results</h2></p><p><tr><td>Metric</td><td>Value</td></tr>
<tr><td>--------</td><td>--------</td></tr>
<tr><td><strong>Sleep Current</strong></td><td>12¬µA</td></tr>
<tr><td><strong>Wake Time</strong></td><td>800ms</td></tr>
<tr><td><strong>Power Reduction</strong></td><td>92%</td></tr>
<tr><td><strong>CR2032 Battery Life</strong></td><td>3 Years</td></tr></p><p><h2 id="the-problem">The Problem</h2></p><p>I needed to run a sensor node on a coin cell for years. ESP32 is great for quick prototyping with WiFi, but the default deep sleep current of 150¬µA means a CR2032 battery (220mAh) would only last about 2 months. Not good enough.</p><p>The datasheet claims 10¬µA is possible in deep sleep, so I set out to figure out what was consuming all that extra power.</p><p><h2 id="baseline-measurement">Baseline Measurement</h2></p><p>First, I needed to know where I was starting from. Using a ¬µCurrent Gold in series with the power supply:</p><p>
<div class="terminal">
  <div class="terminal-header">
    <div class="terminal-dot" style="background: #ff5f56;"></div>
    <div class="terminal-dot" style="background: #ffbd2e;"></div>
    <div class="terminal-dot" style="background: #27c93f;"></div>
  </div>
  <div class="terminal-content">
    <pre>$ measure_current.py --mode deep_sleep
Entering deep sleep...
Average current: 147.3 ¬µA
Peak current: 152.1 ¬µA
‚ö† Target: 10-15 ¬µA (10x higher than expected!)</pre>
  </div>
</div></p><p><div class="code-block"><pre><code class="language-c">// Initial naive deep sleep code
void enter_deep_sleep() {
    esp_sleep_enable_timer_wakeup(60 * 1000000); // 60 seconds
    esp_deep_sleep_start();
}</code></pre></div></p><p><h2 id="optimization-steps">Optimization Steps</h2></p><p><h3 id="1-disable-wifi-and-bluetooth">1. Disable WiFi and Bluetooth</h3></p><p>Even though they're not actively used, the radios can leak current.</p><p><div class="code-block"><pre><code class="language-c">void disable_radios() {
    esp_wifi_stop();
    esp_bt_controller_disable();
    // Result: 147¬µA ‚Üí 138¬µA (9¬µA saved)
}</code></pre></div></p><p><h3 id="2-configure-gpio-states">2. Configure GPIO States</h3></p><p>This was the big one. Floating GPIO pins can cause significant current draw. Each pin needs to be explicitly configured.</p><p><div class="code-block"><pre><code class="language-c">void configure_gpio_for_sleep() {
    // Disable all GPIO pull-ups/pull-downs except RTC pins
    for (int i = 0; i &lt; GPIO_NUM_MAX; i++) {
        if (!rtc_gpio_is_valid_gpio(i)) {
            gpio_reset_pin(i);
            gpio_set_direction(i, GPIO_MODE_INPUT);
            gpio_set_pull_mode(i, GPIO_FLOATING);
        }
    }
    
    // Configure RTC GPIO for wake-up if needed
    rtc_gpio_pullup_en(GPIO_NUM_33);
    rtc_gpio_pulldown_dis(GPIO_NUM_33);
    
    // Result: 138¬µA ‚Üí 45¬µA (93¬µA saved!)
}</code></pre></div></p><p><h3 id="3-power-domain-configuration">3. Power Domain Configuration</h3></p><p>ESP32 has multiple power domains. Shutting down unused ones helps significantly.</p><p><div class="code-block"><pre><code class="language-c">void configure_power_domains() {
    // Keep only RTC_SLOW_MEM powered in deep sleep
    esp_sleep_pd_config(ESP_PD_DOMAIN_RTC_PERIPH, ESP_PD_OPTION_OFF);
    esp_sleep_pd_config(ESP_PD_DOMAIN_RTC_SLOW_MEM, ESP_PD_OPTION_ON);
    esp_sleep_pd_config(ESP_PD_DOMAIN_RTC_FAST_MEM, ESP_PD_OPTION_OFF);
    esp_sleep_pd_config(ESP_PD_DOMAIN_XTAL, ESP_PD_OPTION_OFF);
    
    // Result: 45¬µA ‚Üí 28¬µA (17¬µA saved)
}</code></pre></div></p><p><h3 id="4-disable-internal-regulators">4. Disable Internal Regulators</h3></p><p>Some internal voltage regulators can be disabled if using external power supply regulation.</p><p><div class="code-block"><pre><code class="language-c">// Reduce internal regulator current in deep sleep
esp_sleep_pd_config(ESP_PD_DOMAIN_RTC_PERIPH, ESP_PD_OPTION_OFF);</p><p>// Use external 3.3V regulator, disable internal LDO
REG_CLR_BIT(RTC_CNTL_REG, RTC_CNTL_REGULATOR_FORCE_PU);</p><p>// Result: 28¬µA ‚Üí 15¬µA (13¬µA saved)</code></pre></div></p><p><h3 id="5-external-component-check">5. External Component Check</h3></p><p>Don't forget about external components! The devboard had a power LED that drew 3¬µA.</p><p><div class="code-block"><pre><code class="language-c">// Physical modification: remove power LED
// Also verified no pull-ups on I2C lines (they were adding 2¬µA each)</p><p>// Result: 15¬µA ‚Üí 12¬µA (3¬µA saved)</code></pre></div></p><p><h2 id="final-implementation">Final Implementation</h2></p><p>Here's the complete optimized sleep function:</p><p><div class="code-block"><pre><code class="language-c">#include &quot;esp_sleep.h&quot;
#include &quot;driver/rtc_io.h&quot;</p><p>void enter_ultra_low_power_sleep(uint64_t sleep_time_us) {
    // 1. Disable radios
    esp_wifi_stop();
    esp_bt_controller_disable();
    
    // 2. Configure all GPIO
    for (int i = 0; i &lt; GPIO_NUM_MAX; i++) {
        if (!rtc_gpio_is_valid_gpio(i)) {
            gpio_reset_pin(i);
            gpio_set_direction(i, GPIO_MODE_INPUT);
            gpio_set_pull_mode(i, GPIO_FLOATING);
        }
    }
    
    // 3. Configure power domains
    esp_sleep_pd_config(ESP_PD_DOMAIN_RTC_PERIPH, ESP_PD_OPTION_OFF);
    esp_sleep_pd_config(ESP_PD_DOMAIN_RTC_SLOW_MEM, ESP_PD_OPTION_ON);
    esp_sleep_pd_config(ESP_PD_DOMAIN_RTC_FAST_MEM, ESP_PD_OPTION_OFF);
    esp_sleep_pd_config(ESP_PD_DOMAIN_XTAL, ESP_PD_OPTION_OFF);
    
    // 4. Disable unnecessary regulators
    REG_CLR_BIT(RTC_CNTL_REG, RTC_CNTL_REGULATOR_FORCE_PU);
    
    // 5. Set wake time and sleep
    esp_sleep_enable_timer_wakeup(sleep_time_us);
    esp_deep_sleep_start();
}</code></pre></div></p><p><h2 id="results">Results</h2></p><p>Final measurement with the optimized code:</p><p>
<div class="terminal">
  <div class="terminal-header">
    <div class="terminal-dot" style="background: #ff5f56;"></div>
    <div class="terminal-dot" style="background: #ffbd2e;"></div>
    <div class="terminal-dot" style="background: #27c93f;"></div>
  </div>
  <div class="terminal-content">
    <pre>$ measure_current.py --mode deep_sleep
Entering deep sleep...
Average current: 12.1 ¬µA
Peak current: 13.4 ¬µA
‚úì Target achieved! 92% reduction from baseline</p><p>$ calculate_battery_life --capacity 220 --current 12.1
Estimated battery life: 2.08 years (CR2032)</pre>
  </div>
</div></p><p><h2 id="lessons-learned">Lessons Learned</h2></p><p>‚Ä¢ <strong>GPIO configuration was the biggest win (93¬µA saved).</strong> Always configure every pin explicitly.  
‚Ä¢ Don't trust devboards for power measurements - they have extra components that consume power.  
‚Ä¢ The datasheet is optimistic but achievable with proper configuration.  
‚Ä¢ Use an actual current meter, not just multimeter - you need ¬µA resolution.  
‚Ä¢ Document your baseline before optimizing - you need to know what you're improving from.</p><p><hr></p><p>*<a href="../experiments.html" target="_blank" rel="noopener">‚Üê Back to all experiments</a>*</p>
                </article>
            </div>
            
            
    <div class="social-sharing">
      <h4>Share this post</h4>
      <div class="share-buttons">
        <a href="https://twitter.com/intent/tweet?text=Getting%20ESP32%20to%2012%C2%B5A%20Sleep%20Current&url=https%3A%2F%2Fyour-domain.com%2Fexperiments%2Fesp32-low-power.html" 
           target="_blank" rel="noopener" class="share-btn twitter">Twitter</a>
        <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fyour-domain.com%2Fexperiments%2Fesp32-low-power.html" 
           target="_blank" rel="noopener" class="share-btn linkedin">LinkedIn</a>
        <a href="mailto:?subject=Getting%20ESP32%20to%2012%C2%B5A%20Sleep%20Current&body=**Tags%3A**%20ESP32%20%E2%80%A2%20Low%20Power%20%E2%80%A2%20Deep%20Sleep%0A%0Ahttps%3A%2F%2Fyour-domain.com%2Fexperiments%2Fesp32-low-power.html" 
           class="share-btn email">Email</a>
        <button onclick="navigator.clipboard.writeText('https://your-domain.com/experiments/esp32-low-power.html'); this.innerHTML='Copied!'; setTimeout(() => this.innerHTML='Copy Link', 2000);" 
                class="share-btn copy">Copy Link</button>
      </div>
    </div>
  
            <div class="post-navigation"><div class="nav-previous">
                  <a href="experiments/bootloader.html">
                    <span class="nav-label">‚Üê Previous</span>
                    <span class="nav-title">Minimal Bare Metal Bootloader</span>
                  </a>
                </div><div class="nav-next">
                  <a href="experiments/stm32-dma.html">
                    <span class="nav-label">Next ‚Üí</span>
                    <span class="nav-title">High-Speed ADC with DMA</span>
                  </a>
                </div></div>
            
    <section class="related-posts">
      <h3>Related Posts</h3>
      <div class="related-grid">
        
          <article class="related-post">
            <h4><a href="experiments/bootloader.html">Minimal Bare Metal Bootloader</a></h4>
            <p>**ARM Cortex-M4** ‚Ä¢ **Bootloader** ‚Ä¢ **Assembly**...</p>
            <div class="related-meta">
              <span class="reading-time">6 min read</span>
              <span class="difficulty">Beginner</span>
            </div>
          </article>
        
          <article class="related-post">
            <h4><a href="experiments/stm32-dma.html">High-Speed ADC with DMA</a></h4>
            <p>**STM32F4** **DMA** **ADC**...</p>
            <div class="related-meta">
              <span class="reading-time">5 min read</span>
              <span class="difficulty">Beginner</span>
            </div>
          </article>
        
      </div>
    </section>
  
            
            <div style="margin-top: 3rem; padding-top: 2rem; border-top: 1px solid var(--border);">
                <a href="/experiments.html" style="color: var(--accent); text-decoration: none;">‚Üê Back to all experiments</a>
            </div>
        </div>
    </section>

    
<footer>
  <div class="container">
    <div class="footer-content">
      <div class="footer-logo">
        <span class="logo-f">f</span><span class="logo-slash">/</span><span class="logo-f">f</span>
      </div>
      <p>Fridays with Faraday - Working with microcontrollers and embedded systems</p>
    </div>
  </div>
</footer>

    <script src="/js/main.js"></script>
</body>
</html>
