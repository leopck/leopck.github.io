Directory structure:
└── components/
    ├── AuthorBio.astro
    ├── Footer.astro
    ├── Header.astro
    ├── PostCard.astro
    ├── PostMeta.astro
    ├── RelatedPosts.astro
    ├── SeriesNav.astro
    ├── TableOfContents.astro
    ├── interactive/
    │   └── RooflinePlot.astro
    └── mdx/
        ├── Benchmark.astro
        ├── Callout.astro
        ├── CodeCompare.astro
        ├── index.ts
        ├── MemoryLayout.astro
        ├── PerfChart.astro
        ├── RegisterDiagram.astro
        └── Theorem.astro

================================================
FILE: AuthorBio.astro
================================================
---
// src/components/AuthorBio.astro
interface Props {
  authorData: {
    name: string;
    bio: string;
    avatar: string;
    github?: string;
  };
}

const { authorData } = Astro.props;
---

<div class="author-bio">
  <div class="author-avatar">
    {authorData.avatar ? (
      <img src={authorData.avatar} alt={authorData.name} class="avatar-img" />
    ) : (
      <div class="avatar-placeholder">âš¡</div>
    )}
  </div>
  <div class="author-info">
    <div class="author-header">
      <h3 class="author-name">{authorData.name}</h3>
      <div class="author-social">
        {authorData.github && (
          <a 
            href={authorData.github}
            target="_blank"
            rel="noopener noreferrer"
            aria-label="GitHub profile"
          >
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
            </svg>
          </a>
        )}
      </div>
    </div>
    <p class="author-description">{authorData.bio}</p>
  </div>
</div>

<style lang="scss">
  @use '../styles/variables' as *;
  
  .author-bio {
    display: flex;
    gap: $space-5;
    padding: $space-6;
    background: $color-bg-tertiary;
    border-radius: $border-radius-lg;
    border: 1px solid $color-border-default;
  }
  
  .author-avatar {
    flex-shrink: 0;
  }
  
  .avatar-img {
    width: 64px;
    height: 64px;
    object-fit: cover;
    border-radius: $border-radius-full;
    border: 2px solid $color-accent-blue;
  }

  .avatar-placeholder {
    width: 64px;
    height: 64px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    background: $color-bg-secondary;
    border-radius: $border-radius-full;
    border: 2px solid $color-accent-blue;
  }
  
  // ... Keep the rest of your original SCSS ...
</style>


================================================
FILE: Footer.astro
================================================
---
const currentYear = new Date().getFullYear();

const categories = [
  { label: 'Microcontrollers', href: '/categories/microcontrollers' },
  { label: 'vLLM', href: '/categories/vllm' },
  { label: 'LLM Inference', href: '/categories/llm-inference' },
  { label: 'Hardware', href: '/categories/hardware-optimization' },
  { label: 'Profiling', href: '/categories/profiling' },
  { label: 'GPU Programming', href: '/categories/gpu-programming' },
];

const resources = [
  { label: 'About', href: '/about' },
  { label: 'RSS Feed', href: '/rss.xml' },
  { label: 'Sitemap', href: '/sitemap-index.xml' },
  { label: 'GitHub', href: 'https://github.com/leopck/leopck.github.io', external: true },
];
---

<footer class="site-footer">
  <div class="footer-container">
    <div class="footer-main">
      <!-- Brand Column -->
      <div class="footer-brand">
        <a href="/" class="footer-logo">
          <span class="logo-icon">âš¡</span>
          <span class="logo-text">Fridays with Faraday</span>
        </a>
        <p class="footer-description">
          Deep technical explorations in systems performance optimization, 
          from bare-metal microcontrollers to large-scale LLM inference systems.
        </p>
        <div class="footer-social">
          <a href="https://github.com/leopck" target="_blank" rel="noopener noreferrer" aria-label="GitHub">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
            </svg>
          </a>
          <a href="/rss.xml" aria-label="RSS Feed">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M4 11a9 9 0 0 1 9 9"></path>
              <path d="M4 4a16 16 0 0 1 16 16"></path>
              <circle cx="5" cy="19" r="1"></circle>
            </svg>
          </a>
        </div>
      </div>
      
      <!-- Categories Column -->
      <div class="footer-column">
        <h4 class="footer-heading">Categories</h4>
        <ul class="footer-links">
          {categories.map((item) => (
            <li>
              <a href={item.href}>{item.label}</a>
            </li>
          ))}
        </ul>
      </div>
      
      <!-- Resources Column -->
      <div class="footer-column">
        <h4 class="footer-heading">Resources</h4>
        <ul class="footer-links">
          {resources.map((item) => (
            <li>
              <a 
                href={item.href}
                target={item.external ? '_blank' : undefined}
                rel={item.external ? 'noopener noreferrer' : undefined}
              >
                {item.label}
                {item.external && (
                  <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="external-icon">
                    <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                    <polyline points="15 3 21 3 21 9"></polyline>
                    <line x1="10" y1="14" x2="21" y2="3"></line>
                  </svg>
                )}
              </a>
            </li>
          ))}
        </ul>
      </div>
    </div>
    
    <!-- Bottom Bar -->
    <div class="footer-bottom">
      <p class="copyright">
        Â© {currentYear} Fridays with Faraday. Built with 
        <a href="https://astro.build" target="_blank" rel="noopener noreferrer">Astro</a>.
      </p>
      <p class="footer-tagline">
        "Measure. Optimize. Repeat."
      </p>
    </div>
  </div>
</footer>

<style lang="scss">
  @use '../styles/variables' as *;
  
  .site-footer {
    background: $color-bg-secondary;
    border-top: 1px solid $color-border-default;
    padding: $space-16 0 $space-8;
  }
  
  .footer-container {
    @include container;
  }
  
  .footer-main {
    display: grid;
    gap: $space-12;
    
    @include respond-to(md) {
      grid-template-columns: 2fr 1fr 1fr;
      gap: $space-16;
    }
  }
  
  .footer-brand {
    max-width: 400px;
  }
  
  .footer-logo {
    display: inline-flex;
    align-items: center;
    gap: $space-2;
    text-decoration: none;
    color: $color-text-primary;
    margin-bottom: $space-4;
    
    &:hover {
      text-decoration: none;
    }
    
    .logo-icon {
      font-size: 1.25rem;
    }
    
    .logo-text {
      font-family: $font-display;
      font-weight: $font-weight-bold;
      font-size: $font-size-lg;
    }
  }
  
  .footer-description {
    color: $color-text-secondary;
    font-size: $font-size-sm;
    line-height: $line-height-relaxed;
    margin-bottom: $space-6;
  }
  
  .footer-social {
    display: flex;
    gap: $space-3;
    
    a {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      color: $color-text-secondary;
      background: $color-bg-tertiary;
      border-radius: $border-radius-md;
      transition: all $transition-fast;
      
      &:hover {
        color: $color-text-primary;
        background: $color-bg-elevated;
      }
    }
  }
  
  .footer-column {
    @include respond-to(md) {
      padding-top: $space-2;
    }
  }
  
  .footer-heading {
    font-family: $font-mono;
    font-size: $font-size-xs;
    font-weight: $font-weight-semibold;
    text-transform: uppercase;
    letter-spacing: $letter-spacing-wider;
    color: $color-text-tertiary;
    margin-bottom: $space-4;
  }
  
  .footer-links {
    list-style: none;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    gap: $space-2;
    
    a {
      display: inline-flex;
      align-items: center;
      gap: $space-1;
      font-size: $font-size-sm;
      color: $color-text-secondary;
      text-decoration: none;
      transition: color $transition-fast;
      
      &:hover {
        color: $color-text-primary;
      }
      
      .external-icon {
        opacity: 0.5;
      }
    }
  }
  
  .footer-bottom {
    display: flex;
    flex-direction: column;
    gap: $space-2;
    margin-top: $space-12;
    padding-top: $space-8;
    border-top: 1px solid $color-border-default;
    
    @include respond-to(md) {
      flex-direction: row;
      justify-content: space-between;
      align-items: center;
    }
  }
  
  .copyright {
    font-size: $font-size-sm;
    color: $color-text-tertiary;
    margin: 0;
    
    a {
      color: $color-text-secondary;
      
      &:hover {
        color: $color-accent-blue;
      }
    }
  }
  
  .footer-tagline {
    font-family: $font-mono;
    font-size: $font-size-xs;
    color: $color-text-tertiary;
    margin: 0;
  }
</style>



================================================
FILE: Header.astro
================================================
---
const navItems = [
  { label: 'Posts', href: '/posts' },
  { label: 'Categories', href: '/categories' },
  { label: 'Series', href: '/series' },
  { label: 'About', href: '/about' },
];

const currentPath = Astro.url.pathname;
---

<header class="site-header">
  <div class="header-container">
    <a href="/" class="logo" aria-label="Home">
      <span class="logo-icon">âš¡</span>
      <span class="logo-text">
        <span class="logo-primary">Fridays</span>
        <span class="logo-secondary">with Faraday</span>
      </span>
    </a>
    
    <nav class="nav-desktop" aria-label="Main navigation">
      <ul class="nav-list">
        {navItems.map((item) => (
          <li>
            <a 
              href={item.href}
              class:list={['nav-link', { active: currentPath.startsWith(item.href) }]}
            >
              {item.label}
            </a>
          </li>
        ))}
      </ul>
    </nav>
    
    <div class="header-actions">
      <button 
        class="search-btn" 
        aria-label="Search"
        data-search-trigger
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.3-4.3"></path>
        </svg>
        <span class="search-shortcut">âŒ˜K</span>
      </button>
      
      <a 
        href="https://github.com/leopck/leopck.github.io" 
        class="github-link"
        target="_blank"
        rel="noopener noreferrer"
        aria-label="GitHub repository"
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
        </svg>
      </a>
      
      <button 
        class="mobile-menu-btn"
        aria-label="Toggle menu"
        aria-expanded="false"
        data-mobile-menu-toggle
      >
        <span class="hamburger"></span>
      </button>
    </div>
  </div>
  
  <nav class="nav-mobile" aria-label="Mobile navigation" hidden>
    <ul class="nav-mobile-list">
      {navItems.map((item) => (
        <li>
          <a 
            href={item.href}
            class:list={['nav-mobile-link', { active: currentPath.startsWith(item.href) }]}
          >
            {item.label}
          </a>
        </li>
      ))}
    </ul>
  </nav>
</header>

<div class="search-modal" hidden data-search-modal>
  <div class="search-modal-backdrop" data-search-close></div>
  <div class="search-modal-content">
    <div class="p-6">
       <div id="search" class="w-full"></div>
    </div>
    
    <link href="/_pagefind/pagefind-ui.css" rel="stylesheet">
    <script src="/_pagefind/pagefind-ui.js" is:inline></script>
  </div>
</div>

<script>
  // Search Modal UI initialization
  window.addEventListener('DOMContentLoaded', () => {
    // @ts-ignore
    new PagefindUI({ 
      element: "#search", 
      showSubResults: true,
      translations: { placeholder: "Search engineering deep-dives..." },
      resetStyles: false // Let it inherit blog styles
    });
  });

  // Mobile menu toggle
  const mobileMenuBtn = document.querySelector('[data-mobile-menu-toggle]');
  const mobileNav = document.querySelector('.nav-mobile');
  
  mobileMenuBtn?.addEventListener('click', () => {
    const isExpanded = mobileMenuBtn.getAttribute('aria-expanded') === 'true';
    mobileMenuBtn.setAttribute('aria-expanded', String(!isExpanded));
    mobileNav?.toggleAttribute('hidden');
    document.body.classList.toggle('menu-open');
  });
  
  // Search modal
  const searchTrigger = document.querySelector('[data-search-trigger]');
  const searchModal = document.querySelector('[data-search-modal]');
  const searchClose = document.querySelector('[data-search-close]');
  
  function openSearch() {
    searchModal?.removeAttribute('hidden');
    document.body.style.overflow = 'hidden';
  }
  
  function closeSearch() {
    searchModal?.setAttribute('hidden', '');
    document.body.style.overflow = '';
  }
  
  searchTrigger?.addEventListener('click', openSearch);
  searchClose?.addEventListener('click', closeSearch);
  
  // Keyboard shortcuts
  document.addEventListener('keydown', (e) => {
    if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
      e.preventDefault();
      openSearch();
    }
    if (e.key === 'Escape') {
      closeSearch();
    }
  });
  
  // Header scroll behavior
  let lastScroll = 0;
  const header = document.querySelector('.site-header');
  
  window.addEventListener('scroll', () => {
    const currentScroll = window.scrollY;
    
    if (currentScroll > 100) {
      header?.classList.add('scrolled');
    } else {
      header?.classList.remove('scrolled');
    }
    
    if (currentScroll > lastScroll && currentScroll > 200) {
      header?.classList.add('hidden');
    } else {
      header?.classList.remove('hidden');
    }
    
    lastScroll = currentScroll;
  });
</script>

<style lang="scss">
  @use '../styles/variables' as *;
  
  /* Modal Content Padding Adjustment for Search */
  .p-6 { padding: 1.5rem; }

  .site-header {
    position: sticky;
    top: 0;
    z-index: $z-index-sticky;
    height: $header-height;
    background: rgba($color-bg-primary, 0.85);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border-bottom: 1px solid transparent;
    transition: all $transition-base;
    
    &.scrolled {
      border-bottom-color: $color-border-default;
    }
    
    &.hidden {
      transform: translateY(-100%);
    }
  }
  
  .header-container {
    @include container;
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 100%;
    gap: $space-4;
  }
  
  .logo {
    display: flex;
    align-items: center;
    gap: $space-3;
    text-decoration: none;
    color: $color-text-primary;
    
    &:hover {
      text-decoration: none;
      
      .logo-icon {
        transform: scale(1.1);
      }
    }
  }
  
  .logo-icon {
    font-size: 1.5rem;
    transition: transform $transition-fast;
  }
  
  .logo-text {
    display: flex;
    flex-direction: column;
    line-height: 1.1;
  }
  
  .logo-primary {
    font-family: $font-display;
    font-weight: $font-weight-bold;
    font-size: $font-size-md;
    letter-spacing: $letter-spacing-tight;
  }
  
  .logo-secondary {
    font-size: $font-size-xs;
    color: $color-text-secondary;
    font-weight: $font-weight-medium;
  }
  
  .nav-desktop {
    display: none;
    
    @include respond-to(md) {
      display: block;
    }
  }
  
  .nav-list {
    display: flex;
    gap: $space-1;
    list-style: none;
    margin: 0;
    padding: 0;
  }
  
  .nav-link {
    display: block;
    padding: $space-2 $space-3;
    font-size: $font-size-sm;
    font-weight: $font-weight-medium;
    color: $color-text-secondary;
    text-decoration: none;
    border-radius: $border-radius-md;
    transition: all $transition-fast;
    
    &:hover {
      color: $color-text-primary;
      background: $color-bg-tertiary;
      text-decoration: none;
    }
    
    &.active {
      color: $color-accent-blue;
      background: rgba($color-accent-blue, 0.1);
    }
  }
  
  .header-actions {
    display: flex;
    align-items: center;
    gap: $space-2;
  }
  
  .search-btn {
    display: flex;
    align-items: center;
    gap: $space-2;
    padding: $space-2 $space-3;
    background: $color-bg-tertiary;
    border: 1px solid $color-border-default;
    border-radius: $border-radius-md;
    color: $color-text-secondary;
    cursor: pointer;
    transition: all $transition-fast;
    
    &:hover {
      border-color: $color-border-emphasis;
      color: $color-text-primary;
    }
  }
  
  .search-shortcut {
    font-family: $font-mono;
    font-size: $font-size-xs;
    padding: 0.125rem 0.375rem;
    background: $color-bg-secondary;
    border-radius: $border-radius-sm;
    display: none;
    
    @include respond-to(md) {
      display: inline;
    }
  }
  
  .github-link {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    color: $color-text-secondary;
    border-radius: $border-radius-md;
    transition: all $transition-fast;
    
    &:hover {
      color: $color-text-primary;
      background: $color-bg-tertiary;
    }
  }
  
  .mobile-menu-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    background: none;
    border: none;
    cursor: pointer;
    
    @include respond-to(md) {
      display: none;
    }
  }
  
  .hamburger {
    position: relative;
    width: 20px;
    height: 2px;
    background: $color-text-primary;
    border-radius: 1px;
    transition: all $transition-fast;
    
    &::before,
    &::after {
      content: '';
      position: absolute;
      left: 0;
      width: 100%;
      height: 2px;
      background: $color-text-primary;
      border-radius: 1px;
      transition: all $transition-fast;
    }
    
    &::before {
      top: -6px;
    }
    
    &::after {
      bottom: -6px;
    }
    
    [aria-expanded="true"] & {
      background: transparent;
      
      &::before {
        top: 0;
        transform: rotate(45deg);
      }
      
      &::after {
        bottom: 0;
        transform: rotate(-45deg);
      }
    }
  }
  
  .nav-mobile {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: $color-bg-secondary;
    border-bottom: 1px solid $color-border-default;
    padding: $space-4;
    
    &[hidden] {
      display: none;
    }
    
    @include respond-to(md) {
      display: none !important;
    }
  }
  
  .nav-mobile-list {
    list-style: none;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    gap: $space-1;
  }
  
  .nav-mobile-link {
    display: block;
    padding: $space-3 $space-4;
    font-size: $font-size-base;
    font-weight: $font-weight-medium;
    color: $color-text-secondary;
    text-decoration: none;
    border-radius: $border-radius-md;
    transition: all $transition-fast;
    
    &:hover,
    &.active {
      color: $color-text-primary;
      background: $color-bg-tertiary;
    }
  }
  
  // Search Modal
  .search-modal {
    position: fixed;
    inset: 0;
    z-index: $z-index-modal;
    display: flex;
    align-items: flex-start;
    justify-content: center;
    padding-top: 10vh;
    
    &[hidden] {
      display: none;
    }
  }
  
  .search-modal-backdrop {
    position: absolute;
    inset: 0;
    background: rgba($color-bg-primary, 0.8);
    backdrop-filter: blur(4px);
  }
  
  .search-modal-content {
    position: relative;
    width: 100%;
    max-width: 600px;
    margin: 0 $space-4;
    background: $color-bg-secondary;
    border: 1px solid $color-border-default;
    border-radius: $border-radius-xl;
    box-shadow: $shadow-xl;
    overflow: hidden;
  }
</style>


================================================
FILE: PostCard.astro
================================================
Error reading file with 'cp1252': 'charmap' codec can't decode byte 0x90 in position 2161: character maps to <undefined>


================================================
FILE: PostMeta.astro
================================================
---
interface Props {
  publishDate: Date;
  updatedDate?: Date;
  author: string;
  readingTime: number;
  tags: string[];
}

const { publishDate, updatedDate, author, readingTime, tags } = Astro.props;

const formatDate = (date: Date) => {
  return new Intl.DateTimeFormat('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  }).format(date);
};
---

<div class="post-meta">
  <div class="meta-row">
    <div class="meta-item">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
        <line x1="16" y1="2" x2="16" y2="6"></line>
        <line x1="8" y1="2" x2="8" y2="6"></line>
        <line x1="3" y1="10" x2="21" y2="10"></line>
      </svg>
      <time datetime={publishDate.toISOString()}>
        {formatDate(publishDate)}
      </time>
      {updatedDate && (
        <span class="updated">
          (Updated: <time datetime={updatedDate.toISOString()}>{formatDate(updatedDate)}</time>)
        </span>
      )}
    </div>
    
    <div class="meta-item">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"></circle>
        <polyline points="12 6 12 12 16 14"></polyline>
      </svg>
      <span>{readingTime} min read</span>
    </div>
    
    <div class="meta-item">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
        <circle cx="12" cy="7" r="4"></circle>
      </svg>
      <span>{author}</span>
    </div>
  </div>
</div>

<style lang="scss">
  @use '../styles/variables' as *;
  
  .post-meta {
    color: $color-text-secondary;
    font-size: $font-size-sm;
  }
  
  .meta-row {
    display: flex;
    flex-wrap: wrap;
    gap: $space-4;
  }
  
  .meta-item {
    display: flex;
    align-items: center;
    gap: $space-2;
    
    svg {
      flex-shrink: 0;
      opacity: 0.6;
    }
  }
  
  .updated {
    color: $color-text-tertiary;
    font-size: $font-size-xs;
  }
</style>



================================================
FILE: RelatedPosts.astro
================================================
---
// RelatedPosts Component
import { getCollection } from 'astro:content';
import PostCard from './PostCard.astro';

interface Props {
  currentSlug: string;
  category: string;
  tags: string[];
}

const { currentSlug, category, tags } = Astro.props;

const allPosts = await getCollection('posts', ({ data }) => !data.draft);

// Score posts by relevance
const scoredPosts = allPosts
  .filter((post) => post.slug !== currentSlug)
  .map((post) => {
    let score = 0;
    
    // Same category = 3 points
    if (post.data.category === category) score += 3;
    
    // Each matching tag = 1 point
    const matchingTags = post.data.tags.filter((tag) => tags.includes(tag));
    score += matchingTags.length;
    
    return { post, score };
  })
  .filter(({ score }) => score > 0)
  .sort((a, b) => b.score - a.score)
  .slice(0, 3);

const relatedPosts = scoredPosts.map(({ post }) => post);
---

{relatedPosts.length > 0 && (
  <section class="related-posts">
    <h2 class="related-posts-title">Related Posts</h2>
    <div class="related-posts-grid">
      {relatedPosts.map((post) => (
        <PostCard post={post} />
      ))}
    </div>
  </section>
)}

<style lang="scss">
  @use '../styles/variables' as *;
  
  .related-posts {
    margin-top: $space-12;
  }
  
  .related-posts-title {
    font-family: $font-display;
    font-size: $font-size-xl;
    margin-bottom: $space-6;
  }
  
  .related-posts-grid {
    display: grid;
    gap: $space-6;
    
    @include respond-to(md) {
      grid-template-columns: repeat(2, 1fr);
    }
    
    @include respond-to(lg) {
      grid-template-columns: repeat(3, 1fr);
    }
  }
</style>



================================================
FILE: SeriesNav.astro
================================================
---
import { getCollection } from 'astro:content';

interface Props {
  series: string;
  currentOrder: number;
}

const { series, currentOrder } = Astro.props;

const allPosts = await getCollection('posts', ({ data }) => 
  !data.draft && data.series === series
);

const sortedPosts = allPosts.sort((a, b) => 
  (a.data.seriesOrder || 0) - (b.data.seriesOrder || 0)
);

const currentIndex = sortedPosts.findIndex((p) => p.data.seriesOrder === currentOrder);
const prevPost = currentIndex > 0 ? sortedPosts[currentIndex - 1] : null;
const nextPost = currentIndex < sortedPosts.length - 1 ? sortedPosts[currentIndex + 1] : null;
---

<div class="series-nav">
  <div class="series-header">
    <span class="series-label">Part of Series</span>
    <span class="series-name">{series}</span>
    <span class="series-progress">
      {currentOrder} of {sortedPosts.length}
    </span>
  </div>
  
  <div class="series-parts">
    {sortedPosts.map((post, index) => (
      <a 
        href={`/posts/${post.slug}`}
        class:list={[
          'series-part',
          { 
            'current': post.data.seriesOrder === currentOrder,
            'completed': (post.data.seriesOrder || 0) < currentOrder
          }
        ]}
        aria-current={post.data.seriesOrder === currentOrder ? 'page' : undefined}
      >
        <span class="part-number">{index + 1}</span>
        <span class="part-title">{post.data.title}</span>
      </a>
    ))}
  </div>
  
  <div class="series-navigation">
    {prevPost ? (
      <a href={`/posts/${prevPost.slug}`} class="nav-btn prev">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
        <span>Previous: {prevPost.data.title}</span>
      </a>
    ) : (
      <div></div>
    )}
    
    {nextPost ? (
      <a href={`/posts/${nextPost.slug}`} class="nav-btn next">
        <span>Next: {nextPost.data.title}</span>
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </a>
    ) : (
      <div></div>
    )}
  </div>
</div>

<style lang="scss">
  @use '../styles/variables' as *;
  
  .series-nav {
    margin-bottom: $space-8;
    padding: $space-5;
    background: $color-bg-secondary;
    border: 1px solid $color-border-default;
    border-radius: $border-radius-lg;
  }
  
  .series-header {
    display: flex;
    align-items: center;
    gap: $space-3;
    margin-bottom: $space-4;
    padding-bottom: $space-4;
    border-bottom: 1px solid $color-border-default;
  }
  
  .series-label {
    font-size: $font-size-xs;
    font-family: $font-mono;
    text-transform: uppercase;
    letter-spacing: $letter-spacing-wider;
    color: $color-text-tertiary;
  }
  
  .series-name {
    font-family: $font-display;
    font-weight: $font-weight-semibold;
    color: $color-accent-blue;
    flex: 1;
  }
  
  .series-progress {
    font-size: $font-size-sm;
    font-family: $font-mono;
    color: $color-text-secondary;
    padding: $space-1 $space-2;
    background: $color-bg-tertiary;
    border-radius: $border-radius-sm;
  }
  
  .series-parts {
    display: flex;
    flex-direction: column;
    gap: $space-2;
    margin-bottom: $space-4;
  }
  
  .series-part {
    display: flex;
    align-items: center;
    gap: $space-3;
    padding: $space-2 $space-3;
    text-decoration: none;
    border-radius: $border-radius-md;
    transition: all $transition-fast;
    
    &:hover {
      background: $color-bg-tertiary;
      text-decoration: none;
    }
    
    &.current {
      background: rgba($color-accent-blue, 0.1);
      
      .part-number {
        background: $color-accent-blue;
        color: $color-bg-primary;
      }
      
      .part-title {
        color: $color-accent-blue;
        font-weight: $font-weight-medium;
      }
    }
    
    &.completed {
      .part-number {
        background: $color-accent-green;
        color: $color-bg-primary;
        
        &::after {
          content: 'âœ“';
          font-size: 0.7em;
        }
      }
    }
  }
  
  .part-number {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 24px;
    height: 24px;
    font-size: $font-size-xs;
    font-family: $font-mono;
    font-weight: $font-weight-semibold;
    background: $color-bg-tertiary;
    color: $color-text-secondary;
    border-radius: $border-radius-full;
    flex-shrink: 0;
  }
  
  .part-title {
    font-size: $font-size-sm;
    color: $color-text-secondary;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  
  .series-navigation {
    display: flex;
    justify-content: space-between;
    gap: $space-4;
    padding-top: $space-4;
    border-top: 1px solid $color-border-default;
  }
  
  .nav-btn {
    display: flex;
    align-items: center;
    gap: $space-2;
    padding: $space-2 $space-3;
    font-size: $font-size-sm;
    color: $color-text-secondary;
    text-decoration: none;
    border-radius: $border-radius-md;
    background: $color-bg-tertiary;
    transition: all $transition-fast;
    max-width: 45%;
    
    &:hover {
      color: $color-text-primary;
      background: $color-bg-elevated;
      text-decoration: none;
    }
    
    span {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    &.next {
      margin-left: auto;
    }
  }
</style>



================================================
FILE: TableOfContents.astro
================================================
---
interface Props {
  headings: { depth: number; slug: string; text: string }[];
}

const { headings } = Astro.props;

// Filter to only include h2 and h3
const filteredHeadings = headings.filter((h) => h.depth >= 2 && h.depth <= 3);
---

{filteredHeadings.length > 0 && (
  <nav class="toc" aria-label="Table of contents">
    <div class="toc-header">
      <span class="toc-icon">ðŸ“‘</span>
      <span class="toc-title">On this page</span>
    </div>
    <ul class="toc-list">
      {filteredHeadings.map((heading) => (
        <li class:list={['toc-item', `toc-depth-${heading.depth}`]}>
          <a href={`#${heading.slug}`} class="toc-link" data-toc-link>
            {heading.text}
          </a>
        </li>
      ))}
    </ul>
  </nav>
)}

<script>
  // Highlight active TOC item based on scroll position
  const tocLinks = document.querySelectorAll('[data-toc-link]');
  const headings = Array.from(tocLinks).map((link) => {
    const id = link.getAttribute('href')?.slice(1);
    return document.getElementById(id || '');
  }).filter(Boolean);
  
  function updateActiveLink() {
    const scrollPosition = window.scrollY + 100;
    
    let activeIndex = 0;
    headings.forEach((heading, index) => {
      if (heading && heading.offsetTop <= scrollPosition) {
        activeIndex = index;
      }
    });
    
    tocLinks.forEach((link, index) => {
      link.classList.toggle('active', index === activeIndex);
    });
  }
  
  window.addEventListener('scroll', updateActiveLink, { passive: true });
  updateActiveLink();
</script>

<style lang="scss">
  @use '../styles/variables' as *;
  
  .toc {
    font-size: $font-size-sm;
  }
  
  .toc-header {
    display: flex;
    align-items: center;
    gap: $space-2;
    margin-bottom: $space-4;
    padding-bottom: $space-3;
    border-bottom: 1px solid $color-border-default;
  }
  
  .toc-icon {
    font-size: $font-size-base;
  }
  
  .toc-title {
    font-family: $font-mono;
    font-size: $font-size-xs;
    font-weight: $font-weight-semibold;
    text-transform: uppercase;
    letter-spacing: $letter-spacing-wider;
    color: $color-text-tertiary;
  }
  
  .toc-list {
    list-style: none;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    gap: $space-1;
  }
  
  .toc-item {
    &.toc-depth-3 {
      padding-left: $space-4;
    }
  }
  
  .toc-link {
    display: block;
    padding: $space-1 $space-2;
    color: $color-text-secondary;
    text-decoration: none;
    border-radius: $border-radius-sm;
    border-left: 2px solid transparent;
    line-height: $line-height-snug;
    transition: all $transition-fast;
    
    &:hover {
      color: $color-text-primary;
      background: $color-bg-tertiary;
    }
    
    &.active {
      color: $color-accent-blue;
      border-left-color: $color-accent-blue;
      background: rgba($color-accent-blue, 0.1);
    }
  }
</style>



================================================
FILE: interactive/RooflinePlot.astro
================================================
---
/**
 * Analytical RooflinePlot Component
 * Optimized for stability and professional analysis.
 */

interface Props {
  peakFlops?: number;
  peakBw?: number;
  title?: string;
  initialWork?: number;
  initialTraffic?: number;
  initialTime?: number;
}

const { 
  peakFlops = 312, 
  peakBw = 2039, 
  title = "Performance Analysis Lab",
  initialWork = 1024,
  initialTraffic = 128,
  initialTime = 4.5
} = Astro.props;

const uid = "rf-" + Math.random().toString(36).substring(2, 9);
---

<div class="systems-lab-container my-12" id={uid}>
  <div class="lab-grid">
    <aside class="lab-sidebar">
      <div class="lab-section-header">
        <span>Hardware Parameters</span>
        <span class="version-tag">PROFILER V2.2</span>
      </div>
      
      <div class="lab-scroll-area">
        <div class="lab-field mb-4">
          <label>Architecture Preset</label>
          <select class="h-preset">
            <option value="h100">H100 SXM5 (FP16)</option>
            <option value="a100" selected>A100 80GB (FP16)</option>
            <option value="rtx4090">RTX 4090 (FP16)</option>
            <option value="mi300x">AMD MI300X (FP16)</option>
            <option value="custom">Custom Params</option>
          </select>
        </div>

        <div class="lab-input-grid">
          <div class="lab-field">
            <label>Peak TFLOPS</label>
            <input type="number" class="h-perf" value={peakFlops} />
          </div>
          <div class="lab-field">
            <label>Peak BW (GB/s)</label>
            <input type="number" class="h-bw" value={peakBw} />
          </div>
        </div>

        <div class="lab-field">
          <label>Observed Efficiency (%)</label>
          <input type="range" class="h-eff" min="1" max="100" value="75" />
          <div class="range-labels">
            <span>Practical Ceiling</span>
            <span class="h-eff-val">75%</span>
          </div>
        </div>

        <div class="lab-section-header inner">
          <span>Workload Definition</span>
        </div>
        
        <div class="mode-toggle">
          <button class="mode-btn active" data-mode="manual">Manual</button>
          <button class="mode-btn" data-mode="linear">GEMM</button>
          <button class="mode-btn" data-mode="attn">Attention</button>
        </div>

        <div class="manual-inputs mt-4">
          <div class="lab-input-grid">
            <div class="lab-field">
              <label>Work (GFLOP)</label>
              <input type="number" class="w-work" value={initialWork} />
            </div>
            <div class="lab-field">
              <label>Traffic (GB)</label>
              <input type="number" class="w-traffic" value={initialTraffic} />
            </div>
          </div>
        </div>

        <div class="params-inputs lab-input-grid hidden mt-4">
          <div class="lab-field"><label>Batch (B)</label><input type="number" class="p-b" value="32" /></div>
          <div class="lab-field"><label>Seq (L)</label><input type="number" class="p-l" value="512" /></div>
          <div class="lab-field"><label>Hidden (D)</label><input type="number" class="p-d" value="4096" /></div>
          <div class="lab-field"><label>DType (B)</label><input type="number" class="p-dt" value="2" /></div>
        </div>

        <div class="lab-field mt-4">
          <label>Measured Kernel Time (ms)</label>
          <input type="number" class="w-time" value={initialTime} step="0.001" />
        </div>
      </div>
    </aside>

    <main class="lab-main">
      <div class="lab-chart-frame">
        <canvas class="roofline-canvas"></canvas>
      </div>

      <div class="lab-analytics-grid">
        <div class="lab-card">
          <div class="card-label">Operational Intensity</div>
          <div class="card-value val-intensity" style="color: #539bf5">0.00</div>
          <div class="card-sub">FLOP/Byte</div>
        </div>
        <div class="lab-card">
          <div class="card-label">Throughput SOL</div>
          <div class="card-value val-perf-sol" style="color: #57ab5a">0.0%</div>
          <div class="card-sub val-tflops">0.00 TFLOPS</div>
        </div>
        <div class="lab-card">
          <div class="card-label">Bandwidth SOL</div>
          <div class="card-value val-bw-sol" style="color: #39c5cf">0.0%</div>
          <div class="card-sub val-bw">0.0 GB/s</div>
        </div>
        <div class="lab-card">
          <div class="card-label">Ridge Point</div>
          <div class="card-value val-ridge" style="color: #daaa3f">0.00</div>
          <div class="card-sub">FLOP/B Limit</div>
        </div>
      </div>

      <div class="lab-summary-row">
        <div class="lab-card">
          <div class="card-label">Latency Breakdown (Ideal vs Reality)</div>
          <div class="latency-bar">
            <div class="l-segment bar-comp" style="background: #57ab5a;"></div>
            <div class="l-segment bar-mem" style="background: #39c5cf;"></div>
            <div class="l-segment bar-waste" style="background: #f47067;"></div>
          </div>
          <div class="latency-info mt-3">
             <span class="val-constraint">Analyzing...</span>
          </div>
        </div>
      </div>
    </main>
  </div>
</div>

<script is:inline define:vars={{ uid }}>
(function() {
    const root = document.getElementById(uid);
    if (!root) return;
    const canvas = root.querySelector('.roofline-canvas');
    const ctx = canvas.getContext('2d');
    
    const get = (cls) => root.querySelector(cls);
    
    const ui = {
        hPerf: get('.h-perf'), hBw: get('.h-bw'), hEff: get('.h-eff'), hEffVal: get('.h-eff-val'),
        hPreset: get('.h-preset'), wWork: get('.w-work'), wTraffic: get('.w-traffic'),
        wTime: get('.w-time'), pB: get('.p-b'), pL: get('.p-l'), pD: get('.p-d'), pDT: get('.p-dt'),
        lInt: get('.val-intensity'), lRidge: get('.val-ridge'), lPerfSol: get('.val-perf-sol'),
        lBwSol: get('.val-bw-sol'), lTflops: get('.val-tflops'), lBw: get('.val-bw'),
        lConstraint: get('.val-constraint'), 
        lBarComp: get('.bar-comp'), lBarMem: get('.bar-mem'), lBarWaste: get('.bar-waste')
    };

    let activeMode = 'manual';
    const presets = {
        h100: { p: 1979, b: 3350 }, a100: { p: 312, b: 2039 },
        rtx4090: { p: 82, b: 1008 }, mi300x: { p: 2600, b: 5300 }
    };

    root.querySelectorAll('.mode-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            root.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            activeMode = btn.dataset.mode;
            get('.manual-inputs').classList.toggle('hidden', activeMode !== 'manual');
            get('.params-inputs').classList.toggle('hidden', activeMode === 'manual');
            update();
        });
    });

    function update() {
        if (activeMode === 'linear') {
            const b = parseFloat(ui.pB.value) || 0, l = parseFloat(ui.pL.value) || 0, d = parseFloat(ui.pD.value) || 0, dt = parseFloat(ui.pDT.value) || 0;
            ui.wWork.value = (2 * b * l * d * d) / 1e9;
            ui.wTraffic.value = (d * d * dt + b * l * d * dt * 2) / 1e9;
        } else if (activeMode === 'attn') {
            const b = parseFloat(ui.pB.value) || 0, l = parseFloat(ui.pL.value) || 0, d = parseFloat(ui.pD.value) || 0, dt = parseFloat(ui.pDT.value) || 0;
            ui.wWork.value = (2 * b * l * l * d) / 1e9;
            ui.wTraffic.value = (b * l * d * dt * 3 + b * l * l * dt) / 1e9;
        }

        const pPerf = parseFloat(ui.hPerf.value) || 1;
        const pBw = parseFloat(ui.hBw.value) || 1;
        const eff = (parseFloat(ui.hEff.value) || 0) / 100;
        const work = parseFloat(ui.wWork.value) || 0;
        const traffic = parseFloat(ui.wTraffic.value) || 0.0001; // Avoid div by zero
        const timeMs = parseFloat(ui.wTime.value) || 0.0001;

        const intensity = work / traffic;
        const actualTflops = work / (timeMs / 1000);
        const actualBw = traffic / (timeMs / 1000);
        const ridge = pPerf / (pBw / 1000);

        ui.lInt.textContent = intensity.toFixed(2);
        ui.lRidge.textContent = ridge.toFixed(2);
        ui.lPerfSol.textContent = ((actualTflops / pPerf) * 100).toFixed(1) + "%";
        ui.lBwSol.textContent = ((actualBw / pBw) * 100).toFixed(1) + "%";
        ui.lTflops.textContent = actualTflops.toFixed(2) + " TFLOPS";
        ui.lBw.textContent = actualBw.toFixed(1) + " GB/s";
        ui.hEffVal.textContent = (eff * 100).toFixed(0) + "%";

        const tComp = work / pPerf;
        const tMem = traffic / pBw;
        const total = timeMs / 1000;
        const stall = Math.max(0, total - Math.max(tComp, tMem));
        
        ui.lBarComp.style.width = (tComp / total * 100) + "%";
        ui.lBarMem.style.width = (tMem / total * 100) + "%";
        ui.lBarWaste.style.width = (stall / total * 100) + "%";
        ui.lConstraint.textContent = "Bounded by " + (intensity < ridge ? "Memory Bandwidth" : "Compute Capacity");

        draw(pPerf, pBw, eff, intensity, actualTflops, ridge);
    }

    function draw(pPerf, pBw, eff, curInt, curPerf, ridge) {
        const dpr = window.devicePixelRatio || 1;
        const rect = canvas.getBoundingClientRect();
        canvas.width = rect.width * dpr; canvas.height = rect.height * dpr;
        ctx.scale(dpr, dpr);
        const w = rect.width, h = rect.height, pad = 50;
        const gW = w - pad*2, gH = h - pad*2;
        ctx.clearRect(0,0,w,h);

        const minX = 0.1, maxX = 2048, minY = 0.1, maxY = pPerf * 2;
        const mapX = (v) => pad + (Math.log10(v/minX) / Math.log10(maxX/minX)) * gW;
        const mapY = (v) => (h-pad) - (Math.log10(Math.max(minY, v)/minY) / Math.log10(maxY/minY)) * gH;

        ctx.strokeStyle = '#2d333b'; ctx.lineWidth = 1; ctx.font = '9px monospace'; ctx.fillStyle = '#636e7b';
        [0.1, 1, 10, 100, 1000].forEach(v => {
            const x = mapX(v); ctx.beginPath(); ctx.moveTo(x, pad); ctx.lineTo(x, h-pad); ctx.stroke();
            ctx.fillText(v < 1 ? v.toFixed(1) : v, x - 10, h-pad+15);
        });
        [1, 10, 100, 1000].forEach(v => {
            const y = mapY(v); ctx.beginPath(); ctx.moveTo(pad, y); ctx.lineTo(w-pad, y); ctx.stroke();
            ctx.fillText(v, pad-35, y + 4);
        });

        const ePerf = pPerf * eff; const eBw = pBw * eff;
        const eRidge = ePerf / (eBw/1000);
        ctx.strokeStyle = '#539bf5'; ctx.lineWidth = 3; ctx.beginPath();
        ctx.moveTo(mapX(minX), mapY(Math.max(minY, minX * (eBw/1000))));
        ctx.lineTo(mapX(eRidge), mapY(ePerf));
        ctx.lineTo(mapX(maxX), mapY(ePerf));
        ctx.stroke();

        const dotX = mapX(curInt); const dotY = mapY(curPerf);
        ctx.fillStyle = curInt < ridge ? '#39c5cf' : '#57ab5a';
        ctx.shadowBlur = 15; ctx.shadowColor = ctx.fillStyle;
        ctx.beginPath(); ctx.arc(dotX, dotY, 6, 0, Math.PI*2); ctx.fill();
        ctx.shadowBlur = 0;

        ctx.fillStyle = '#daaa3f';
        ctx.beginPath(); ctx.arc(mapX(eRidge), mapY(ePerf), 3, 0, Math.PI*2); ctx.fill();
    }

    ui.hPreset.addEventListener('change', (e) => {
        const p = presets[e.target.value];
        if(p) { ui.hPerf.value = p.p; ui.hBw.value = p.b; update(); }
    });

    [ui.hPerf, ui.hBw, ui.hEff, ui.wWork, ui.wTraffic, ui.wTime, ui.pB, ui.pL, ui.pD, ui.pDT].forEach(i => i.addEventListener('input', update));
    window.addEventListener('resize', update);
    update();
})();
</script>

<style lang="scss">
  .systems-lab-container {
    background: var(--color-bg-secondary);
    border: 1px solid var(--color-border-default);
    border-radius: 12px;
    overflow: hidden;
    color: var(--color-text-primary);
    font-family: var(--font-mono);
  }

  .lab-grid {
    display: grid;
    grid-template-columns: 320px 1fr;
    height: 650px;
    @media (max-width: 1024px) { grid-template-columns: 1fr; height: auto; }
  }

  .lab-sidebar { background: #151921; border-right: 1px solid var(--color-border-default); display: flex; flex-direction: column; }
  .lab-section-header {
    padding: 12px 20px; background: #1c212b; border-bottom: 1px solid var(--color-border-default);
    font-size: 10px; font-weight: bold; display: flex; justify-content: space-between; text-transform: uppercase;
    &.inner { margin-top: 20px; border-top: 1px solid var(--color-border-default); }
  }

  .lab-scroll-area { padding: 20px; overflow-y: auto; flex: 1; }
  .lab-input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
  .lab-field { display: flex; flex-direction: column; gap: 5px; margin-bottom: 12px; }
  label { font-size: 9px; color: var(--color-text-secondary); text-transform: uppercase; }
  
  input, select {
    background: #0b0e14; border: 1px solid var(--color-border-default); color: #cdd9e5; padding: 6px 10px;
    border-radius: 4px; font-size: 11px; outline: none; &:focus { border-color: var(--color-accent-blue); }
  }

  .mode-toggle {
    display: flex; gap: 5px; margin-top: 10px;
    .mode-btn {
        flex: 1; background: #1c212b; border: 1px solid var(--color-border-default);
        color: var(--color-text-secondary); font-size: 9px; padding: 6px; border-radius: 4px; cursor: pointer;
        &.active { border-color: var(--color-accent-blue); color: white; background: var(--color-accent-blue); }
    }
  }

  .lab-main { padding: 20px; display: flex; flex-direction: column; gap: 20px; background: #0b0e14; overflow-y: auto;}
  .lab-chart-frame { background: #151921; border: 1px solid var(--color-border-default); border-radius: 8px; flex: 1; min-height: 350px; }
  .lab-analytics-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
  .lab-card { background: #151921; border: 1px solid var(--color-border-default); border-radius: 8px; padding: 12px; }
  .card-label { font-size: 8px; text-transform: uppercase; color: var(--color-text-secondary); margin-bottom: 5px; }
  .card-value { font-size: 16px; font-weight: bold; }
  .card-sub { font-size: 9px; color: var(--color-text-tertiary); margin-top: 3px; }

  .latency-bar {
    height: 20px; background: #2d333b; border-radius: 4px; display: flex; overflow: hidden; margin-top: 8px;
    .l-segment { height: 100%; transition: width 0.3s; }
  }

  .hidden { display: none; }
  .range-labels { display: flex; justify-content: space-between; font-size: 8px; margin-top: 4px; color: var(--color-text-tertiary); }
</style>


================================================
FILE: mdx/Benchmark.astro
================================================
---
/**
 * Benchmark Component
 * 
 * Displays benchmark results in a formatted table with comparisons.
 * 
 * Usage in MDX:
 * <Benchmark
 *   title="KV Cache Performance"
 *   columns={["Config", "Throughput", "Latency P99", "Memory"]}
 *   rows={[
 *     { values: ["Baseline", "1,200 tok/s", "45ms", "16GB"], highlight: false },
 *     { values: ["Paged Attention", "2,400 tok/s", "28ms", "12GB"], highlight: true },
 *     { values: ["+ Flash Attention", "3,100 tok/s", "22ms", "10GB"], highlight: true },
 *   ]}
 *   notes="Measured on A100 80GB, batch size 32, sequence length 2048"
 * />
 */

interface BenchmarkRow {
  values: string[];
  highlight?: boolean;
  delta?: string[];
}

interface Props {
  title?: string;
  columns: string[];
  rows: BenchmarkRow[];
  notes?: string;
  showIndex?: boolean;
}

const { title, columns, rows, notes, showIndex = false } = Astro.props;
---

<div class="benchmark">
  {title && (
    <div class="benchmark-header">
      <span class="benchmark-icon">ðŸ“Š</span>
      <h4 class="benchmark-title">{title}</h4>
    </div>
  )}
  
  <div class="benchmark-table-wrapper">
    <table class="benchmark-table">
      <thead>
        <tr>
          {showIndex && <th class="col-index">#</th>}
          {columns.map((col) => (
            <th>{col}</th>
          ))}
        </tr>
      </thead>
      <tbody>
        {rows.map((row, index) => (
          <tr class:list={{ highlighted: row.highlight }}>
            {showIndex && <td class="col-index">{index + 1}</td>}
            {row.values.map((value, colIndex) => (
              <td>
                <span class="cell-value">{value}</span>
                {row.delta?.[colIndex] && (
                  <span class:list={[
                    'cell-delta',
                    { positive: row.delta[colIndex].startsWith('+') || row.delta[colIndex].startsWith('â†‘') },
                    { negative: row.delta[colIndex].startsWith('-') || row.delta[colIndex].startsWith('â†“') }
                  ]}>
                    {row.delta[colIndex]}
                  </span>
                )}
              </td>
            ))}
          </tr>
        ))}
      </tbody>
    </table>
  </div>
  
  {notes && (
    <div class="benchmark-notes">
      <span class="notes-label">Note:</span>
      {notes}
    </div>
  )}
</div>

<style lang="scss">
  @use '../../styles/variables' as *;
  
  .benchmark {
    margin: $space-8 0;
    background: $color-bg-secondary;
    border: 1px solid $color-border-default;
    border-radius: $border-radius-lg;
    overflow: hidden;
  }
  
  .benchmark-header {
    display: flex;
    align-items: center;
    gap: $space-2;
    padding: $space-4 $space-5;
    background: $color-bg-tertiary;
    border-bottom: 1px solid $color-border-default;
  }
  
  .benchmark-icon {
    font-size: $font-size-base;
  }
  
  .benchmark-title {
    font-family: $font-mono;
    font-size: $font-size-sm;
    font-weight: $font-weight-semibold;
    color: $color-text-primary;
    margin: 0;
  }
  
  .benchmark-table-wrapper {
    overflow-x: auto;
    @include scrollbar-thin;
  }
  
  .benchmark-table {
    width: 100%;
    border-collapse: collapse;
    font-size: $font-size-sm;
    margin: 0;
    display: table;
    
    th, td {
      padding: $space-3 $space-4;
      text-align: left;
      border: none;
      border-bottom: 1px solid $color-border-default;
    }
    
    th {
      font-family: $font-mono;
      font-size: $font-size-xs;
      font-weight: $font-weight-semibold;
      text-transform: uppercase;
      letter-spacing: $letter-spacing-wide;
      color: $color-text-secondary;
      background: $color-bg-tertiary;
      white-space: nowrap;
    }
    
    td {
      font-family: $font-mono;
      color: $color-text-primary;
    }
    
    tbody tr {
      transition: background $transition-fast;
      
      &:hover {
        background: rgba($color-bg-tertiary, 0.5);
      }
      
      &:last-child td {
        border-bottom: none;
      }
      
      &.highlighted {
        background: rgba($color-accent-green, 0.08);
        
        td:first-child {
          border-left: 3px solid $color-accent-green;
        }
        
        &:hover {
          background: rgba($color-accent-green, 0.12);
        }
      }
    }
    
    .col-index {
      width: 40px;
      text-align: center;
      color: $color-text-tertiary;
    }
  }
  
  .cell-value {
    display: inline;
  }
  
  .cell-delta {
    display: inline-block;
    margin-left: $space-2;
    font-size: $font-size-xs;
    padding: 0 $space-1;
    border-radius: 2px;
    
    &.positive {
      color: $color-accent-green;
      background: rgba($color-accent-green, 0.1);
    }
    
    &.negative {
      color: $color-accent-red;
      background: rgba($color-accent-red, 0.1);
    }
  }
  
  .benchmark-notes {
    padding: $space-3 $space-5;
    font-size: $font-size-xs;
    color: $color-text-tertiary;
    background: $color-bg-tertiary;
    border-top: 1px solid $color-border-default;
    line-height: $line-height-relaxed;
  }
  
  .notes-label {
    font-weight: $font-weight-semibold;
    color: $color-text-secondary;
    margin-right: $space-1;
  }
</style>



================================================
FILE: mdx/Callout.astro
================================================
---
/**
 * Callout Component
 * 
 * Usage in MDX:
 * <Callout type="warning" title="Performance Impact">
 *   This operation has O(n²) complexity.
 * </Callout>
 * 
 * Types: info, warning, danger, tip, perf
 */

interface Props {
  type?: 'info' | 'warning' | 'danger' | 'tip' | 'perf';
  title?: string;
}

const { type = 'info', title } = Astro.props;

const icons = {
  info: 'ℹ️',
  warning: '⚠️',
  danger: '🚨',
  tip: '💡',
  perf: '⚡',
};

const defaultTitles = {
  info: 'Note',
  warning: 'Warning',
  danger: 'Danger',
  tip: 'Tip',
  perf: 'Performance',
};

const displayTitle = title || defaultTitles[type];
---

<div class:list={['callout', `callout-${type}`]} role="note">
  <div class="callout-header">
    <span class="callout-icon">{icons[type]}</span>
    <span class="callout-title">{displayTitle}</span>
  </div>
  <div class="callout-content">
    <slot />
  </div>
</div>

<style lang="scss">
  @use '../../styles/variables' as *;
  
  .callout {
    margin: $space-6 0;
    padding: $space-4 $space-5;
    border-radius: $border-radius-md;
    border: 1px solid;
    border-left-width: 4px;
  }
  
  .callout-header {
    display: flex;
    align-items: center;
    gap: $space-2;
    margin-bottom: $space-3;
  }
  
  .callout-icon {
    font-size: $font-size-base;
  }
  
  .callout-title {
    font-family: $font-mono;
    font-size: $font-size-sm;
    font-weight: $font-weight-semibold;
    text-transform: uppercase;
    letter-spacing: $letter-spacing-wide;
  }
  
  .callout-content {
    font-size: $font-size-sm;
    line-height: $line-height-relaxed;
    
    :global(p:last-child) {
      margin-bottom: 0;
    }
    
    :global(code) {
      font-size: 0.85em;
    }
  }
  
  // Type variants
  .callout-info {
    background: rgba($color-info, 0.08);
    border-color: rgba($color-info, 0.3);
    
    .callout-title { color: $color-info; }
  }
  
  .callout-warning {
    background: rgba($color-warning, 0.08);
    border-color: rgba($color-warning, 0.3);
    
    .callout-title { color: $color-warning; }
  }
  
  .callout-danger {
    background: rgba($color-error, 0.08);
    border-color: rgba($color-error, 0.3);
    
    .callout-title { color: $color-error; }
  }
  
  .callout-tip {
    background: rgba($color-success, 0.08);
    border-color: rgba($color-success, 0.3);
    
    .callout-title { color: $color-success; }
  }
  
  .callout-perf {
    background: rgba($color-accent-purple, 0.08);
    border-color: rgba($color-accent-purple, 0.3);
    
    .callout-title { color: $color-accent-purple; }
  }
</style>



================================================
FILE: mdx/CodeCompare.astro
================================================
---
/**
 * CodeCompare Component
 * 
 * Side-by-side code comparison with highlighting.
 * 
 * Usage in MDX:
 * <CodeCompare
 *   beforeTitle="Before Optimization"
 *   afterTitle="After Optimization"
 *   language="python"
 * >
 *   <Fragment slot="before">
 *     ```python
 *     # Naive implementation
 *     for i in range(n):
 *         result += data[i]
 *     ```
 *   </Fragment>
 *   <Fragment slot="after">
 *     ```python
 *     # Vectorized
 *     result = np.sum(data)
 *     ```
 *   </Fragment>
 * </CodeCompare>
 */

interface Props {
  beforeTitle?: string;
  afterTitle?: string;
  language?: string;
}

const { 
  beforeTitle = 'Before', 
  afterTitle = 'After',
  language
} = Astro.props;
---

<div class="code-compare">
  <div class="compare-panel before">
    <div class="panel-header">
      <span class="panel-indicator before-indicator">âˆ’</span>
      <span class="panel-title">{beforeTitle}</span>
    </div>
    <div class="panel-content">
      <slot name="before" />
    </div>
  </div>
  
  <div class="compare-divider">
    <span class="divider-arrow">â†’</span>
  </div>
  
  <div class="compare-panel after">
    <div class="panel-header">
      <span class="panel-indicator after-indicator">+</span>
      <span class="panel-title">{afterTitle}</span>
    </div>
    <div class="panel-content">
      <slot name="after" />
    </div>
  </div>
</div>

<style lang="scss">
  @use '../../styles/variables' as *;
  
  .code-compare {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    gap: $space-2;
    margin: $space-8 0;
    
    @media (max-width: 900px) {
      grid-template-columns: 1fr;
      gap: $space-4;
    }
  }
  
  .compare-panel {
    background: $color-bg-secondary;
    border: 1px solid $color-border-default;
    border-radius: $border-radius-lg;
    overflow: hidden;
    
    &.before {
      border-top: 3px solid $color-accent-red;
    }
    
    &.after {
      border-top: 3px solid $color-accent-green;
    }
  }
  
  .panel-header {
    display: flex;
    align-items: center;
    gap: $space-2;
    padding: $space-3 $space-4;
    background: $color-bg-tertiary;
    border-bottom: 1px solid $color-border-default;
  }
  
  .panel-indicator {
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: $font-mono;
    font-size: $font-size-sm;
    font-weight: $font-weight-bold;
    border-radius: $border-radius-sm;
    
    &.before-indicator {
      background: rgba($color-accent-red, 0.2);
      color: $color-accent-red;
    }
    
    &.after-indicator {
      background: rgba($color-accent-green, 0.2);
      color: $color-accent-green;
    }
  }
  
  .panel-title {
    font-family: $font-mono;
    font-size: $font-size-xs;
    font-weight: $font-weight-semibold;
    text-transform: uppercase;
    letter-spacing: $letter-spacing-wide;
    color: $color-text-secondary;
  }
  
  .panel-content {
    padding: 0;
    
    // Reset nested pre/code styles
    :global(pre) {
      margin: 0 !important;
      border: none !important;
      border-radius: 0 !important;
      background: transparent !important;
    }
    
    :global(code) {
      font-size: $font-size-sm;
    }
  }
  
  .compare-divider {
    display: flex;
    align-items: center;
    justify-content: center;
    
    @media (max-width: 900px) {
      padding: $space-2 0;
    }
  }
  
  .divider-arrow {
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: $color-bg-tertiary;
    border: 1px solid $color-border-default;
    border-radius: $border-radius-full;
    font-size: $font-size-lg;
    color: $color-accent-blue;
    
    @media (max-width: 900px) {
      transform: rotate(90deg);
    }
  }
</style>



================================================
FILE: mdx/index.ts
================================================
// MDX Components Index
// Import these in your MDX files or in the Astro config

export { default as Callout } from './Callout.astro';
export { default as RegisterDiagram } from './RegisterDiagram.astro';
export { default as MemoryLayout } from './MemoryLayout.astro';
export { default as PerfChart } from './PerfChart.astro';
export { default as CodeCompare } from './CodeCompare.astro';
export { default as Benchmark } from './Benchmark.astro';

// Re-export types if needed
export type CalloutType = 'info' | 'warning' | 'danger' | 'tip' | 'perf';



================================================
FILE: mdx/MemoryLayout.astro
================================================
---
/**
 * MemoryLayout Component
 * 
 * Visualizes memory address space layouts.
 * 
 * Usage in MDX:
 * <MemoryLayout
 *   title="ESP32 Memory Map"
 *   regions={[
 *     { start: "0x3FF00000", end: "0x3FF7FFFF", name: "Peripheral", color: "orange" },
 *     { start: "0x3FFB0000", end: "0x3FFFFFFF", name: "SRAM1", color: "blue", size: "320KB" },
 *     { start: "0x40000000", end: "0x4005FFFF", name: "Internal ROM", color: "gray" },
 *   ]}
 * />
 */

interface MemoryRegion {
  start: string;
  end: string;
  name: string;
  size?: string;
  color?: 'blue' | 'green' | 'orange' | 'red' | 'purple' | 'gray' | 'cyan';
  notes?: string;
}

interface Props {
  title?: string;
  regions: MemoryRegion[];
  showAddresses?: boolean;
}

const { title, regions, showAddresses = true } = Astro.props;

// Parse hex addresses to numbers for height calculation
const parseHex = (hex: string) => parseInt(hex.replace('0x', ''), 16);

const parsedRegions = regions.map((r) => ({
  ...r,
  startNum: parseHex(r.start),
  endNum: parseHex(r.end),
}));

// Calculate relative heights (normalize to percentage)
const totalRange = Math.max(...parsedRegions.map(r => r.endNum)) - Math.min(...parsedRegions.map(r => r.startNum));
---

<div class="memory-layout">
  {title && <h4 class="memory-title">{title}</h4>}
  
  <div class="memory-container">
    <!-- Address labels (left side) -->
    {showAddresses && (
      <div class="address-column">
        {parsedRegions.map((region) => (
          <div class="address-labels">
            <code class="address end">{region.end}</code>
            <code class="address start">{region.start}</code>
          </div>
        ))}
      </div>
    )}
    
    <!-- Memory regions -->
    <div class="regions-column">
      {parsedRegions.map((region) => (
        <div 
          class:list={['memory-region', `color-${region.color || 'blue'}`]}
          style={`--height: ${Math.max(40, ((region.endNum - region.startNum) / totalRange) * 300)}px`}
        >
          <div class="region-content">
            <span class="region-name">{region.name}</span>
            {region.size && <span class="region-size">{region.size}</span>}
          </div>
        </div>
      ))}
    </div>
    
    <!-- Notes (right side) -->
    <div class="notes-column">
      {parsedRegions.map((region) => (
        <div class="region-note">
          {region.notes && <span>{region.notes}</span>}
        </div>
      ))}
    </div>
  </div>
  
  <!-- Legend -->
  <div class="memory-legend">
    {parsedRegions.map((region) => (
      <div class="legend-item">
        <span class:list={['legend-swatch', `color-${region.color || 'blue'}`]}></span>
        <span class="legend-label">{region.name}</span>
        {region.size && <code class="legend-size">{region.size}</code>}
      </div>
    ))}
  </div>
</div>

<style lang="scss">
  @use '../../styles/variables' as *;
  
  .memory-layout {
    margin: $space-8 0;
    padding: $space-5;
    background: $color-bg-secondary;
    border: 1px solid $color-border-default;
    border-radius: $border-radius-lg;
  }
  
  .memory-title {
    font-family: $font-mono;
    font-size: $font-size-sm;
    font-weight: $font-weight-semibold;
    color: $color-text-secondary;
    margin: 0 0 $space-4;
    padding-bottom: $space-3;
    border-bottom: 1px solid $color-border-default;
  }
  
  .memory-container {
    display: grid;
    grid-template-columns: auto 200px 1fr;
    gap: $space-4;
    align-items: start;
  }
  
  .address-column {
    display: flex;
    flex-direction: column;
  }
  
  .address-labels {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    padding: $space-2 0;
  }
  
  .address {
    font-family: $font-mono;
    font-size: $font-size-xs;
    color: $color-text-tertiary;
    background: transparent;
    padding: 0;
    
    &.end { margin-bottom: auto; }
    &.start { margin-top: auto; }
  }
  
  .regions-column {
    display: flex;
    flex-direction: column;
    gap: 2px;
  }
  
  .memory-region {
    min-height: var(--height, 60px);
    padding: $space-2 $space-3;
    border-radius: $border-radius-sm;
    border-left: 4px solid;
    display: flex;
    align-items: center;
    transition: filter $transition-fast;
    
    &:hover {
      filter: brightness(1.15);
    }
    
    // Color variants
    &.color-blue {
      background: rgba($color-accent-blue, 0.15);
      border-left-color: $color-accent-blue;
    }
    
    &.color-green {
      background: rgba($color-accent-green, 0.15);
      border-left-color: $color-accent-green;
    }
    
    &.color-orange {
      background: rgba($color-accent-orange, 0.15);
      border-left-color: $color-accent-orange;
    }
    
    &.color-red {
      background: rgba($color-accent-red, 0.15);
      border-left-color: $color-accent-red;
    }
    
    &.color-purple {
      background: rgba($color-accent-purple, 0.15);
      border-left-color: $color-accent-purple;
    }
    
    &.color-cyan {
      background: rgba($color-accent-cyan, 0.15);
      border-left-color: $color-accent-cyan;
    }
    
    &.color-gray {
      background: rgba($color-text-tertiary, 0.1);
      border-left-color: $color-text-tertiary;
    }
  }
  
  .region-content {
    display: flex;
    flex-direction: column;
    gap: 2px;
  }
  
  .region-name {
    font-family: $font-mono;
    font-size: $font-size-sm;
    font-weight: $font-weight-medium;
    color: $color-text-primary;
  }
  
  .region-size {
    font-family: $font-mono;
    font-size: $font-size-xs;
    color: $color-text-secondary;
  }
  
  .notes-column {
    display: flex;
    flex-direction: column;
  }
  
  .region-note {
    font-size: $font-size-xs;
    color: $color-text-tertiary;
    padding: $space-2 0;
    line-height: $line-height-relaxed;
  }
  
  .memory-legend {
    display: flex;
    flex-wrap: wrap;
    gap: $space-4;
    margin-top: $space-4;
    padding-top: $space-4;
    border-top: 1px solid $color-border-default;
  }
  
  .legend-item {
    display: flex;
    align-items: center;
    gap: $space-2;
  }
  
  .legend-swatch {
    width: 16px;
    height: 16px;
    border-radius: 3px;
    
    &.color-blue { background: $color-accent-blue; }
    &.color-green { background: $color-accent-green; }
    &.color-orange { background: $color-accent-orange; }
    &.color-red { background: $color-accent-red; }
    &.color-purple { background: $color-accent-purple; }
    &.color-cyan { background: $color-accent-cyan; }
    &.color-gray { background: $color-text-tertiary; }
  }
  
  .legend-label {
    font-size: $font-size-sm;
    color: $color-text-primary;
  }
  
  .legend-size {
    font-family: $font-mono;
    font-size: $font-size-xs;
    color: $color-text-tertiary;
    background: $color-bg-tertiary;
    padding: 0 $space-1;
    border-radius: 2px;
  }
</style>



================================================
FILE: mdx/PerfChart.astro
================================================
---
/**
 * PerfChart Component
 * 
 * Renders performance comparison bar charts.
 * 
 * Usage in MDX:
 * <PerfChart
 *   title="Token Generation Throughput"
 *   unit="tokens/sec"
 *   data={[
 *     { label: "Baseline", value: 1200, color: "gray" },
 *     { label: "Optimized", value: 2400, color: "green" },
 *     { label: "With CUDA Graphs", value: 3100, color: "blue" },
 *   ]}
 * />
 */

interface DataPoint {
  label: string;
  value: number;
  color?: 'blue' | 'green' | 'orange' | 'red' | 'purple' | 'gray' | 'cyan';
  annotation?: string;
}

interface Props {
  title?: string;
  unit?: string;
  data: DataPoint[];
  showValues?: boolean;
  baseline?: number;
}

const { title, unit = '', data, showValues = true, baseline } = Astro.props;

const maxValue = Math.max(...data.map(d => d.value));
const baselineIndex = baseline !== undefined ? baseline : null;
---

<div class="perf-chart">
  {title && (
    <div class="chart-header">
      <h4 class="chart-title">{title}</h4>
      {unit && <span class="chart-unit">({unit})</span>}
    </div>
  )}
  
  <div class="chart-body">
    {data.map((item, index) => {
      const percentage = (item.value / maxValue) * 100;
      const improvement = baselineIndex !== null && index !== baselineIndex
        ? ((item.value - data[baselineIndex].value) / data[baselineIndex].value * 100).toFixed(1)
        : null;
      
      return (
        <div class="chart-row">
          <div class="row-label">
            <span class="label-text">{item.label}</span>
            {item.annotation && <span class="label-annotation">{item.annotation}</span>}
          </div>
          
          <div class="row-bar-container">
            <div 
              class:list={['row-bar', `color-${item.color || 'blue'}`]}
              style={`--width: ${percentage}%`}
            >
              {showValues && (
                <span class="bar-value">
                  {item.value.toLocaleString()}{unit && ` ${unit}`}
                </span>
              )}
            </div>
            
            {improvement && Number(improvement) > 0 && (
              <span class="improvement">+{improvement}%</span>
            )}
          </div>
        </div>
      );
    })}
  </div>
  
  {baselineIndex !== null && (
    <div class="chart-footer">
      <span class="baseline-note">
        ðŸ“Š Baseline: {data[baselineIndex].label}
      </span>
    </div>
  )}
</div>

<style lang="scss">
  @use '../../styles/variables' as *;
  
  .perf-chart {
    margin: $space-8 0;
    padding: $space-5;
    background: $color-bg-secondary;
    border: 1px solid $color-border-default;
    border-radius: $border-radius-lg;
  }
  
  .chart-header {
    display: flex;
    align-items: baseline;
    gap: $space-2;
    margin-bottom: $space-5;
    padding-bottom: $space-3;
    border-bottom: 1px solid $color-border-default;
  }
  
  .chart-title {
    font-family: $font-mono;
    font-size: $font-size-sm;
    font-weight: $font-weight-semibold;
    color: $color-text-primary;
    margin: 0;
  }
  
  .chart-unit {
    font-size: $font-size-xs;
    color: $color-text-tertiary;
  }
  
  .chart-body {
    display: flex;
    flex-direction: column;
    gap: $space-4;
  }
  
  .chart-row {
    display: grid;
    grid-template-columns: 140px 1fr;
    gap: $space-4;
    align-items: center;
    
    @media (max-width: 600px) {
      grid-template-columns: 1fr;
      gap: $space-2;
    }
  }
  
  .row-label {
    display: flex;
    flex-direction: column;
    gap: 2px;
  }
  
  .label-text {
    font-family: $font-mono;
    font-size: $font-size-sm;
    color: $color-text-primary;
  }
  
  .label-annotation {
    font-size: $font-size-xs;
    color: $color-text-tertiary;
  }
  
  .row-bar-container {
    display: flex;
    align-items: center;
    gap: $space-3;
  }
  
  .row-bar {
    height: 32px;
    width: var(--width);
    min-width: 60px;
    border-radius: $border-radius-sm;
    display: flex;
    align-items: center;
    justify-content: flex-end;
    padding: 0 $space-3;
    transition: width 0.5s ease-out;
    
    // Color variants
    &.color-blue {
      background: linear-gradient(90deg, rgba($color-accent-blue, 0.3), $color-accent-blue);
    }
    
    &.color-green {
      background: linear-gradient(90deg, rgba($color-accent-green, 0.3), $color-accent-green);
    }
    
    &.color-orange {
      background: linear-gradient(90deg, rgba($color-accent-orange, 0.3), $color-accent-orange);
    }
    
    &.color-red {
      background: linear-gradient(90deg, rgba($color-accent-red, 0.3), $color-accent-red);
    }
    
    &.color-purple {
      background: linear-gradient(90deg, rgba($color-accent-purple, 0.3), $color-accent-purple);
    }
    
    &.color-cyan {
      background: linear-gradient(90deg, rgba($color-accent-cyan, 0.3), $color-accent-cyan);
    }
    
    &.color-gray {
      background: linear-gradient(90deg, rgba($color-text-tertiary, 0.2), $color-text-tertiary);
    }
  }
  
  .bar-value {
    font-family: $font-mono;
    font-size: $font-size-xs;
    font-weight: $font-weight-semibold;
    color: $color-bg-primary;
    white-space: nowrap;
  }
  
  .improvement {
    font-family: $font-mono;
    font-size: $font-size-xs;
    font-weight: $font-weight-semibold;
    color: $color-accent-green;
    white-space: nowrap;
    padding: $space-1 $space-2;
    background: rgba($color-accent-green, 0.1);
    border-radius: $border-radius-sm;
  }
  
  .chart-footer {
    margin-top: $space-4;
    padding-top: $space-3;
    border-top: 1px solid $color-border-default;
  }
  
  .baseline-note {
    font-size: $font-size-xs;
    color: $color-text-tertiary;
  }
</style>



================================================
FILE: mdx/RegisterDiagram.astro
================================================
---
/**
 * RegisterDiagram Component
 * 
 * Visualizes hardware register bit layouts.
 * 
 * Usage in MDX:
 * <RegisterDiagram
 *   name="RTC_CNTL_CLK_CONF_REG"
 *   address="0x3FF48070"
 *   bits={[
 *     { range: "31:26", name: "Reserved", desc: "Reserved bits" },
 *     { range: "25:24", name: "FAST_CLK_RTC_SEL", desc: "Fast clock source select" },
 *     { range: "23:22", name: "ANA_CLK_RTC_SEL", desc: "Analog clock source" },
 *   ]}
 * />
 */

interface BitField {
  range: string;  // e.g., "31:26" or "0"
  name: string;
  desc?: string;
  value?: string;
  color?: 'blue' | 'green' | 'orange' | 'red' | 'purple' | 'gray';
}

interface Props {
  name: string;
  address?: string;
  bits: BitField[];
  width?: 32 | 64;
}

const { name, address, bits, width = 32 } = Astro.props;

// Parse bit ranges and calculate widths
const parsedBits = bits.map((bit) => {
  const [high, low] = bit.range.includes(':') 
    ? bit.range.split(':').map(Number)
    : [Number(bit.range), Number(bit.range)];
  
  return {
    ...bit,
    high,
    low,
    span: high - low + 1,
  };
});

// Generate bit number labels for top row
const bitNumbers = Array.from({ length: width }, (_, i) => width - 1 - i);
---

<div class="register-diagram">
  <div class="register-header">
    <code class="register-name">{name}</code>
    {address && <code class="register-address">{address}</code>}
  </div>
  
  <!-- Bit number ruler -->
  <div class="bit-ruler" style={`--bits: ${width}`}>
    {bitNumbers.filter((_, i) => i % 4 === 0).map((num) => (
      <span class="bit-number" style={`--pos: ${width - 1 - num}`}>{num}</span>
    ))}
  </div>
  
  <!-- Register visualization -->
  <div class="register-bits" style={`--bits: ${width}`}>
    {parsedBits.map((bit) => (
      <div 
        class:list={['bit-field', `color-${bit.color || 'blue'}`]}
        style={`--start: ${width - 1 - bit.high}; --span: ${bit.span}`}
        title={bit.desc || bit.name}
      >
        <span class="bit-label">{bit.name}</span>
        {bit.value && <span class="bit-value">{bit.value}</span>}
      </div>
    ))}
  </div>
  
  <!-- Legend -->
  <div class="register-legend">
    {parsedBits.map((bit) => (
      <div class="legend-item">
        <span class:list={['legend-color', `color-${bit.color || 'blue'}`]}></span>
        <code class="legend-range">[{bit.range}]</code>
        <span class="legend-name">{bit.name}</span>
        {bit.desc && <span class="legend-desc">{bit.desc}</span>}
      </div>
    ))}
  </div>
</div>

<style lang="scss">
  @use '../../styles/variables' as *;
  
  .register-diagram {
    margin: $space-8 0;
    padding: $space-5;
    background: $color-bg-secondary;
    border: 1px solid $color-border-default;
    border-radius: $border-radius-lg;
    overflow-x: auto;
  }
  
  .register-header {
    display: flex;
    align-items: center;
    gap: $space-4;
    margin-bottom: $space-4;
    padding-bottom: $space-4;
    border-bottom: 1px solid $color-border-default;
  }
  
  .register-name {
    font-family: $font-mono;
    font-size: $font-size-sm;
    font-weight: $font-weight-semibold;
    color: $color-accent-cyan;
    background: transparent;
    padding: 0;
  }
  
  .register-address {
    font-family: $font-mono;
    font-size: $font-size-xs;
    color: $color-text-tertiary;
    background: $color-bg-tertiary;
    padding: $space-1 $space-2;
    border-radius: $border-radius-sm;
  }
  
  .bit-ruler {
    display: grid;
    grid-template-columns: repeat(var(--bits), 1fr);
    margin-bottom: $space-1;
    min-width: 600px;
  }
  
  .bit-number {
    grid-column: calc(var(--pos) + 1);
    font-family: $font-mono;
    font-size: $font-size-xs;
    color: $color-text-tertiary;
    text-align: center;
  }
  
  .register-bits {
    display: grid;
    grid-template-columns: repeat(var(--bits), 1fr);
    gap: 1px;
    min-width: 600px;
    background: $color-border-default;
    border: 1px solid $color-border-default;
    border-radius: $border-radius-sm;
    overflow: hidden;
  }
  
  .bit-field {
    grid-column: calc(var(--start) + 1) / span var(--span);
    padding: $space-2 $space-1;
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 2px;
    min-height: 48px;
    cursor: help;
    transition: filter $transition-fast;
    
    &:hover {
      filter: brightness(1.2);
    }
    
    // Color variants
    &.color-blue {
      background: rgba($color-accent-blue, 0.2);
      border-left: 2px solid $color-accent-blue;
    }
    
    &.color-green {
      background: rgba($color-accent-green, 0.2);
      border-left: 2px solid $color-accent-green;
    }
    
    &.color-orange {
      background: rgba($color-accent-orange, 0.2);
      border-left: 2px solid $color-accent-orange;
    }
    
    &.color-red {
      background: rgba($color-accent-red, 0.2);
      border-left: 2px solid $color-accent-red;
    }
    
    &.color-purple {
      background: rgba($color-accent-purple, 0.2);
      border-left: 2px solid $color-accent-purple;
    }
    
    &.color-gray {
      background: rgba($color-text-tertiary, 0.1);
      border-left: 2px solid $color-text-tertiary;
    }
  }
  
  .bit-label {
    font-family: $font-mono;
    font-size: $font-size-xs;
    font-weight: $font-weight-medium;
    color: $color-text-primary;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 100%;
  }
  
  .bit-value {
    font-family: $font-mono;
    font-size: 10px;
    color: $color-text-secondary;
  }
  
  .register-legend {
    margin-top: $space-4;
    padding-top: $space-4;
    border-top: 1px solid $color-border-default;
    display: flex;
    flex-direction: column;
    gap: $space-2;
  }
  
  .legend-item {
    display: flex;
    align-items: center;
    gap: $space-2;
    font-size: $font-size-sm;
  }
  
  .legend-color {
    width: 12px;
    height: 12px;
    border-radius: 2px;
    flex-shrink: 0;
    
    &.color-blue { background: $color-accent-blue; }
    &.color-green { background: $color-accent-green; }
    &.color-orange { background: $color-accent-orange; }
    &.color-red { background: $color-accent-red; }
    &.color-purple { background: $color-accent-purple; }
    &.color-gray { background: $color-text-tertiary; }
  }
  
  .legend-range {
    font-family: $font-mono;
    font-size: $font-size-xs;
    color: $color-text-tertiary;
    background: transparent;
    padding: 0;
    min-width: 60px;
  }
  
  .legend-name {
    font-family: $font-mono;
    font-weight: $font-weight-medium;
    color: $color-text-primary;
    min-width: 150px;
  }
  
  .legend-desc {
    color: $color-text-secondary;
  }
</style>



================================================
FILE: mdx/Theorem.astro
================================================
---
// src/components/mdx/Theorem.astro
interface Props {
  title?: string;
  type?: 'Theorem' | 'Lemma' | 'Definition';
}
const { title, type = 'Theorem' } = Astro.props;
---
<div class="my-8 rounded-lg border-l-4 border-accent-purple bg-secondary p-6 shadow-sm">
  <div class="mb-2 flex items-center gap-2 font-mono text-sm uppercase tracking-widest text-accent-purple">
    <span class="text-lg">Î£</span>
    <strong>{type}{title ? `: ${title}` : ''}</strong>
  </div>
  <div class="prose-math italic leading-relaxed text-primary">
    <slot />
  </div>
</div>

