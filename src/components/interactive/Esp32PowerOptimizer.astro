---
title: "ESP32 Power Consumption Calculator"
description: "Interactive calculator to estimate battery life based on WiFi power optimization strategies"
---

<script>
  import { onMount } from 'astro/micro';

  let activeCurrent = 200; // mA
  let sleepCurrent = 0.015; // mA (15 µA)
  let activeTime = 3; // seconds
  let sleepTime = 3597; // seconds (1 hour minus active time)
  let batteryCapacity = 2000; // mAh

  const calculatePower = () => {
    const totalActiveCharge = (activeCurrent * activeTime) / 3600; // convert to mAs
    const totalSleepCharge = (sleepCurrent * sleepTime) / 3600; // convert to mAs
    const totalCycleCharge = totalActiveCharge + totalSleepCharge;
    
    const cyclesPermAh = 1000 / totalCycleCharge; // mAs to mAh conversion
    const totalCycles = (batteryCapacity * cyclesPermAh);
    const totalOperationalTime = totalCycles * (activeTime + sleepTime); // seconds
    
    const days = totalOperationalTime / (24 * 3600);
    const years = days / 365.25;
    
    return {
      activeCharge: totalActiveCharge,
      sleepCharge: totalSleepCharge,
      avgCurrent: ((totalActiveCharge + totalSleepCharge) * 3600) / (activeTime + sleepTime),
      batteryLifeYears: years,
      batteryLifeDays: days
    };
  };

  let result = calculatePower();

  const updateCalculation = () => {
    result = calculatePower();
  };
</script>

<div class="esp32-power-calculator p-6 bg-gray-50 rounded-lg border">
  <h3 class="text-xl font-bold mb-4 text-gray-800">ESP32 Power Consumption Calculator</h3>
  
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <div class="space-y-4">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">
          Active Current (mA): {activeCurrent.toFixed(0)}
        </label>
        <input 
          type="range" 
          min="50" 
          max="300" 
          value={activeCurrent}
          onChange={(e) => { activeCurrent = parseFloat(e.target.value); updateCalculation(); }}
          class="w-full"
        />
        <p class="text-xs text-gray-500">During WiFi transmission/reception</p>
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">
          Sleep Current (µA): {(sleepCurrent * 1000).toFixed(1)}
        </label>
        <input 
          type="range" 
          min="1" 
          max="50" 
          value={sleepCurrent * 1000}
          onChange={(e) => { sleepCurrent = parseFloat(e.target.value) / 1000; updateCalculation(); }}
          class="w-full"
        />
        <p class="text-xs text-gray-500">During deep sleep mode</p>
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">
          Active Time (sec): {activeTime}
        </label>
        <input 
          type="range" 
          min="1" 
          max="30" 
          value={activeTime}
          onChange={(e) => { activeTime = parseInt(e.target.value); updateCalculation(); }}
          class="w-full"
        />
        <p class="text-xs text-gray-500">Duration of high-power operations</p>
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">
          Sleep Time (sec): {sleepTime}
        </label>
        <input 
          type="range" 
          min="100" 
          max="7200" 
          value={sleepTime}
          onChange={(e) => { sleepTime = parseInt(e.target.value); updateCalculation(); }}
          class="w-full"
        />
        <p class="text-xs text-gray-500">Duration between active cycles</p>
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1">
          Battery Capacity (mAh): {batteryCapacity}
        </label>
        <input 
          type="range" 
          min="500" 
          max="5000" 
          value={batteryCapacity}
          onChange={(e) => { batteryCapacity = parseInt(e.target.value); updateCalculation(); }}
          class="w-full"
        />
        <p class="text-xs text-gray-500">Battery capacity for life estimation</p>
      </div>
    </div>
    
    <div class="bg-white p-4 rounded border">
      <h4 class="font-semibold mb-2 text-gray-800">Power Analysis Results</h4>
      
      <div class="space-y-2 text-sm">
        <div class="flex justify-between">
          <span class="text-gray-600">Average Current:</span>
          <span class="font-mono">{result.avgCurrent.toFixed(3)} mA</span>
        </div>
        
        <div class="flex justify-between">
          <span class="text-gray-600">Active Charge per Cycle:</span>
          <span class="font-mono">{result.activeCharge.toFixed(4)} mAs</span>
        </div>
        
        <div class="flex justify-between">
          <span class="text-gray-600">Sleep Charge per Cycle:</span>
          <span class="font-mono">{result.sleepCharge.toFixed(4)} mAs</span>
        </div>
        
        <div class="border-t pt-2 mt-2">
          <div class="flex justify-between font-semibold text-green-700">
            <span>Battery Life:</span>
            <span>{result.batteryLifeDays.toFixed(1)} days</span>
          </div>
          
          <div class="flex justify-between font-semibold text-green-700">
            <span>Or approximately:</span>
            <span>{result.batteryLifeYears.toFixed(2)} years</span>
          </div>
        </div>
      </div>
      
      <div class="mt-4 p-3 bg-blue-50 rounded text-xs text-blue-800">
        <strong>Tip:</strong> Reducing active time from {activeTime}s to 1s while maintaining 1-hour sleep cycles 
        can significantly extend battery life. Consider batching operations and optimizing transmission efficiency.
      </div>
    </div>
  </div>
</div>

<style>
  .esp32-power-calculator {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  }
  
  input[type="range"] {
    height: 6px;
    border-radius: 3px;
    background: #e5e7eb;
    outline: none;
  }
  
  input[type="range"]::-webkit-slider-thumb {
    appearance: none;
    height: 18px;
    width: 18px;
    border-radius: 50%;
    background: #3b82f6;
    cursor: pointer;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
  }
  
  input[type="range"]::-moz-range-thumb {
    height: 18px;
    width: 18px;
    border-radius: 50%;
    background: #3b82f6;
    cursor: pointer;
    border: none;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
  }
</style>