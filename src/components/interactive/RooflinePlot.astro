---
// src/components/interactive/RooflinePlot.astro
interface Props {
  peakFlops?: number;
  peakBw?: number;
}
const { peakFlops = 312, peakBw = 2000 } = Astro.props;
---
<div class="roofline-card p-6 bg-secondary border border-default rounded-lg my-8">
  <h4 class="text-sm font-mono mb-4 text-primary uppercase">Native Roofline Model</h4>
  <canvas id="rooflineCanvas" class="w-full h-64 bg-primary rounded"></canvas>
  <div class="mt-4">
    <label class="text-xs font-mono text-secondary">
      Adjust Intensity: <input type="range" id="intensitySlider" min="0.1" max="100" step="0.1" value="10" class="align-middle">
      <span id="intensityVal" class="text-accent-blue ml-2">10 FLOP/B</span>
    </label>
  </div>
</div>

<script is:inline define:vars={{ peakFlops, peakBw }}>
  const canvas = document.getElementById('rooflineCanvas');
  const ctx = canvas.getContext('2d');
  const slider = document.getElementById('intensitySlider');
  const valDisplay = document.getElementById('intensityVal');

  function draw(intensity) {
    const w = canvas.width = canvas.offsetWidth * devicePixelRatio;
    const h = canvas.height = canvas.offsetHeight * devicePixelRatio;
    ctx.scale(devicePixelRatio, devicePixelRatio);
    ctx.clearRect(0, 0, w, h);
    
    // Simple Drawing Logic for Roofline
    ctx.strokeStyle = '#58a6ff'; ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(20, h/2 - 20); // Baseline
    ctx.lineTo(150, 40);      // Sloped (Memory Bound)
    ctx.lineTo(w/2, 40);      // Flat (Compute Bound)
    ctx.stroke();

    // Dot for current intensity
    const xPos = 20 + (intensity * 2);
    ctx.fillStyle = '#3fb950';
    ctx.beginPath();
    ctx.arc(xPos, 50, 5, 0, Math.PI * 2);
    ctx.fill();
  }

  slider.addEventListener('input', (e) => {
    valDisplay.textContent = `${e.target.value} FLOP/B`;
    draw(parseFloat(e.target.value));
  });
  window.addEventListener('resize', () => draw(slider.value));
  draw(10);
</script>