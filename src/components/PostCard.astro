---
import type { CollectionEntry } from 'astro:content';

interface Props {
  post: CollectionEntry<'posts'>;
  featured?: boolean;
}

const { post, featured = false } = Astro.props;
const { title, description, publishDate, category, tags, difficulty, readingTime } = post.data;

const formatDate = (date: Date) => {
  return new Intl.DateTimeFormat('en-US', {
    year: 'numeric',
    month: 'short',
    day: 'numeric',
  }).format(date);
};

const calculatedReadingTime = readingTime || Math.ceil(post.body.split(/\s+/).length / 200);
---

<article class:list={['post-card', { featured }]}>
  <a href={`/posts/${post.slug}`} class="post-card-link">
    <div class="post-card-header">
      <span class="badge badge-category" data-category={category}>
        {category.replace('-', ' ')}
      </span>
      <span class="badge badge-difficulty" data-difficulty={difficulty}>
        {difficulty}
      </span>
    </div>
    
    <h3 class="post-card-title">{title}</h3>
    
    <p class="post-card-description">{description}</p>
    
    <div class="post-card-meta">
      <time datetime={publishDate.toISOString()}>
        {formatDate(publishDate)}
      </time>
      <span class="meta-separator">·</span>
      <span>{calculatedReadingTime} min read</span>
    </div>
    
    <div class="post-card-tags">
      {tags.slice(0, 3).map((tag) => (
        <span class="tag-pill">#{tag}</span>
      ))}
      {tags.length > 3 && (
        <span class="tag-pill more">+{tags.length - 3}</span>
      )}
    </div>
  </a>
</article>

<style lang="scss">
  @use '../styles/variables' as *;
  
  .post-card {
    background: $color-bg-secondary;
    border: 1px solid $color-border-default;
    border-radius: $border-radius-lg;
    overflow: hidden;
    transition: all $transition-base;
    
    &:hover {
      border-color: $color-border-emphasis;
      transform: translateY(-2px);
      box-shadow: $shadow-lg;
    }
    
    &.featured {
      border-color: $color-accent-blue;
      background: linear-gradient(
        135deg,
        rgba($color-accent-blue, 0.05) 0%,
        transparent 50%
      );
      
      &::before {
        content: '⭐ Featured';
        position: absolute;
        top: $space-3;
        right: $space-3;
        font-size: $font-size-xs;
        font-family: $font-mono;
        color: $color-accent-orange;
      }
    }
  }
  
  .post-card-link {
    display: block;
    padding: $space-6;
    text-decoration: none;
    color: inherit;
    height: 100%;
    
    &:hover {
      text-decoration: none;
    }
  }
  
  .post-card-header {
    display: flex;
    gap: $space-2;
    margin-bottom: $space-4;
  }
  
  .post-card-title {
    font-family: $font-display;
    font-size: $font-size-lg;
    font-weight: $font-weight-semibold;
    line-height: $line-height-snug;
    color: $color-text-primary;
    margin-bottom: $space-3;
    transition: color $transition-fast;
    
    .post-card:hover & {
      color: $color-accent-blue;
    }
  }
  
  .post-card-description {
    font-size: $font-size-sm;
    color: $color-text-secondary;
    line-height: $line-height-relaxed;
    margin-bottom: $space-4;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  .post-card-meta {
    display: flex;
    align-items: center;
    gap: $space-2;
    font-size: $font-size-xs;
    color: $color-text-tertiary;
    margin-bottom: $space-4;
  }
  
  .meta-separator {
    opacity: 0.5;
  }
  
  .post-card-tags {
    display: flex;
    flex-wrap: wrap;
    gap: $space-2;
  }
  
  .tag-pill {
    font-family: $font-mono;
    font-size: $font-size-xs;
    color: $color-text-tertiary;
    background: $color-bg-tertiary;
    padding: 0.125rem $space-2;
    border-radius: $border-radius-full;
    
    &.more {
      color: $color-text-secondary;
    }
  }
</style>
