---
/**
 * CodeCompare Component
 * 
 * Side-by-side code comparison with highlighting.
 * 
 * Usage in MDX:
 * <CodeCompare
 *   beforeTitle="Before Optimization"
 *   afterTitle="After Optimization"
 *   language="python"
 * >
 *   <Fragment slot="before">
 *     ```python
 *     # Naive implementation
 *     for i in range(n):
 *         result += data[i]
 *     ```
 *   </Fragment>
 *   <Fragment slot="after">
 *     ```python
 *     # Vectorized
 *     result = np.sum(data)
 *     ```
 *   </Fragment>
 * </CodeCompare>
 */

interface Props {
  beforeTitle?: string;
  afterTitle?: string;
  language?: string;
}

const { 
  beforeTitle = 'Before', 
  afterTitle = 'After',
  language
} = Astro.props;
---

<div class="code-compare">
  <div class="compare-panel before">
    <div class="panel-header">
      <span class="panel-indicator before-indicator">−</span>
      <span class="panel-title">{beforeTitle}</span>
    </div>
    <div class="panel-content">
      <slot name="before" />
    </div>
  </div>
  
  <div class="compare-divider">
    <span class="divider-arrow">→</span>
  </div>
  
  <div class="compare-panel after">
    <div class="panel-header">
      <span class="panel-indicator after-indicator">+</span>
      <span class="panel-title">{afterTitle}</span>
    </div>
    <div class="panel-content">
      <slot name="after" />
    </div>
  </div>
</div>

<style lang="scss">
  @use '../../styles/variables' as *;
  
  .code-compare {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    gap: $space-2;
    margin: $space-8 0;
    
    @media (max-width: 900px) {
      grid-template-columns: 1fr;
      gap: $space-4;
    }
  }
  
  .compare-panel {
    background: $color-bg-secondary;
    border: 1px solid $color-border-default;
    border-radius: $border-radius-lg;
    overflow: hidden;
    
    &.before {
      border-top: 3px solid $color-accent-red;
    }
    
    &.after {
      border-top: 3px solid $color-accent-green;
    }
  }
  
  .panel-header {
    display: flex;
    align-items: center;
    gap: $space-2;
    padding: $space-3 $space-4;
    background: $color-bg-tertiary;
    border-bottom: 1px solid $color-border-default;
  }
  
  .panel-indicator {
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: $font-mono;
    font-size: $font-size-sm;
    font-weight: $font-weight-bold;
    border-radius: $border-radius-sm;
    
    &.before-indicator {
      background: rgba($color-accent-red, 0.2);
      color: $color-accent-red;
    }
    
    &.after-indicator {
      background: rgba($color-accent-green, 0.2);
      color: $color-accent-green;
    }
  }
  
  .panel-title {
    font-family: $font-mono;
    font-size: $font-size-xs;
    font-weight: $font-weight-semibold;
    text-transform: uppercase;
    letter-spacing: $letter-spacing-wide;
    color: $color-text-secondary;
  }
  
  .panel-content {
    padding: 0;
    
    // Reset nested pre/code styles
    :global(pre) {
      margin: 0 !important;
      border: none !important;
      border-radius: 0 !important;
      background: transparent !important;
    }
    
    :global(code) {
      font-size: $font-size-sm;
    }
  }
  
  .compare-divider {
    display: flex;
    align-items: center;
    justify-content: center;
    
    @media (max-width: 900px) {
      padding: $space-2 0;
    }
  }
  
  .divider-arrow {
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: $color-bg-tertiary;
    border: 1px solid $color-border-default;
    border-radius: $border-radius-full;
    font-size: $font-size-lg;
    color: $color-accent-blue;
    
    @media (max-width: 900px) {
      transform: rotate(90deg);
    }
  }
</style>
