---
import { getCollection } from 'astro:content';
import PostLayout from '@/layouts/PostLayout.astro';

// Import MDX components
import Callout from '@/components/mdx/Callout.astro';
import RegisterDiagram from '@/components/mdx/RegisterDiagram.astro';
import MemoryLayout from '@/components/mdx/MemoryLayout.astro';
import PerfChart from '@/components/mdx/PerfChart.astro';
import CodeCompare from '@/components/mdx/CodeCompare.astro';
import Benchmark from '@/components/mdx/Benchmark.astro';

export async function getStaticPaths() {
  const posts = await getCollection('posts');
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content, headings } = await post.render();

// Define MDX components available in posts
const components = {
  Callout,
  RegisterDiagram,
  MemoryLayout,
  PerfChart,
  CodeCompare,
  Benchmark,
};
---

<PostLayout post={post} headings={headings}>
  <Content components={components} />
</PostLayout>
