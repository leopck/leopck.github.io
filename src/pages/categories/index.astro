---
import BaseLayout from '@/layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const allPosts = await getCollection('posts', ({ data }) => !data.draft);

const categoryMeta = {
  'microcontrollers': {
    name: 'Microcontrollers',
    icon: 'ðŸ”Œ',
    description: 'Bare-metal programming, register-level optimization, and embedded systems deep-dives. ESP32, ARM Cortex, and low-power design.',
    color: '#58a6ff',
  },
  'vllm': {
    name: 'vLLM',
    icon: 'ðŸš€',
    description: 'vLLM internals, PagedAttention, continuous batching, and inference serving optimization.',
    color: '#f97583',
  },
  'llm-inference': {
    name: 'LLM Inference',
    icon: 'ðŸ§ ',
    description: 'Large language model inference optimization, KV cache management, and transformer performance.',
    color: '#a371f7',
  },
  'transformers': {
    name: 'Transformers',
    icon: 'ðŸ”®',
    description: 'Attention mechanisms, architecture analysis, and transformer implementation details.',
    color: '#39c5cf',
  },
  'hardware-optimization': {
    name: 'Hardware Optimization',
    icon: 'âš™ï¸',
    description: 'CPU/GPU optimization, SIMD, cache hierarchy, and hardware-aware algorithm design.',
    color: '#3fb950',
  },
  'profiling': {
    name: 'Profiling',
    icon: 'ðŸ“Š',
    description: 'Performance analysis with perf, DTrace, eBPF, flame graphs, and systematic debugging.',
    color: '#d29922',
  },
  'kernel-development': {
    name: 'Kernel Development',
    icon: 'ðŸ”§',
    description: 'Custom kernel development, CUDA, Triton, and low-level GPU programming.',
    color: '#f85149',
  },
  'memory-systems': {
    name: 'Memory Systems',
    icon: 'ðŸ’¾',
    description: 'Memory hierarchy optimization, cache behavior, NUMA, and memory-bound workloads.',
    color: '#db61a2',
  },
  'distributed-systems': {
    name: 'Distributed Systems',
    icon: 'ðŸŒ',
    description: 'Distributed inference, tensor parallelism, model sharding, and cluster optimization.',
    color: '#79c0ff',
  },
  'gpu-programming': {
    name: 'GPU Programming',
    icon: 'ðŸŽ®',
    description: 'CUDA, Habana Gaudi, GPU architecture, and accelerator programming.',
    color: '#56d364',
  },
};

const categories = Object.entries(categoryMeta).map(([slug, meta]) => ({
  slug,
  ...meta,
  count: allPosts.filter((p) => p.data.category === slug).length,
})).filter((c) => c.count > 0);
---

<BaseLayout 
  title="Categories" 
  description="Browse technical articles by topic"
>
  <div class="categories-page">
    <header class="page-header">
      <div class="container">
        <h1 class="page-title">Categories</h1>
        <p class="page-description">
          Browse {allPosts.length} articles across {categories.length} topics
        </p>
      </div>
    </header>
    
    <div class="page-content">
      <div class="container">
        <div class="categories-grid">
          {categories.map((category) => (
            <a 
              href={`/categories/${category.slug}`} 
              class="category-card"
              style={`--accent-color: ${category.color}`}
            >
              <div class="card-header">
                <span class="card-icon">{category.icon}</span>
                <span class="card-count">{category.count} posts</span>
              </div>
              <h2 class="card-title">{category.name}</h2>
              <p class="card-description">{category.description}</p>
              <span class="card-link">
                Browse articles â†’
              </span>
            </a>
          ))}
        </div>
      </div>
    </div>
  </div>
</BaseLayout>

<style lang="scss">
  @use '../../styles/variables' as *;
  
  .page-header {
    padding: $space-16 0 $space-10;
    background: $color-bg-secondary;
    border-bottom: 1px solid $color-border-default;
  }
  
  .page-title {
    font-size: $font-size-3xl;
    margin-bottom: $space-3;
  }
  
  .page-description {
    font-size: $font-size-lg;
    color: $color-text-secondary;
    margin: 0;
  }
  
  .page-content {
    padding: $space-12 0;
  }
  
  .categories-grid {
    display: grid;
    gap: $space-6;
    
    @include respond-to(md) {
      grid-template-columns: repeat(2, 1fr);
    }
    
    @include respond-to(lg) {
      grid-template-columns: repeat(3, 1fr);
    }
  }
  
  .category-card {
    display: flex;
    flex-direction: column;
    padding: $space-6;
    background: $color-bg-secondary;
    border: 1px solid $color-border-default;
    border-radius: $border-radius-lg;
    text-decoration: none;
    transition: all $transition-base;
    
    &:hover {
      border-color: var(--accent-color);
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
      text-decoration: none;
      
      .card-link {
        color: var(--accent-color);
      }
    }
  }
  
  .card-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: $space-3;
  }
  
  .card-icon {
    font-size: 1.75rem;
  }
  
  .card-count {
    font-family: $font-mono;
    font-size: $font-size-xs;
    color: $color-text-tertiary;
    padding: $space-1 $space-2;
    background: $color-bg-tertiary;
    border-radius: $border-radius-full;
  }
  
  .card-title {
    font-family: $font-display;
    font-size: $font-size-xl;
    color: $color-text-primary;
    margin: 0 0 $space-3;
  }
  
  .card-description {
    font-size: $font-size-sm;
    color: $color-text-secondary;
    line-height: $line-height-relaxed;
    margin: 0 0 $space-4;
    flex: 1;
  }
  
  .card-link {
    font-size: $font-size-sm;
    font-weight: $font-weight-medium;
    color: $color-text-secondary;
    transition: color $transition-fast;
  }
</style>
