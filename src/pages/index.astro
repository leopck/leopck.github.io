---
import BaseLayout from '@/layouts/BaseLayout.astro';
import PostCard from '@/components/PostCard.astro';
import { getCollection } from 'astro:content';

const allPosts = await getCollection('posts', ({ data }) => !data.draft);
const sortedPosts = allPosts.sort((a, b) => 
  b.data.publishDate.valueOf() - a.data.publishDate.valueOf()
);

const featuredPosts = sortedPosts.filter((p) => p.data.featured).slice(0, 3);
const recentPosts = sortedPosts.slice(0, 9);

// Get category counts
const categories = [
  { slug: 'vllm', name: 'vLLM', icon: 'ðŸš€' },
  { slug: 'llm-inference', name: 'LLM Inference', icon: 'ðŸ§ ' },
  { slug: 'microcontrollers', name: 'Microcontrollers', icon: 'ðŸ”Œ' },
  { slug: 'hardware-optimization', name: 'Hardware', icon: 'âš™ï¸' },
  { slug: 'profiling', name: 'Profiling', icon: 'ðŸ“Š' },
  { slug: 'gpu-programming', name: 'GPU', icon: 'ðŸŽ®' },
];

const categoryCounts = categories.map((cat) => ({
  ...cat,
  count: allPosts.filter((p) => p.data.category === cat.slug).length,
}));
---

<BaseLayout title="Fridays with Faraday">
  <!-- Hero Section -->
  <section class="hero">
    <div class="hero-container">
      <div class="hero-content">
        <span class="hero-badge">âš¡ Performance Engineering</span>
        <h1 class="hero-title">
          Deep Technical Explorations in
          <span class="gradient-text">Systems Optimization</span>
        </h1>
        <p class="hero-description">
          From bare-metal microcontroller registers to large-scale LLM inference pipelines. 
          We obsess over every microsecond, every cache miss, every memory access pattern.
        </p>
        <div class="hero-actions">
          <a href="/posts" class="btn btn-primary">
            Browse All Posts
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M5 12h14"></path>
              <path d="m12 5 7 7-7 7"></path>
            </svg>
          </a>
          <a href="/about" class="btn btn-secondary">About This Blog</a>
        </div>
      </div>
      
      <div class="hero-visual">
        <div class="terminal">
          <div class="terminal-header">
            <span class="terminal-dot red"></span>
            <span class="terminal-dot yellow"></span>
            <span class="terminal-dot green"></span>
            <span class="terminal-title">perf.sh</span>
          </div>
          <div class="terminal-body">
            <code>
              <span class="prompt">$</span> perf stat -e cycles,instructions,cache-misses ./inference<br/>
              <span class="comment"># Performance counter stats:</span><br/>
              <span class="metric">42,891,234,567</span> cycles<br/>
              <span class="metric">98,234,567,890</span> instructions <span class="highlight"># 2.29 IPC</span><br/>
              <span class="metric">1,234,567</span> cache-misses <span class="highlight"># 0.001%</span><br/><br/>
              <span class="success">âœ“ 3.2x throughput improvement</span>
            </code>
          </div>
        </div>
      </div>
    </div>
  </section>
  
  <!-- Categories Section -->
  <section class="categories-section">
    <div class="container">
      <div class="section-header">
        <h2 class="section-title">Explore by Topic</h2>
      </div>
      <div class="categories-grid">
        {categoryCounts.map((cat) => (
          <a href={`/categories/${cat.slug}`} class="category-card" data-category={cat.slug}>
            <span class="category-icon">{cat.icon}</span>
            <span class="category-name">{cat.name}</span>
            <span class="category-count">{cat.count} posts</span>
          </a>
        ))}
      </div>
    </div>
  </section>
  
  <!-- Recent Posts Section -->
  <section class="posts-section">
    <div class="container">
      <div class="section-header">
        <h2 class="section-title">Recent Posts</h2>
        <a href="/posts" class="section-link">
          View all
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M5 12h14"></path>
            <path d="m12 5 7 7-7 7"></path>
          </svg>
        </a>
      </div>
      <div class="posts-grid">
        {recentPosts.map((post) => (
          <PostCard post={post} />
        ))}
      </div>
    </div>
  </section>
  
  <!-- CTA Section -->
  <section class="cta-section">
    <div class="container">
      <div class="cta-content">
        <h2 class="cta-title">Stay Updated</h2>
        <p class="cta-description">
          Get notified when new deep-dive technical articles are published.
        </p>
        <a href="/rss.xml" class="btn btn-primary">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M4 11a9 9 0 0 1 9 9"></path>
            <path d="M4 4a16 16 0 0 1 16 16"></path>
            <circle cx="5" cy="19" r="1"></circle>
          </svg>
          Subscribe via RSS
        </a>
      </div>
    </div>
  </section>
</BaseLayout>

<style lang="scss">
  @use '../styles/variables' as *;
  
  // Hero
  .hero {
    padding: $space-16 0 $space-20;
    background: linear-gradient(
      180deg,
      $color-bg-secondary 0%,
      $color-bg-primary 100%
    );
    border-bottom: 1px solid $color-border-default;
    overflow: hidden;
  }
  
  .hero-container {
    @include container;
    display: grid;
    gap: $space-12;
    align-items: center;
    
    @include respond-to(lg) {
      grid-template-columns: 1fr 1fr;
      gap: $space-16;
    }
  }
  
  .hero-content {
    max-width: 600px;
  }
  
  .hero-badge {
    display: inline-block;
    padding: $space-1 $space-3;
    font-family: $font-mono;
    font-size: $font-size-xs;
    font-weight: $font-weight-medium;
    color: $color-accent-blue;
    background: rgba($color-accent-blue, 0.1);
    border: 1px solid rgba($color-accent-blue, 0.2);
    border-radius: $border-radius-full;
    margin-bottom: $space-4;
  }
  
  .hero-title {
    font-size: $font-size-3xl;
    line-height: $line-height-tight;
    margin-bottom: $space-4;
    
    @include respond-to(lg) {
      font-size: $font-size-4xl;
    }
  }
  
  .gradient-text {
    @include gradient-text($color-accent-blue, $color-accent-purple);
  }
  
  .hero-description {
    font-size: $font-size-lg;
    color: $color-text-secondary;
    line-height: $line-height-relaxed;
    margin-bottom: $space-8;
  }
  
  .hero-actions {
    display: flex;
    flex-wrap: wrap;
    gap: $space-3;
  }
  
  .hero-visual {
    display: none;
    
    @include respond-to(lg) {
      display: block;
    }
  }
  
  .terminal {
    background: $color-bg-tertiary;
    border: 1px solid $color-border-default;
    border-radius: $border-radius-lg;
    overflow: hidden;
    box-shadow: $shadow-xl;
  }
  
  .terminal-header {
    display: flex;
    align-items: center;
    gap: $space-2;
    padding: $space-3 $space-4;
    background: $color-bg-elevated;
    border-bottom: 1px solid $color-border-default;
  }
  
  .terminal-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    
    &.red { background: #ff5f56; }
    &.yellow { background: #ffbd2e; }
    &.green { background: #27c93f; }
  }
  
  .terminal-title {
    margin-left: auto;
    font-family: $font-mono;
    font-size: $font-size-xs;
    color: $color-text-tertiary;
  }
  
  .terminal-body {
    padding: $space-4;
    font-family: $font-mono;
    font-size: $font-size-sm;
    line-height: 1.8;
    
    code {
      background: transparent;
      padding: 0;
      color: $color-text-primary;
    }
    
    .prompt { color: $color-accent-green; }
    .comment { color: $color-text-tertiary; }
    .metric { color: $color-accent-cyan; }
    .highlight { color: $color-accent-orange; }
    .success { color: $color-accent-green; }
  }
  
  // Categories
  .categories-section {
    padding: $space-16 0;
  }
  
  .section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: $space-8;
  }
  
  .section-title {
    font-family: $font-display;
    font-size: $font-size-2xl;
    margin: 0;
  }
  
  .section-link {
    display: inline-flex;
    align-items: center;
    gap: $space-1;
    font-size: $font-size-sm;
    font-weight: $font-weight-medium;
    color: $color-accent-blue;
    
    &:hover {
      text-decoration: none;
      
      svg {
        transform: translateX(4px);
      }
    }
    
    svg {
      transition: transform $transition-fast;
    }
  }
  
  .categories-grid {
    display: grid;
    gap: $space-4;
    grid-template-columns: repeat(2, 1fr);
    
    @include respond-to(md) {
      grid-template-columns: repeat(3, 1fr);
    }
    
    @include respond-to(lg) {
      grid-template-columns: repeat(6, 1fr);
    }
  }
  
  .category-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: $space-2;
    padding: $space-5;
    background: $color-bg-secondary;
    border: 1px solid $color-border-default;
    border-radius: $border-radius-lg;
    text-decoration: none;
    transition: all $transition-base;
    
    &:hover {
      border-color: $color-border-emphasis;
      transform: translateY(-2px);
      box-shadow: $shadow-lg;
      text-decoration: none;
    }
  }
  
  .category-icon {
    font-size: 1.5rem;
  }
  
  .category-name {
    font-family: $font-mono;
    font-size: $font-size-sm;
    font-weight: $font-weight-medium;
    color: $color-text-primary;
    text-align: center;
  }
  
  .category-count {
    font-size: $font-size-xs;
    color: $color-text-tertiary;
  }
  
  // Posts
  .posts-section {
    padding: $space-16 0;
    background: $color-bg-secondary;
    border-top: 1px solid $color-border-default;
    border-bottom: 1px solid $color-border-default;
  }
  
  .posts-grid {
    display: grid;
    gap: $space-6;
    
    @include respond-to(md) {
      grid-template-columns: repeat(2, 1fr);
    }
    
    @include respond-to(lg) {
      grid-template-columns: repeat(3, 1fr);
    }
  }
  
  // CTA
  .cta-section {
    padding: $space-20 0;
  }
  
  .cta-content {
    text-align: center;
    max-width: 500px;
    margin: 0 auto;
  }
  
  .cta-title {
    font-family: $font-display;
    font-size: $font-size-2xl;
    margin-bottom: $space-3;
  }
  
  .cta-description {
    color: $color-text-secondary;
    margin-bottom: $space-6;
  }
</style>
